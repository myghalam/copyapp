<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 14pt;
  background: #f4f7fb;
  margin: 0;
  padding: 20px;
  direction: rtl;
}
.container {
  max-width: 1100px;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 10px;
  padding: 16px 24px 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Ù‡Ø¯Ø± Ø¨Ø§Ù„Ø§ */
.top-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  gap: 12px;
}
.top-title {
  font-family: "B Homa", Tahoma, sans-serif;
  font-weight: bold;
  font-size: 16pt;
  background: #1976d2;
  color: #fff;
  padding: 8px 12px;
  border-radius: 8px;
}
.top-bar {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 12px;
  font-size: 13pt;
  color: #0d47a1;
}
.top-bar-item {
  display: flex;
  align-items: center;
  gap: 6px;
}
.top-bar-item-label {
  font-weight: bold;
}
.top-bar-item input {
  width: 130px;
  padding: 2px 4px;
  border-radius: 4px;
  border: 1px solid #ccc;
  font-size: 12pt;
  font-family: "B Homa", Tahoma, sans-serif;
}

/* h1 Ù„Ø§Ø²Ù… Ù†Ø¯Ø§Ø±ÛŒÙ… */
h1 { display: none; }

.section {
  border: 1px solid #dce3ec;
  border-radius: 8px;
  margin-bottom: 12px;
  padding: 10px 12px;
  background: #fafcff;
}
.section:hover {
  box-shadow: 0 0 8px rgba(25,118,210,0.2);
}
.section-title {
  font-weight: bold;
  margin-bottom: 8px;
  font-size: 15pt;
  background: #e3f2fd;
  color: #0d47a1;
  padding: 4px 8px;
  border-radius: 6px;
  display: inline-block;
}
.row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 8px;
}
.field {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 6px;
}
label {
  min-width: 90px;
  font-size: 13pt;
  color: #0d47a1;
}
input[type="text"],
select,
textarea {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 13pt;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: border-color 0.3s, box-shadow 0.3s;
}
input:focus, select:focus, textarea:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 5px rgba(66,165,245,0.6);
  outline: none;
}
textarea {
  height: 70px;
  resize: vertical;
}
.radio-row {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13pt;
  margin-bottom: 6px;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† */
.buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 14px;
}
.buttons button {
  padding: 8px 18px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 13pt;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: background 0.3s ease, transform 0.1s ease;
}
.btn-new  { background: #43a047; color: #fff; }
.btn-save { background: #1976d2; color: #fff; }
.btn-print{ background: #757575; color: #fff; }
.btn-today{ background: #fb8c00; color: #fff; }
.btn-close{ background: #e53935; color: #fff; }
.buttons button:hover {
  opacity: 0.9;
  transform: scale(1.03);
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
.btn-small {
  padding: 6px 14px;
  font-size: 13pt;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-family:"B Homa", Tahoma, sans-serif;
  background:#e3f2fd;
  color:#0d47a1;
}
.btn-small:hover {
  opacity:0.9;
  transform:scale(1.03);
}
.btn-status {
  background:#1976d2;
  color:#fff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ */
.customer-actions button {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 13pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
.btn-search { background:#1976d2; color:#fff; }
.btn-new-cust { background:#43a047; color:#fff; }

.hidden { display: none; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 6px;
}
th, td {
  border: 1px solid #dce3ec;
  padding: 5px;
  text-align: center;
  font-size: 12pt;
}
th {
  background: #e3f2fd;
  color: #0d47a1;
}
tfoot td {
  background: #f5f5f5;
  font-weight: bold;
}
.btn-add-row {
  background:#43a047;
  color:#fff;
  padding:6px 14px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  font-size:13pt;
  font-family:"B Homa", Tahoma, sans-serif;
  margin-right:10px;
}
.btn-add-row:hover { opacity:.9; transform:scale(1.03); }
.btn-remove-row {
  background:#e53935;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:3px 7px;
  cursor:pointer;
}
.btn-detail-apply {
  background:#1976d2;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:8px 18px;
  cursor:pointer;
  font-size:13pt;
  font-family:"B Homa", Tahoma, sans-serif;
}
.btn-detail-apply:hover { opacity:.9; transform:scale(1.03); }

/* Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§Ù„Ø§ */
.main-menu {
  display:flex;
  justify-content:flex-start;
  gap:8px;
  flex-wrap:wrap;
}
.main-menu button {
  padding:6px 14px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-size:12pt;
  font-family:"B Homa",Tahoma,sans-serif;
  background:#e3f2fd;
  color:#0d47a1;
}
.main-menu button.active {
  background:#1976d2;
  color:#fff;
}

/* Ø¯Ú©Ù…Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² (Ø³Ù‡ Ø±Ù†Ú¯) */
.btn-open-orders {
  padding:6px 14px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-size:12pt;
  font-family:"B Homa",Tahoma,sans-serif;
  background:#e3f2fd;
  color:#0d47a1;
}
.btn-open-orders.open-red {
  background:#e53935;
  color:#fff;
}
.btn-open-orders.open-yellow {
  background:#fbc02d;
  color:#000;
}
.btn-open-orders.open-green {
  background:#43a047;
  color:#fff;
}


.btn-new-top {
  padding:6px 14px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-size:12pt;
  font-family:"B Homa",Tahoma,sans-serif;
  background:#43a047;
  color:#fff;
  margin-right:24px;
}
/* Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal.show{display:flex;}
.modal-box{
  background:#fff;
  padding:14px 18px;
  border-radius:10px;
  min-width:700px;
  max-width:95vw;
  max-height:90vh;
  overflow-y:auto;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
.modal-box h2{
  margin-top:0;
  margin-bottom:10px;
  font-size:15pt;
  color:#0d47a1;
}
.modal-buttons{
  margin-top:14px;
  text-align:left;
  display:flex;
  gap:10px;
}
.modal-buttons button{
  padding:7px 12px;
  border-radius:6px;
  border:none;
  cursor:pointer;
}

/* Ù…ÙˆØ¯Ø§Ù„ Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª */
.modal .modal-box {
  min-width: 1200px !important;
  max-width: 95vw !important;
  max-height: 90vh !important;
  width: 1200px !important;
}

.modal .modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid #e0e0e0;
  background: #f8f9fa;
  border-radius: 10px 10px 0 0;
}

.modal .modal-header h2 {
  margin: 0;
  color: #1976d2;
  font-size: 18pt;
}

.modal .close {
  font-size: 24px;
  font-weight: bold;
  color: #666;
  background: #fff;
  border: 2px solid #ddd;
  cursor: pointer;
  padding: 5px 12px;
  border-radius: 50%;
  transition: all 0.2s;
  line-height: 1;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal .close:hover {
  color: #d32f2f;
  background: #ffebee;
  border-color: #d32f2f;
}

.modal .modal-body {
  padding: 20px;
  max-height: calc(90vh - 120px);
  overflow-y: auto;
}

/* ÙÙˆÙ†Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ */
.modal .modal-box {
  font-size:12pt;
  font-family:"B Homa",Tahoma,sans-serif;
}
.btn-modal-ok{background:#1976d2;color:#fff;}
.btn-modal-cancel{background:#9e9e9e;color:#fff;}

/* Ù„ÛŒØ¨Ù„ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ */
.status-label {
  padding:3px 8px;
  border-radius:6px;
  font-size:12pt;
}
.status-registered {
  background:#f5f5f5;
  color:#424242;
}
.status-inprogress {
  background:#e3f2fd;
  color:#1565c0;
}
.status-ready {
  background:#fff8e1;
  color:#f9a825;
}
.status-delivered {
  background:#e8f5e9;
  color:#2e7d32;
}

.chart-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  margin-top: 20px;
}
.chart-box {
  width: 45%;
  min-width: 340px;
}

/* Ø®Ù„Ø§ØµÙ‡ ØªØ§ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡ (Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§) */
.summary-wrapper {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 10px 12px 14px;
  background: #e3f2fd;
  margin-bottom: 12px;
}

.summary-title {
  display: inline-block;
  background: #1976d2;
  color: #fff;
  padding: 4px 10px;
  border-radius: 8px;
  font-weight: bold;
  font-size: 15pt;
  margin-bottom: 10px;
}

.summary-row {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.summary-box {
  flex: 1 1 0;
  min-width: 220px;
  background: #ffffff;
  border-radius: 8px;
  padding: 10px 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  font-size: 13pt;
  color: #0d47a1;
}

.summary-box-title {
  font-weight: bold;
  margin-bottom: 6px;
  font-size: 14pt;
}


@media (max-width: 600px) {
  .field { flex: 1 1 100%; }
  .top-header {
    flex-direction: column;
    align-items: flex-start;
  }
  .top-bar {
    flex-wrap: wrap;
  }
}

/* === PRINT LAYOUT A4 PORTRAIT === */
@media print {
  body {
    margin: 0;
    padding: 0;
    background: white !important;
  }
  #mainMenu, .modal, .modal-overlay {
    display: none !important;
  }
  .print-container {
    width: 210mm !important;
    min-height: 297mm !important;
    margin: 0 auto !important;
    padding: 10mm !important;
    background: white !important;
    page-break-inside: avoid;
  }
  .print-order-block {
    page-break-after: always;
  }
  table {
    width: 100% !important;
    border-collapse: collapse !important;
  }
  table td, table th {
    border: 1px solid #ccc !important;
    padding: 6px !important;
    font-size: 12px !important;
  }
  /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú†Ø§Ù¾ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ø´ÙˆÙ†Ø¯ */
  .order-actions,
  .order-actions button,
  .customer-actions,
  .customer-actions button,
  .btn-print-customer-orders,
  .no-print {
    display: none !important;
  }
}

/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
</head>

<body>
<div class="container">

  <!-- Ù‡Ø¯Ø± -->
  <div class="top-header">
    <div class="top-title">Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</div>
    <div class="top-bar">
      <div class="top-bar-item">
        <span class="top-bar-item-label">Ú©Ø§Ø±Ø¨Ø±:</span>
        <span id="currentUserName" style="font-weight:bold;color:#e65100;">(ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡)</span>
        <span id="currentUserRoleLabel" style="font-size:12px;color:#0277bd;margin-right:8px;"></span>
        <button id="btnChangeUser" type="button" class="btn-small" style="margin-right:8px;">ØªØºÛŒÛŒØ± Ú©Ø§Ø±Ø¨Ø±</button>
      </div>
      <div class="top-bar-item">
        <span class="top-bar-item-label">ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª:</span>
        <input id="orderDateTime" type="text" placeholder="Ø§Ù…Ø±ÙˆØ²">
      </div>
      <div class="top-bar-item">
        <span class="top-bar-item-label">Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´:</span>
        <input id="orderNo" type="text" placeholder="AutoNumber">
      </div>
    </div>
  </div>

  <!-- Ù…Ù†Ùˆ + Ù…Ø´ØªØ±ÛŒ -->
  <div class="section">
    <div class="row">
      <div class="field" style="flex:1;">
        <div class="main-menu">
          <button type="button" data-page="orders" class="active">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
          <button type="button" data-page="reports">Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØª</button>
          <button type="button" data-page="customers">Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
          <button type="button" data-page="prices">ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§</button>
          <button type="button" id="btnOpenOrders" class="btn-open-orders">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²</button>
          <button type="button" id="btnCashFromBox">ØµÙ†Ø¯ÙˆÙ‚</button>
          <button type="button" data-page="users" id="btnUsersPage">Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</button>
          <button type="button" id="btnNewOrderTop" class="btn-new-top">Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯</button>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="field" style="flex:1.6;">
        <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ:</label>
        <input id="txtCustomerName" type="text" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ ÛŒØ§ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡">
      </div>
      <div class="field customer-actions" style="flex:0.8; justify-content:flex-start;">
        <button id="btnSearchCustomer" class="btn-search" type="button" title="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
        <button id="btnNewCustomer" class="btn-new-cust" type="button" title="Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯">â• Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ</button>
      </div>
      <div class="field" style="flex:1;">
        <label>Ø³Ø·Ø­ Ù‚ÛŒÙ…Øª Ø³ÙØ§Ø±Ø´:</label>
        <select id="orderPriceLevel">
          <option value="normal">Ø¹Ø§Ø¯ÛŒ</option>
          <option value="1">Ø³Ø·Ø­ Û±</option>
          <option value="2">Ø³Ø·Ø­ Û²</option>
          <option value="3">Ø³Ø·Ø­ Û³</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ù‡ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ -->
  <div id="pageOrders">

    <!-- Ø¬Ø¯ÙˆÙ„ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ -->
    <div class="section">
      <div class="section-title">
        Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´
        <button class="btn-add-row" type="button" id="btnAddItem">â• Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ø§Ù†ØªØ®Ø§Ø¨</th>
            <th>Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´</th>
            <th>ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡</th>
            <th>Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡</th>
            <th>ØªØ¹Ø¯Ø§Ø¯ / Ø³Ø±ÛŒ</th>
            <th>Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡</th>
            <th>Ø¬Ù…Ø¹ Ø±Ø¯ÛŒÙ</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody id="itemsBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="6">Ø¬Ù…Ø¹ Ú©Ù„ Ø³ÙØ§Ø±Ø´:</td>
            <td>
              <input type="text" id="orderTotal" class="money" readonly>
              <div id="courierCustomerInfo" class="hint" style="display:none;font-size:11px;color:#d32f2f;margin-top:4px;"></div>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø¯ÛŒÙ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ -->
    <div class="section">
      <div class="section-title">Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø¯ÛŒÙ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡</div>

      <div class="row">
        <div class="field">
          <label>ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡:</label>
          <input id="shortDesc" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø¬Ø²ÙˆÙ‡ Ø±ÛŒØ§Ø¶ÛŒØŒ Ø¢Ø²Ù…ÙˆÙ†ØŒ Ú©ØªØ§Ø¨ Ùˆ ...">
        </div>
      </div>

      <div class="section" style="margin-bottom:8px;">
        <div class="section-title">Ù…Ø´Ø®ØµØ§Øª Ø³ÙØ§Ø±Ø´</div>

        <div class="row">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´:</label>
            <select id="serviceType">
              <option selected>Ú©Ù¾ÛŒ</option>
              <option>Ù¾Ø±ÛŒÙ†Øª</option>
              <option>ÙÙ†Ø±ÛŒ</option>
              <option>Ù¾Ø±Ø³</option>
              <option>Ù…Ù†Ú¯Ù†Ù‡</option>
            </select>
          </div>
          <div class="field" id="fieldPaperSize">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="paperSize">
              <option selected>A4</option>
              <option>A5</option>
              <option>A3</option>
              <option>Ú©Ø§Ø±ØªÛŒ</option>
            </select>
          </div>
          <div class="field" id="fieldColor">
            <label>Ø±Ù†Ú¯:</label>
            <select id="colorMode">
              <option>Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯</option>
              <option>Ø±Ù†Ú¯ÛŒ</option>
            </select>
          </div>
          <div class="field" id="fieldColorCoverage">
            <label>Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯:</label>
            <select id="colorCoverage">
              <option value="50-70" selected>Ø¹Ø§Ø¯ÛŒ (Ø­Ø¯ÙˆØ¯ ÛµÛ°â€“Û·Û°Ùª)</option>
              <option value="0-50">Ú©Ù…â€ŒØ±Ù†Ú¯ (Û°â€“ÛµÛ°Ùª)</option>
              <option value="70-100">Ù¾Ø±Ø±Ù†Ú¯ (Û·Û°â€“Û±Û°Û°Ùª)</option>
            </select>
          </div>
          <div class="field" id="fieldPrintType">
            <label>Ù†ÙˆØ¹ Ú†Ø§Ù¾:</label>
            <select id="printType">
              <option>ÛŒÚ©â€ŒØ±Ùˆ</option>
              <option>Ø¯ÙˆØ±Ùˆ</option>
            </select>
          </div>
        </div>

        <!-- ÙÙ†Ø±ÛŒ Ù…Ø³ØªÙ‚Ù„ -->
        <div class="row hidden" id="bindingSpiralRow">
          <div class="field">
            <label>Ø³Ø§ÛŒØ² ÙÙ†Ø±:</label>
            <select id="bindingSpiralSize">
              <option value="18">ØªØ§ ÙÙ†Ø± Û±Û¸</option>
              <option value="20_30">ÙÙ†Ø± Û²Û° ØªØ§ Û³Û°</option>
              <option value="35_40">ÙÙ†Ø± Û³Ûµ ØªØ§ Û´Û°</option>
              <option value="40p">Ø¨ÛŒØ´ Ø§Ø² Û´Û°</option>
            </select>
            <div class="hint" id="bindingSpiralHint"></div>
          </div>
        </div>
        <div id="bindingCoverRowAnchorMain">
          <div class="row hidden" id="bindingCoverRow">
            <div class="field">
              <label>Ù†ÙˆØ¹ Ø·Ù„Ù‚:</label>
              <select id="bindingCover">
                <option value="Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚" selected>Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚</option>
                <option value="Ø´ÙØ§Ù">Ø·Ù„Ù‚ Ø´ÙØ§Ù</option>
                <option value="Ø¶Ø®ÛŒÙ…">Ø·Ù„Ù‚ Ø¶Ø®ÛŒÙ…</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row hidden" id="bindingJobTypeRow">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú©Ø§Ø±:</label>
            <div class="radio-row">
              <input type="radio" name="bindingJobType" id="bindJobBooklet" value="Ø¬Ø²ÙˆÙ‡" checked>
              <label for="bindJobBooklet">Ø¬Ø²ÙˆÙ‡</label>
              <input type="radio" name="bindingJobType" id="bindJobBook" value="Ú©ØªØ§Ø¨">
              <label for="bindJobBook">Ú©ØªØ§Ø¨</label>
            </div>
          </div>
        </div>

        <div class="hint" id="pagesHint">
          Ø¯Ø± Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ã— ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ = Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯.
        </div>
        <div class="row">
          <div class="field" id="fieldPagesPerSet">
            <label id="labelPagesPerSet">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:</label>
            <input id="pagesPerSet" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 20">
          </div>
          <div class="field" id="fieldSetCount">
            <label id="labelSetCount">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ / Ø¬Ø²ÙˆÙ‡:</label>
            <input id="setCount" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 5">
          </div>
          <div class="field" id="fieldTotalPages">
            <label id="labelTotalPages">Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯:</label>
            <input id="totalPages" type="text" readonly placeholder="Ù†ØªÛŒØ¬Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±">
          </div>
        </div>

        <div class="row">
          <div class="field" id="fieldPaperType">
            <label>Ù†ÙˆØ¹ Ú©Ø§ØºØ°:</label>
            <select id="paperType">
              <option>ØªØ­Ø±ÛŒØ±</option>
              <option>Ú¯Ù„Ø§Ø³Ù‡</option>
              <option>Ø´ÙˆÙ…ÛŒØ²</option>
            </select>
          </div>
          <div class="field" id="paperWeightField">
            <label>Ú¯Ø±Ù…Ø§Ú˜:</label>
            <select id="paperWeight">
              <option value="80">Û¸Û°</option>
              <option value="135">Û±Û³Ûµ</option>
              <option value="200">Û²Û°Û°</option>
              <option value="250">Û²ÛµÛ°</option>
            </select>
          </div>
        </div>

        <!-- Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡ -->
        <div class="row" id="extraSection">
          <div class="radio-row">
            <label>Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡:</label>

            <input type="checkbox" id="extraBinding">
            <label for="extraBinding">ÙÙ†Ø±ÛŒ</label>

            <input type="checkbox" id="extraStaple">
            <label for="extraStaple">Ù…Ù†Ú¯Ù†Ù‡</label>

            <input type="checkbox" id="extraCourier">
            <label for="extraCourier">Ù¾ÛŒÚ©</label>
          </div>
          <div id="bindingCoverRowAnchorExtra"></div>
        </div>
        <div class="row hidden" id="extraBindingHintRow">
          <div class="field">
            <label>Ø³Ø§ÛŒØ² ÙÙ†Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</label>
            <div class="hint" id="extraBindingSpiralHint">â€”</div>
          </div>
        </div>

        <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒÚ© -->
        <div class="row hidden" id="courierRow">
          <div class="field">
            <label>Ù¾ÛŒÚ©:</label>
            <div class="radio-row">
              <input type="radio" name="courierWho" id="courierByCustomer" value="customer" checked>
              <label for="courierByCustomer">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ</label>
              <input type="radio" name="courierWho" id="courierByShop" value="shop">
              <label for="courierByShop">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ø§</label>
            </div>
          </div>
          <div class="field">
            <label>Ù…Ø¨Ù„Øº Ù¾ÛŒÚ©:</label>
            <input id="courierAmount" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 30,000">
          </div>
        </div>

      </div>

      <div class="section" style="margin-bottom:8px;">
        <div class="section-title">Ù‚ÛŒÙ…Øª Ø§ÛŒÙ† Ø±Ø¯ÛŒÙ</div>
        <div class="row">
          <div class="field">
            <label id="priceMainLabel">Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯:</label>
            <div style="display:flex; gap:8px; align-items:center;">
              <input id="priceMain" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1,000">
              <button id="btnSuggestPrice" type="button" class="btn-small">Ø§Ø² ØªØ¹Ø±ÙÙ‡</button>
            </div>
          </div>
          <div class="field hidden" id="priceBindingField">
            <label>Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:</label>
            <input id="priceBinding" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 8,000">
          </div>
          <div class="field hidden" id="priceStapleField">
            <label>Ù‚ÛŒÙ…Øª Ù…Ù†Ú¯Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:</label>
            <input id="priceStaple" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 500">
          </div>
        </div>

        <div class="row" id="rowPricePerSet">
          <div class="field">
            <label>Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡ (Ú†Ø§Ù¾+Ø§Ø¶Ø§ÙØ§Øª):</label>
            <input id="pricePerSet" type="text" class="money" readonly>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Ø¬Ù…Ø¹ Ø§ÛŒÙ† Ø±Ø¯ÛŒÙ:</label>
            <input id="rowTotal" type="text" class="money" readonly>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <button type="button" class="btn-detail-apply" id="btnApplyToRow">Ø«Ø¨Øª Ø±ÙˆÛŒ Ø±Ø¯ÛŒÙ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡</button>
          </div>
        </div>
      </div>

      <div class="section" id="fileSection">
        <div class="section-title">ÙØ§ÛŒÙ„ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª</div>
        <div class="row">
          <div class="field">
            <label>Ù†Ø­ÙˆÙ‡ Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„:</label>
            <select id="receiveMethod">
              <option>Ø­Ø¶ÙˆØ±ÛŒ</option>
              <option>ØªÙ„Ú¯Ø±Ø§Ù…</option>
              <option>Ø§ÛŒØªØ§</option>
              <option>ÙˆØ§ØªØ³Ø§Ù¾</option>
              <option>Ø§ÛŒÙ…ÛŒÙ„</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
            <textarea id="notes"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ -->
    <div class="section">
      <div class="section-title">ÙˆØ¶Ø¹ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ùˆ ØªØ­ÙˆÛŒÙ„ Ø³ÙØ§Ø±Ø´</div>
      <div class="row">
        <div class="field" style="flex:1;">
          <label>ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´:</label>
          <span id="orderStatusText" class="status-label status-registered">Ø«Ø¨Øª Ø´Ø¯Ù‡</span>
          <input type="hidden" id="orderStatusHidden" value="registered">
        </div>
      </div>
      <div class="row">
        <div class="field" style="gap:8px; flex:3;">
          <button type="button" id="btnStatusDelivered" class="btn-small btn-status">
            Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ Ùˆ ØªØ­ÙˆÛŒÙ„ Ø´Ø¯
          </button>
          <button type="button" id="btnStatusReady" class="btn-small btn-status">
            Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ (Ø¢Ù…Ø§Ø¯Ù‡ØŒ ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡)
          </button>
          <button type="button" id="btnStatusInProgress" class="btn-small btn-status">
            Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…
          </button>
        </div>
        <div class="field" style="flex:1; justify-content:flex-end;">
          <label style="min-width:auto;">
            <input type="checkbox" id="carryToTomorrow">
            Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ÙØ±Ø¯Ø§
          </label>
        </div>
      </div>
    </div>

    <!-- Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù„ Ø³ÙØ§Ø±Ø´ -->
    <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… -->
    <div class="section hidden" id="inProgressNoteSection">
      <div class="section-title">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø§Ø± <span style="color:#e53935;">*</span></div>
      <div class="hint">Ø§Ú¯Ø± ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø±Ø§ Â«Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…Â» Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ Ø«Ø¨Øª Ø§ÛŒÙ† ØªÙˆØ¶ÛŒØ­ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.</div>
      <div class="row">
        <div class="field">
          <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª:</label>
          <textarea id="inProgressNote" placeholder="Ù…Ø«Ù„Ø§Ù‹ ÙÙ†Ø±ÛŒ Ù…Ø§Ù†Ø¯Ù‡ØŒ ÙØ§ÛŒÙ„ Ø¯ÙˆÙ… Ù…Ø§Ù†Ø¯Ù‡ØŒ ..."></textarea>
        </div>
      </div>
    </div>


    <div class="section">
      <div class="section-title">Ù¾Ø±Ø¯Ø§Ø®Øª</div>
      <div class="row">
        <div class="field">
          <label>Ù†Ø­ÙˆÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
          <select id="orderPaymentType">
            <option>Ù†Ù‚Ø¯ÛŒ</option>
            <option>Ù¾ÙˆØ²</option>
            <option>Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª</option>
            <option>Ù†Ø³ÛŒÙ‡</option>
          </select>
        </div>
        <div class="field">
          <label>Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ:</label>
          <input id="orderPaid" type="text" class="money" value="0">
        </div>
        <div class="field">
          <label>Ù…Ø§Ù†Ø¯Ù‡:</label>
          <input id="orderBalance" type="text" class="money" readonly>
        </div>
      </div>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
    <div class="buttons">
      <button class="btn-new"  type="button" id="btnNewOrder">Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯</button>
      <button class="btn-save" type="button" id="btnSaveOrder">Ø°Ø®ÛŒØ±Ù‡</button>
      <button class="btn-print" type="button" id="btnPrintReceipt">Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯</button>
      <button class="btn-today" type="button" id="btnReportToday">Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²</button>
      <button class="btn-close" type="button" id="btnClose">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

<!-- ØµÙØ­Ù‡ Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
<div id="pageReports" class="hidden">

  <!-- Ø®Ù„Ø§ØµÙ‡ ØªØ§ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡ -->
<div class="summary-wrapper">
  <div class="summary-title">Ø®Ù„Ø§ØµÙ‡ ØªØ§ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡</div>

  <div class="summary-row">

    <!-- Ø¨Ø§Ú©Ø³ Ø§Ù…Ø±ÙˆØ² -->
    <div class="summary-box">
      <div class="summary-box-title">Ø§Ù…Ø±ÙˆØ²</div>
      <div>Ø¬Ù…Ø¹ Ø³ÙØ§Ø±Ø´Ø§Øª: <span id="sumTodayTotal"></span></div>
      <div>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <span id="sumTodayPaid"></span></div>
      <div>Ø¬Ù…Ø¹ Ù…Ø§Ù†Ø¯Ù‡:   <span id="sumTodayBalance"></span></div>
      <div>Ù¾Ø±ØªÛŒ Ø±ÙˆØ²:    <span id="sumTodayWaste"></span></div>
      <div>Ù…ØºØ§ÛŒØ±Øª Ø±ÙˆØ²:  <span id="sumTodayDisc"></span></div>
    </div>

    <!-- Ø¨Ø§Ú©Ø³ Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ù‡ÙØªÙ‡ -->
    <div class="summary-box">
      <div class="summary-box-title">Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ù‡ÙØªÙ‡</div>
      <div>Ø¬Ù…Ø¹ Ø³ÙØ§Ø±Ø´Ø§Øª: <span id="sumWeekTotal"></span></div>
      <div>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <span id="sumWeekPaid"></span></div>
      <div>Ø¬Ù…Ø¹ Ù…Ø§Ù†Ø¯Ù‡:   <span id="sumWeekBalance"></span></div>
      <div>Ø¬Ù…Ø¹ Ù¾Ø±ØªÛŒ:    <span id="sumWeekWaste"></span></div>
      <div>Ø¬Ù…Ø¹ Ù…ØºØ§ÛŒØ±Øª:  <span id="sumWeekDisc"></span></div>
    </div>

    <!-- Ø¨Ø§Ú©Ø³ Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ù…Ø§Ù‡ -->
    <div class="summary-box">
      <div class="summary-box-title">Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ù…Ø§Ù‡</div>
      <div>Ø¬Ù…Ø¹ Ø³ÙØ§Ø±Ø´Ø§Øª: <span id="sumMonthTotal"></span></div>
      <div>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <span id="sumMonthPaid"></span></div>
      <div>Ø¬Ù…Ø¹ Ù…Ø§Ù†Ø¯Ù‡:   <span id="sumMonthBalance"></span></div>
      <div>Ø¬Ù…Ø¹ Ù¾Ø±ØªÛŒ:    <span id="sumMonthWaste"></span></div>
      <div>Ø¬Ù…Ø¹ Ù…ØºØ§ÛŒØ±Øª:  <span id="sumMonthDisc"></span></div>
    </div>

  </div>
</div>



  <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ -->
  <div class="section">
    <div class="section-title">Ù†ÙˆØ¹ Ú¯Ø²Ø§Ø±Ø´</div>
    <div style="display:flex; gap:10px; margin-bottom:15px;">
      <button id="tabOrdersReport" class="btn-small" style="background:#1976d2;color:#fff;">Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª</button>
      <button id="tabCashPaymentsReport" class="btn-small" style="background:#43a047;color:#fff;">Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚</button>
      <button id="tabCustomerBalanceReport" class="btn-small" style="background:#ff9800;color:#fff;">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
      <button id="tabCustomersReport" class="btn-small" style="background:#9c27b0;color:#fff;">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
    </div>
  </div>

  <!-- ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® Ù…Ø´ØªØ±Ú© -->
  <div class="section">
    <div class="section-title">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ú¯Ø²Ø§Ø±Ø´</div>
    <div class="row">
      <div class="field">
        <label>Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
        <input id="globalRepFrom" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1403/08/01">
      </div>
      <div class="field">
        <label>ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
        <input id="globalRepTo" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1403/08/30">
      </div>
    </div>
    <div class="hint">
      ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1403/08/10).
      Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø±ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>
  </div>

  <!-- ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª -->
  <div id="ordersReportSection" class="section">
    <div class="section-title">ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª</div>
    <div class="row">
      <div class="field">
        <label>Ú©Ø§Ø±Ø¨Ø±:</label>
        <select id="repUser">
          <option value="">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>
        </select>
      </div>
      <div class="field">
        <label>Ù…Ø´ØªØ±ÛŒ:</label>
        <input id="repCustomer" type="text" placeholder="Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
      </div>
      <div class="field">
        <label>Ù…Ø­ØµÙˆÙ„:</label>
        <select id="repProduct">
          <option value="">Ù‡Ù…Ù‡</option>
          <option value="copy">Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯</option>
          <option value="print">Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯</option>
          <option value="color">Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ</option>
          <option value="binding">ÙÙ†Ø±ÛŒ</option>
          <option value="staple">Ù…Ù†Ú¯Ù†Ù‡</option>
          <option value="lamination">Ù¾Ø±Ø³</option>
        </select>
      </div>
    </div>

    <!-- Ø§ÛŒÙ†Ø¬Ø§ Ø²ÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ (Ø³Ø§ÛŒØ²ØŒ Ù†ÙˆØ¹ Ú†Ø§Ù¾ØŒ ...) Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
    <div id="repProductSubFilters"></div>

    <div class="row">
      <div class="field" style="flex:0 0 auto;">
        <button id="btnRunReport" type="button"
                class="btn-small"
                style="background:#1976d2;color:#fff;">
          Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú¯Ø²Ø§Ø±Ø´
        </button>
      </div>
      <div class="field" style="flex:0 0 auto;">
        <button id="btnPrintOrdersReport" type="button"
                class="btn-small"
                style="background:#1976d2;color:#fff;">
          ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´
        </button>
      </div>
    </div>
    <div class="hint">
      ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1403/08/10).
      Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø±ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>

    <!-- Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„ -->
    <div id="productSummarySection" class="section">
      <div class="section-title" id="reportTableTitle">Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„ (Ø¨Ø± Ø§Ø³Ø§Ø³ ÙÛŒÙ„ØªØ±)</div>
      <table>
        <thead>
          <tr>
            <th>Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡</th>
            <th>ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙ</th>
            <th>Ù…Ø¬Ù…ÙˆØ¹ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„</th>
            <th>Ø¬Ù…Ø¹ Ú©Ù„ (Ø±ÛŒØ§Ù„)</th>
            <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
          </tr>
        </thead>
        <tbody id="productSummaryBody"></tbody>
      </table>
    </div>

    <!-- Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ -->
    <div id="productOrdersSection" class="section" style="display: none;">
      <div class="section-title">Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„</div>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>ØªØ§Ø±ÛŒØ®</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´</th>
            <th>Ù…Ø´ØªØ±ÛŒ</th>
            <th>Ú©Ø§Ø±Ø¨Ø±</th>
            <th>ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„)</th>
          </tr>
        </thead>
        <tbody id="productOrdersBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ -->
  <div id="cashPaymentsReportSection" class="section" style="display:none;">
    <div class="section-title">ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚</div>
    <div class="row">
      <div class="field">
        <label>Ú©Ø§Ø±Ø¨Ø±:</label>
        <select id="cashRepUser">
          <option value="">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>
        </select>
      </div>
      <div class="field">
        <label>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
        <select id="cashRepMethod">
          <option value="">Ù‡Ù…Ù‡ Ø±ÙˆØ´â€ŒÙ‡Ø§</option>
          <option value="cash">Ù†Ù‚Ø¯ÛŒ</option>
          <option value="office_card">Ú©Ø§Ø±Øª Ø¯ÙØªØ±</option>
          <option value="personal_card">Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒ</option>
          <option value="bank_transfer">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ</option>
          <option value="other">Ø³Ø§ÛŒØ±</option>
        </select>
      </div>
      <div class="field">
        <label>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
        <select id="cashRepType">
          <option value="">Ù‡Ù…Ù‡ Ø§Ù†ÙˆØ§Ø¹</option>
          <option value="cost">Ù‡Ø²ÛŒÙ†Ù‡</option>
          <option value="peyk">Ù¾ÛŒÚ©</option>
          <option value="refund">Ø¨Ø±Ú¯Ø´Øª ÙˆØ¬Ù‡</option>
          <option value="customer_debt">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ</option>
          <option value="supplier">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡</option>
          <option value="manager_payment">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø¯ÛŒØ±</option>
          <option value="owner_draw">Ø¨Ø±Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ</option>
          <option value="other">Ø³Ø§ÛŒØ±</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="field" style="flex:0 0 auto;">
        <button id="btnRunCashReport" type="button"
                class="btn-small"
                style="background:#43a047;color:#fff;">
          Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
        </button>
      </div>
      <div class="field" style="flex:0 0 auto;">
        <button id="btnPrintCashReport" type="button"
                class="btn-small"
                style="background:#43a047;color:#fff;">
          ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´
        </button>
      </div>
    </div>
    <div class="hint">
      ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1403/08/10).
      Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø±ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>
  </div>

  <!-- ğŸ”¼ Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡ (Ø¢ÙˆØ±Ø¯Ù‡ Ø´Ø¯ Ø¨Ø§Ù„Ø§ÛŒ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§) -->
  <div class="section">
    <div class="section-title">Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡ Ø¯Ø± Ø¨Ø§Ø²Ù‡Ù” Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡</div>
    <table class="product-summary-table">
      <thead>
        <tr>
          <th>Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡</th>
          <th>ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙ</th>
          <th>Ù…Ø¬Ù…ÙˆØ¹ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„</th> <!-- Ø§ÛŒÙ† Ù‡Ù…ÙˆÙ† Ù…Ø¬Ù…ÙˆØ¹ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯ Ù‡Ø³Øª -->
          <th>Ø¬Ù…Ø¹ Ú©Ù„ (Ø±ÛŒØ§Ù„)</th>
          <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
        </tr>
      </thead>
      <tbody id="productSummaryBody"></tbody>
    </table>
  </div>


  <!-- Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ -->
  <div id="cashPaymentsReportContainer" class="section" style="display:none;">
    <div class="section-title">Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚</div>

    <!-- Ø®Ù„Ø§ØµÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ -->
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-bottom:20px;">
      <div class="summary-box">
        <div class="summary-box-title">Ù†Ù‚Ø¯ÛŒ</div>
        <div id="cashTotal">0</div>
      </div>
      <div class="summary-box">
        <div class="summary-box-title">Ú©Ø§Ø±Øª Ø¯ÙØªØ±</div>
        <div id="officeCardTotal">0</div>
      </div>
      <div class="summary-box">
        <div class="summary-box-title">Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒ</div>
        <div id="personalCardTotal">0</div>
      </div>
      <div class="summary-box">
        <div class="summary-box-title">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ</div>
        <div id="bankTransferTotal">0</div>
      </div>
      <div class="summary-box">
        <div class="summary-box-title">Ø³Ø§ÛŒØ±</div>
        <div id="otherPaymentsTotal">0</div>
      </div>
      <div class="summary-box" style="background:#e3f2fd;">
        <div class="summary-box-title">Ø¬Ù…Ø¹ Ú©Ù„</div>
        <div id="grandTotal" style="font-weight:bold;">0</div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ -->
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ØªØ§Ø±ÛŒØ®</th>
          <th>Ú©Ø§Ø±Ø¨Ø±</th>
          <th>Ù…Ø¨Ù„Øº</th>
          <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
          <th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
          <th>Ø·Ø±Ù Ø­Ø³Ø§Ø¨</th>
          <th>Ø¨Ø§Ø¨Øª</th>
        </tr>
      </thead>
      <tbody id="cashPaymentsReportBody"></tbody>
    </table>
  </div>

  <!-- Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
  <div id="customerBalanceReportContainer" class="section" style="display:none;">
    <div class="section-title">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>

    <!-- ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† -->

    <div class="row">
      <div class="field">
        <button id="btnRunCustomerBalanceReport" type="button"
                class="btn-small"
                style="background:#ff9800;color:#fff;">
          Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
        </button>
      </div>
      <div class="field">
        <button id="btnPrintCustomerBalanceReport" type="button"
                class="btn-small"
                style="background:#1976d2;color:#fff;">
          ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´
        </button>
      </div>
    </div>

    <div class="hint">
      ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1403/08/10).
      Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø±ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>

    <!-- Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:15px; margin:20px 0;">
      <div class="summary-box" style="background:#fff3e0;">
        <div class="summary-box-title">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡</div>
        <div id="customersWithBalanceCount">0</div>
      </div>
      <div class="summary-box" style="background:#ffebee;">
        <div class="summary-box-title">Ø¬Ù…Ø¹ Ú©Ù„ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
        <div id="totalCustomerBalance">0</div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ù…Ø´ØªØ±ÛŒ</th>
          <th>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
          <th>Ø¬Ù…Ø¹ Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª</th>
          <th>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
          <th>Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„</th>
          <th>ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´</th>
        </tr>
      </thead>
      <tbody id="customerBalanceReportBody"></tbody>
    </table>
  </div>

  <!-- Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
  <div id="customersReportContainer" class="section" style="display:none;">
    <div class="section-title">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡</div>

    <!-- ÙÛŒÙ„ØªØ± Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
    <div class="row">
      <div class="field">
        <label>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ:</label>
        <input id="customersRepSearch" type="text" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø¢Ù†">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <button id="btnRunCustomersReport" type="button"
                class="btn-small"
                style="background:#9c27b0;color:#fff;">
          Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
        </button>
      </div>
      <div class="field">
        <button id="btnPrintCustomersReport" type="button"
                class="btn-small"
                style="background:#1976d2;color:#fff;">
          ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´
        </button>
      </div>
    </div>

    <div class="hint">
      ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1403/08/10).
      Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø±ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>

    <!-- Ø®Ù„Ø§ØµÙ‡ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin:20px 0;">
      <div class="summary-box" style="background:#f3e5f5;">
        <div class="summary-box-title">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
        <div id="totalCustomersCount">0</div>
      </div>
      <div class="summary-box" style="background:#e1f5fe;">
        <div class="summary-box-title">Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª</div>
        <div id="totalCustomersOrders">0</div>
      </div>
      <div class="summary-box" style="background:#e8f5e8;">
        <div class="summary-box-title">Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„ ÙØ±ÙˆØ´</div>
        <div id="totalCustomersSales">0</div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ù…Ø´ØªØ±ÛŒ</th>
          <th>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
          <th>Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ´</th>
          <th>Ù…Ø¬Ù…ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
          <th>Ù…Ø§Ù†Ø¯Ù‡</th>
          <th>Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´</th>
          <th>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="customersReportBody"></tbody>
    </table>
  </div>

</div>


  </div>


  <!-- ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† -->
  <div id="pageCustomers" class="hidden">

    <div class="section">
      <div class="section-title">Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
      <div class="row">
        <div class="field" style="flex:1.2;">
          <label>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ:</label>
          <input id="custAccSearch" type="text" placeholder="Ù†Ø§Ù… / ØªÙ„ÙÙ† / Ú©Ø¯ Ù…Ø´ØªØ±ÛŒ">
        </div>
        <div class="field" style="flex:0.4; align-items:center;">
          <label style="display:flex; align-items:center; gap:6px;">
            <input id="custAccOnlyDebtors" type="checkbox">
            ÙÙ‚Ø· Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†
          </label>
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:0.6;">
          <label>Ø§Ø² ØªØ§Ø±ÛŒØ® (Ø¬Ù„Ø§Ù„ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ø¯Ø¯ÛŒ):</label>
          <input id="custAccFromDate" type="text" placeholder="Ù…Ø«Ø§Ù„: 1404/09/01">
        </div>
        <div class="field" style="flex:0.6;">
          <label>ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
          <input id="custAccToDate" type="text" placeholder="Ù…Ø«Ø§Ù„: 1404/09/30">
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:1;">
          <label>Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ Ø¯ÙˆØ±Ù‡:</label>
          <div style="display:flex; flex-wrap:wrap; gap:12px; font-size:13px;">
            <span>Ø¬Ù…Ø¹ ÙØ±ÙˆØ´: <strong id="custAccSummarySales">0</strong> Ø±ÛŒØ§Ù„</span>
            <span>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®Øª: <strong id="custAccSummaryPaid">0</strong> Ø±ÛŒØ§Ù„</span>
            <span>Ø¬Ù…Ø¹ Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ: <strong id="custAccSummaryBalance">0</strong> Ø±ÛŒØ§Ù„</span>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">
        Ù„ÛŒØ³Øª Ù…Ø´ØªØ±ÛŒØ§Ù†
      </div>
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</th>
              <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
              <th>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
              <th>Ø¬Ù…Ø¹ ÙØ±ÙˆØ´</th>
              <th>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th>Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ</th>
              <th>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="customerAccountsBody">
            <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
          </tbody>
        </table>
      </div>
    </div>

  </div>



  <!-- ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
  

<div id="pageUsers" class="hidden">
  <div class="page-section users-layout">

    <div class="users-header">
      <div>
        <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
        <p class="page-subtitle">
          Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ… Ùˆ Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¢Ù†Ù‡Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯.
          ÙÙ‚Ø· <strong>Ù…Ø¯ÛŒØ±</strong> Ø§Ù…Ú©Ø§Ù† Ø§ÙØ²ÙˆØ¯Ù†ØŒ Ø­Ø°Ù Ùˆ ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ Ø¯Ø§Ø±Ø¯.
        </p>
      </div>
      <div class="role-badges">
        <span class="role-badge admin">Ù…Ø¯ÛŒØ± (admin)</span>
        <span class="role-badge supervisor">Ø³Ø±Ù¾Ø±Ø³Øª (supervisor)</span>
        <span class="role-badge cashier">ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø± (cashier)</span>
      </div>
    </div>

    <!-- ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† / ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± -->
    <div class="card" id="userAddSection">
      <h3 id="userFormTitle">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
      <div class="form-status" id="userFormStatus">
        Ø­Ø§Ù„Øª: Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
      </div>

      <div class="form-grid">
        <div class="form-row">
          <label for="newUserFullName">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
          <input type="text" id="newUserFullName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
        </div>
        <div class="form-row">
          <label for="newUserUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
          <input type="text" id="newUserUsername" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯">
        </div>
        <div class="form-row">
          <label for="newUserPassword">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
          <input type="password" id="newUserPassword" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§ÙˆÙ„ÛŒÙ‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
        </div>
        <div class="form-row">
          <label for="newUserRole">Ù†Ù‚Ø´</label>
          <select id="newUserRole">
            <option value="cashier">ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±</option>
            <option value="supervisor">Ø³Ø±Ù¾Ø±Ø³Øª</option>
            <option value="admin">Ù…Ø¯ÛŒØ±</option>
          </select>
        </div>
      </div>

      <input type="hidden" id="editingUserId" value="">

      <div class="form-actions">
        <button type="button" class="btn-secondary" id="btnCancelEdit">Ø§Ù†ØµØ±Ø§Ù</button>
        <button type="button" class="btn-primary" id="btnAddUser">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±</button>
      </div>
    </div>

    <!-- Ø³Ú©Ø´Ù† ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± -->
    <div class="card role-change-card hidden" id="roleChangeSection">
      <h3>ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±</h3>
      <div class="form-status" id="roleChangeStatus">
        Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.
      </div>

      <div class="form-grid">
        <div class="form-row">
          <label for="roleChangeSelect">Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯</label>
          <select id="roleChangeSelect">
            <option value="cashier">ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±</option>
            <option value="supervisor">Ø³Ø±Ù¾Ø±Ø³Øª</option>
            <option value="admin">Ù…Ø¯ÛŒØ±</option>
          </select>
        </div>
      </div>

      <input type="hidden" id="roleChangeUserId" value="">

      <div class="form-actions">
        <button type="button" class="btn-secondary" id="btnCancelRoleChange">Ø§Ù†ØµØ±Ø§Ù</button>
        <button type="button" class="btn-primary" id="btnSaveRoleChange">Ø«Ø¨Øª Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯</button>
      </div>
    </div>

    <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
    <div class="card">
      <h3>Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Ù†Ø§Ù… Ú©Ø§Ù…Ù„</th>
              <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
              <th>Ù†Ù‚Ø´</th>
              <th>ÙˆØ¶Ø¹ÛŒØª</th>
              <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody id="usersTableBody">
            <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>



  <!-- ØµÙØ­Ù‡ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ -->
  <div id="pagePrices" class="hidden">
<style>
#pagePrices *{
      box-sizing: border-box;
    }
#pagePrices body{
      margin: 0;
      padding: 20px;
      background: #f4f7fb;
      font-family: "B Homa", Tahoma, sans-serif;
      direction: rtl;
    }
#pagePrices .tariff-container{
      max-width: 1100px;
      margin: 0 auto;
      background: #ffffff;
      padding: 16px 22px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.12);
      font-family: "B Homa", Tahoma, sans-serif;
    }
#pagePrices .tariff-title{
      background: #1976d2;
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      text-align: center;
      font-size: 18pt;
      margin-bottom: 15px;
    }
#pagePrices .tariff-buttons{
      display: flex;
      gap: 10px;
      margin-bottom: 18px;
      justify-content: flex-start;
    }
#pagePrices .tariff-buttons button{
      padding: 8px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #1976d2;
      color: white;
      font-size: 13pt;
      transition: 0.2s;
      font-family: "B Homa", Tahoma, sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
#pagePrices .tariff-buttons button:hover{
      background: #125ea9;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
#pagePrices .tariff-buttons #btnResetTariffs{
      background: #fb8c00;
    }
#pagePrices .tariff-buttons #btnResetTariffs:hover{
      background: #ef6c00;
    }
#pagePrices .tariff-section{
      background: #ffffff;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #d0d7e2;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      font-family: "B Homa", Tahoma, sans-serif;
    }
#pagePrices .tariff-section-title{
      background: #e3f2fd;
      color: #0d47a1;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 15pt;
      margin-bottom: 10px;
      display: inline-block;
    }
#pagePrices .tariff-hint{
      font-size: 11pt;
      color: #546e7a;
      margin-bottom: 6px;
    }
#pagePrices .tariff-table{
      width: 100%;
      border-collapse: collapse;
      font-size: 12.5pt;
      margin-top: 6px;
      font-family: "B Homa", Tahoma, sans-serif;
    }
#pagePrices .tariff-table th{
      background: #bbdefb;
      color: #0d47a1;
      padding: 8px;
      border: 1px solid #cbd5e1;
      text-align: center;
      white-space: nowrap;
    }
#pagePrices .tariff-table td{
      border: 1px solid #d0d7e2;
      padding: 6px;
      text-align: center;
    }
#pagePrices .tariff-table td[contenteditable="true"]{
      background: #f4faff;
      cursor: text;
      min-width: 70px;
    }
#pagePrices .tariff-table td[contenteditable="true"]:hover{
      background: #e7f1ff;
    }
#pagePrices .tariff-table td[contenteditable="true"]:focus{
      outline: none;
      background: #dbe9ff;
    }
@media (max-width: 768px){
      .tariff-container {
        padding: 12px 10px 18px;
      }
#pagePrices .tariff-table{
        font-size: 11pt;
      }
#pagePrices .tariff-buttons{
        flex-wrap: wrap;
      }

/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
<div class="tariff-container">

    <h2 class="tariff-title">Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ - Ø¯ÙØªØ± ÙÙ†ÛŒ Â«Ù‚Ù„Ù…Â»</h2>

    <div class="tariff-buttons">
      <button id="btnSaveTariffs">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§</button>
      <button id="btnLoadTariffs">ğŸ“¥ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§</button>
      <button id="btnResetTariffs">â†© Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ù…ÙˆÙ†Ù‡</button>
      <button id="btnShowCostPrices">ğŸ’° Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡</button>
      <button id="btnShowGeneralCosts">ğŸ“š Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ</button>
    </div>

    <!-- ===================== Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯ (Ø¯ÙˆØ±Ùˆ Ù…Ø¨Ù†Ø§) ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ¹Ø±ÙÙ‡ Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯ (Ø¯ÙˆØ±ÙˆØŒ ØªØ­Ø±ÛŒØ± Û¸Û° Ú¯Ø±Ù…)</div>
      <div class="tariff-hint">
        Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¨Ø±Ú¯ <b>Ø¯ÙˆØ±Ùˆ</b> Ù‡Ø³ØªÙ†Ø¯. Ø§Ú¯Ø± Ú†Ø§Ù¾ ÛŒÚ©â€ŒØ±Ùˆ Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Â«ØªØ®ÙÛŒÙ ÛŒÚ©â€ŒØ±Ùˆ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯Â» Ù…Ø¨Ù„ØºÛŒ Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¨Ø±Ú¯ Ú©Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="bw">
        <thead>
          <tr>
            <th>Ø³Ø§ÛŒØ²</th>
            <th>Ø¨Ø§Ø²Ù‡ ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <!-- A5 -->
          <tr><td>A5</td><td>1â€“20</td>   <td contenteditable="true">700</td><td contenteditable="true">600</td><td contenteditable="true">550</td><td contenteditable="true">500</td></tr>
          <tr><td>A5</td><td>21â€“50</td>  <td contenteditable="true">650</td><td contenteditable="true">550</td><td contenteditable="true">500</td><td contenteditable="true">450</td></tr>
          <tr><td>A5</td><td>51â€“100</td> <td contenteditable="true">600</td><td contenteditable="true">520</td><td contenteditable="true">470</td><td contenteditable="true">430</td></tr>
          <tr><td>A5</td><td>101â€“200</td><td contenteditable="true">550</td><td contenteditable="true">480</td><td contenteditable="true">430</td><td contenteditable="true">400</td></tr>
          <tr><td>A5</td><td>201â€“500</td><td contenteditable="true">500</td><td contenteditable="true">440</td><td contenteditable="true">400</td><td contenteditable="true">370</td></tr>
          <tr><td>A5</td><td>501â€“1000</td><td contenteditable="true">450</td><td contenteditable="true">400</td><td contenteditable="true">370</td><td contenteditable="true">350</td></tr>
          <tr><td>A5</td><td>1001+</td> <td contenteditable="true">400</td><td contenteditable="true">360</td><td contenteditable="true">340</td><td contenteditable="true">320</td></tr>

          <!-- A4 -->
          <tr><td>A4</td><td>1â€“20</td>   <td contenteditable="true">1000</td><td contenteditable="true">900</td><td contenteditable="true">800</td><td contenteditable="true">700</td></tr>
          <tr><td>A4</td><td>21â€“50</td>  <td contenteditable="true">900</td><td contenteditable="true">820</td><td contenteditable="true">730</td><td contenteditable="true">650</td></tr>
          <tr><td>A4</td><td>51â€“100</td> <td contenteditable="true">850</td><td contenteditable="true">770</td><td contenteditable="true">690</td><td contenteditable="true">620</td></tr>
          <tr><td>A4</td><td>101â€“200</td><td contenteditable="true">800</td><td contenteditable="true">730</td><td contenteditable="true">660</td><td contenteditable="true">600</td></tr>
          <tr><td>A4</td><td>201â€“500</td><td contenteditable="true">750</td><td contenteditable="true">690</td><td contenteditable="true">630</td><td contenteditable="true">580</td></tr>
          <tr><td>A4</td><td>501â€“1000</td><td contenteditable="true">700</td><td contenteditable="true">650</td><td contenteditable="true">600</td><td contenteditable="true">560</td></tr>
          <tr><td>A4</td><td>1001+</td> <td contenteditable="true">650</td><td contenteditable="true">610</td><td contenteditable="true">570</td><td contenteditable="true">540</td></tr>

          <!-- A3 -->
          <tr><td>A3</td><td>1â€“20</td>   <td contenteditable="true">2000</td><td contenteditable="true">1800</td><td contenteditable="true">1650</td><td contenteditable="true">1500</td></tr>
          <tr><td>A3</td><td>21â€“50</td>  <td contenteditable="true">1900</td><td contenteditable="true">1700</td><td contenteditable="true">1550</td><td contenteditable="true">1450</td></tr>
          <tr><td>A3</td><td>51â€“100</td> <td contenteditable="true">1800</td><td contenteditable="true">1650</td><td contenteditable="true">1500</td><td contenteditable="true">1400</td></tr>
          <tr><td>A3</td><td>101â€“200</td><td contenteditable="true">1700</td><td contenteditable="true">1550</td><td contenteditable="true">1450</td><td contenteditable="true">1350</td></tr>
          <tr><td>A3</td><td>201â€“500</td><td contenteditable="true">1600</td><td contenteditable="true">1480</td><td contenteditable="true">1380</td><td contenteditable="true">1300</td></tr>
          <tr><td>A3</td><td>501â€“1000</td><td contenteditable="true">1500</td><td contenteditable="true">1400</td><td contenteditable="true">1320</td><td contenteditable="true">1250</td></tr>
          <tr><td>A3</td><td>1001+</td> <td contenteditable="true">1400</td><td contenteditable="true">1320</td><td contenteditable="true">1250</td><td contenteditable="true">1200</td></tr>
        </tbody>
      </table>
    </div>

    <!-- ØªØ®ÙÛŒÙ ÛŒÚ©â€ŒØ±Ùˆ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯ -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ®ÙÛŒÙ Ú†Ø§Ù¾ ÛŒÚ©â€ŒØ±Ùˆ (Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯)</div>
      <div class="tariff-hint">
        Ø§Ú¯Ø± Ø¯Ø± ÙØ±Ù… Ø³ÙØ§Ø±Ø´ Ù†ÙˆØ¹ Ú†Ø§Ù¾ = Â«ÛŒÚ©â€ŒØ±ÙˆÂ» Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯ØŒ Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¨Ø±Ú¯ Ø§ÛŒÙ† Ù…Ø¨Ø§Ù„Øº Ø§Ø² Ù‚ÛŒÙ…Øª Ø¯ÙˆØ±Ùˆ Ú©Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="bwSingleDiscount">
        <thead>
          <tr>
            <th>ØªÙˆØ¶ÛŒØ­</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ØªØ®ÙÛŒÙ ÛŒÚ©â€ŒØ±Ùˆ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¯ÙˆØ±Ùˆ (Ù‡Ø± Ø¨Ø±Ú¯)</td>
            <td contenteditable="true">200</td>
            <td contenteditable="true">180</td>
            <td contenteditable="true">160</td>
            <td contenteditable="true">150</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ø±Ù†Ú¯ÛŒ ØªØ­Ø±ÛŒØ± Û¸Û° (ÛŒÚ©â€ŒØ±ÙˆØŒ Ù¾ÙˆØ´Ø´ ÛµÛ°â€“Û·Û°Ùª Ù…Ø¨Ù†Ø§) ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ¹Ø±ÙÙ‡ Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ (ÛŒÚ©â€ŒØ±ÙˆØŒ ØªØ­Ø±ÛŒØ± Û¸Û° Ú¯Ø±Ù…ØŒ Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯ ÛµÛ°â€“Û·Û°Ùª)</div>
      <div class="tariff-hint">
        Ø§ÛŒÙ† Ø¬Ø¯ÙˆÙ„ØŒ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø±Ù†Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ (Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯ Ø­Ø¯ÙˆØ¯ ÛµÛ° ØªØ§ Û·Û° Ø¯Ø±ØµØ¯) Ùˆ Ú†Ø§Ù¾ <b>ÛŒÚ©â€ŒØ±Ùˆ</b> Ø§Ø³Øª.<br>
        Ø§Ú¯Ø± Ú†Ø§Ù¾ Ø¯ÙˆØ±Ùˆ Ø¨Ø§Ø´Ø¯ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Â«Ø§ÙØ²ÙˆÙ†Ù‡ Ø¯ÙˆØ±Ùˆ Ø±Ù†Ú¯ÛŒÂ»ØŒ Ùˆ Ø§Ú¯Ø± Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯ Ú©Ù…ØªØ± Ø§Ø² ÛµÛ°Ùª ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û·Û°Ùª Ø¨Ø§Ø´Ø¯ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Â«ØªÙ†Ø¸ÛŒÙ… Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="color80">
        <thead>
          <tr>
            <th>Ø³Ø§ÛŒØ²</th>
            <th>Ø¨Ø§Ø²Ù‡ ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <!-- A5 -->
          <tr><td>A5</td><td>1â€“20</td>   <td contenteditable="true">3000</td><td contenteditable="true">2700</td><td contenteditable="true">2500</td><td contenteditable="true">2300</td></tr>
          <tr><td>A5</td><td>21â€“50</td>  <td contenteditable="true">2800</td><td contenteditable="true">2550</td><td contenteditable="true">2400</td><td contenteditable="true">2200</td></tr>
          <tr><td>A5</td><td>51â€“100</td> <td contenteditable="true">2600</td><td contenteditable="true">2400</td><td contenteditable="true">2250</td><td contenteditable="true">2100</td></tr>
          <tr><td>A5</td><td>101â€“200</td><td contenteditable="true">2400</td><td contenteditable="true">2250</td><td contenteditable="true">2100</td><td contenteditable="true">2000</td></tr>
          <tr><td>A5</td><td>201â€“500</td><td contenteditable="true">2200</td><td contenteditable="true">2050</td><td contenteditable="true">1950</td><td contenteditable="true">1850</td></tr>
          <tr><td>A5</td><td>501â€“1000</td><td contenteditable="true">2000</td><td contenteditable="true">1900</td><td contenteditable="true">1800</td><td contenteditable="true">1700</td></tr>
          <tr><td>A5</td><td>1001+</td> <td contenteditable="true">1800</td><td contenteditable="true">1700</td><td contenteditable="true">1650</td><td contenteditable="true">1600</td></tr>

          <!-- A4 -->
          <tr><td>A4</td><td>1â€“20</td>   <td contenteditable="true">5000</td><td contenteditable="true">4500</td><td contenteditable="true">4200</td><td contenteditable="true">4000</td></tr>
          <tr><td>A4</td><td>21â€“50</td>  <td contenteditable="true">4800</td><td contenteditable="true">4350</td><td contenteditable="true">4100</td><td contenteditable="true">3900</td></tr>
          <tr><td>A4</td><td>51â€“100</td> <td contenteditable="true">4600</td><td contenteditable="true">4200</td><td contenteditable="true">3950</td><td contenteditable="true">3800</td></tr>
          <tr><td>A4</td><td>101â€“200</td><td contenteditable="true">4400</td><td contenteditable="true">4050</td><td contenteditable="true">3800</td><td contenteditable="true">3650</td></tr>
          <tr><td>A4</td><td>201â€“500</td><td contenteditable="true">4200</td><td contenteditable="true">3900</td><td contenteditable="true">3650</td><td contenteditable="true">3500</td></tr>
          <tr><td>A4</td><td>501â€“1000</td><td contenteditable="true">4000</td><td contenteditable="true">3750</td><td contenteditable="true">3550</td><td contenteditable="true">3400</td></tr>
          <tr><td>A4</td><td>1001+</td> <td contenteditable="true">3800</td><td contenteditable="true">3600</td><td contenteditable="true">3400</td><td contenteditable="true">3300</td></tr>

          <!-- A3 -->
          <tr><td>A3</td><td>1â€“20</td>   <td contenteditable="true">9000</td><td contenteditable="true">8300</td><td contenteditable="true">8000</td><td contenteditable="true">7700</td></tr>
          <tr><td>A3</td><td>21â€“50</td>  <td contenteditable="true">8600</td><td contenteditable="true">8000</td><td contenteditable="true">7700</td><td contenteditable="true">7400</td></tr>
          <tr><td>A3</td><td>51â€“100</td> <td contenteditable="true">8200</td><td contenteditable="true">7700</td><td contenteditable="true">7400</td><td contenteditable="true">7100</td></tr>
          <tr><td>A3</td><td>101â€“200</td><td contenteditable="true">7800</td><td contenteditable="true">7400</td><td contenteditable="true">7100</td><td contenteditable="true">6900</td></tr>
          <tr><td>A3</td><td>201â€“500</td><td contenteditable="true">7400</td><td contenteditable="true">7100</td><td contenteditable="true">6800</td><td contenteditable="true">6600</td></tr>
          <tr><td>A3</td><td>501â€“1000</td><td contenteditable="true">7000</td><td contenteditable="true">6700</td><td contenteditable="true">6500</td><td contenteditable="true">6300</td></tr>
          <tr><td>A3</td><td>1001+</td> <td contenteditable="true">6600</td><td contenteditable="true">6400</td><td contenteditable="true">6200</td><td contenteditable="true">6000</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Ø§ÙØ²ÙˆÙ†Ù‡ Ø¯ÙˆØ±Ùˆ Ø±Ù†Ú¯ÛŒ -->
    <div class="tariff-section">
      <div class="tariff-section-title">Ø§ÙØ²ÙˆÙ†Ù‡ Ø¯ÙˆØ±Ùˆ Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ</div>
      <div class="tariff-hint">
        Ø§Ú¯Ø± Ù†ÙˆØ¹ Ú†Ø§Ù¾ Ø±Ù†Ú¯ÛŒ = Â«Ø¯ÙˆØ±ÙˆÂ» Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¨Ø±Ú¯ Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ ÛŒÚ©â€ŒØ±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="colorDuplexExtra">
        <thead>
          <tr>
            <th>ØªÙˆØ¶ÛŒØ­</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Ø§ÙØ²ÙˆÙ†Ù‡ Ø¯ÙˆØ±Ùˆ Ù†Ø³Ø¨Øª Ø¨Ù‡ ÛŒÚ©â€ŒØ±Ùˆ (Ù‡Ø± Ø¨Ø±Ú¯ Ø±Ù†Ú¯ÛŒ)</td>
            <td contenteditable="true">2000</td>
            <td contenteditable="true">1800</td>
            <td contenteditable="true">1600</td>
            <td contenteditable="true">1500</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ØªÙ†Ø¸ÛŒÙ… Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯ -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ²Ø§Ù† Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯</div>
      <div class="tariff-hint">
        Ù…Ø¨Ù†Ø§: Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯ ÛµÛ°â€“Û·Û°Ùª (Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ø±Ù†Ú¯ÛŒ).<br>
        Ø§Ú¯Ø± Ú©Ø§Ø± Ú©Ù…â€ŒØ±Ù†Ú¯â€ŒØªØ± (Û°â€“ÛµÛ°Ùª) ÛŒØ§ Ù¾Ø±Ø±Ù†Ú¯â€ŒØªØ± (Û·Û°â€“Û±Û°Û°Ùª) Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¨Ø±Ú¯ Ø§Ø² Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ú©Ù…/Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="colorCoverageAdjust">
        <thead>
          <tr>
            <th>Ø¨Ø§Ø²Ù‡ Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯</th>
            <th>Ù†ÙˆØ¹ ØªÙ†Ø¸ÛŒÙ…</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Û°Ùª ØªØ§ ÛµÛ°Ùª</td>
            <td>ØªØ®ÙÛŒÙ (Ú©Ø³Ø± Ø§Ø² Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡)</td>
            <td contenteditable="true">500</td>
            <td contenteditable="true">450</td>
            <td contenteditable="true">400</td>
            <td contenteditable="true">350</td>
          </tr>
          <tr>
            <td>Û·Û°Ùª ØªØ§ Û±Û°Û°Ùª</td>
            <td>Ø§ÙØ²ÙˆÙ†Ù‡ (Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø± Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡)</td>
            <td contenteditable="true">1000</td>
            <td contenteditable="true">900</td>
            <td contenteditable="true">800</td>
            <td contenteditable="true">700</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ø§ÙØ²ÙˆÙ†Ù‡ Ú¯Ø±Ù…Ø§Ú˜ Ø±Ù†Ú¯ÛŒ (Ú¯Ù„Ø§Ø³Ù‡ / Ø´ÙˆÙ…ÛŒØ²) ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">Ø§ÙØ²ÙˆÙ†Ù‡ Ú¯Ø±Ù…Ø§Ú˜ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ (Ù†Ø³Ø¨Øª Ø¨Ù‡ ØªØ­Ø±ÛŒØ± Û¸Û°)</div>
      <div class="tariff-hint">
        Ø§Ú¯Ø± Ù†ÙˆØ¹ Ú©Ø§ØºØ° Ú¯Ù„Ø§Ø³Ù‡ ÛŒØ§ Ø´ÙˆÙ…ÛŒØ² Ùˆ Ú¯Ø±Ù…Ø§Ú˜ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Û¸Û° Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø±Ù†Ú¯ÛŒ Ù¾Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>

      <table class="tariff-table" data-key="colorWeightExtra">
        <thead>
          <tr>
            <th>Ù†ÙˆØ¹ Ú©Ø§ØºØ°</th>
            <th>Ú¯Ø±Ù…Ø§Ú˜</th>
            <th>Ø§Ø¶Ø§ÙÙ‡ Ø¹Ø§Ø¯ÛŒ / Ø¨Ø±Ú¯</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ØªØ­Ø±ÛŒØ± (Ù…Ø¨Ù†Ø§ÛŒ Û¸Û°)</td>
            <td>80</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
          </tr>
          <tr>
            <td contenteditable="true">Ú¯Ù„Ø§Ø³Ù‡</td>
            <td contenteditable="true">135</td>
            <td contenteditable="true">1000</td>
            <td contenteditable="true">900</td>
            <td contenteditable="true">800</td>
            <td contenteditable="true">700</td>
          </tr>
          <tr>
            <td contenteditable="true">Ú¯Ù„Ø§Ø³Ù‡</td>
            <td contenteditable="true">250</td>
            <td contenteditable="true">2000</td>
            <td contenteditable="true">1800</td>
            <td contenteditable="true">1600</td>
            <td contenteditable="true">1500</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø´ÙˆÙ…ÛŒØ²</td>
            <td contenteditable="true">250</td>
            <td contenteditable="true">3000</td>
            <td contenteditable="true">2700</td>
            <td contenteditable="true">2500</td>
            <td contenteditable="true">2300</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø«Ø§Ø¨Øª Ø³Ø§ÛŒØ² ÙÙ†Ø± (Ø§Ù„Ø§Ù† Ù‚Ø§Ø¨Ù„ Ø§Ø¯ÛŒØª) ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§ÛŒØ² ÙÙ†Ø± Ù…Ø§Ø±Ù¾ÛŒÚ†ÛŒ</div>
      <div class="tariff-hint">
        Ø§ÛŒÙ† Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø· Ø±Ø§Ù‡Ù†Ù…Ø§Ø³Øª Ùˆ Ø¯Ø± Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù‡Ù…Ù‡Ù” Ø³Ø·Ø±Ù‡Ø§ Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ø³ØªÙ†Ø¯ ØªØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ø±Ø¨Ù‡Ù” Ø®ÙˆØ¯ØªØ§Ù† ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.
      </div>

      <table class="tariff-table" data-key="bindingSizeGuide">
        <thead>
          <tr>
            <th>Ø³Ø§ÛŒØ² ÙÙ†Ø±</th>
            <th>Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ ØªÙ‚Ø±ÛŒØ¨ÛŒ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û±Û°</td>
            <td contenteditable="true">ØªØ§ Û²Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û±Û²</td>
            <td contenteditable="true">ØªØ§ ÛµÛ° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û±Û´</td>
            <td contenteditable="true">ØªØ§ Û¸Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û±Û¶</td>
            <td contenteditable="true">ØªØ§ Û±Û±Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û±Û¸</td>
            <td contenteditable="true">ØªØ§ Û±Û´Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û²Û°</td>
            <td contenteditable="true">ØªØ§ Û±Û·Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û²Ûµ</td>
            <td contenteditable="true">ØªØ§ Û±Û¹Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û³Û°</td>
            <td contenteditable="true">ØªØ§ Û²Û²Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û³Ûµ</td>
            <td contenteditable="true">ØªØ§ Û²Û´Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û´Û°</td>
            <td contenteditable="true">ØªØ§ Û²Û¸Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² Û´Ûµ</td>
            <td contenteditable="true">ØªØ§ Û³Û³Û° Ø¨Ø±Ú¯</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø³Ø§ÛŒØ² ÛµÛ°</td>
            <td contenteditable="true">ØªØ§ Û³Û¸Û° Ø¨Ø±Ú¯</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ¹Ø±ÙÙ‡ ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ (Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚ Ùˆ Ø¨Ø¯ÙˆÙ† Ø¨Ø±Ø´)</div>
      <div class="tariff-hint">
        Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø³Ø§ÛŒØ² Ú©Ø§Ø± Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ <b>A4</b> Ø¨Ø§Ø²Ù‡ ÙÙ†Ø± Ø¯Ø§Ø±ÛŒÙ…Ø› Ø¨Ø±Ø§ÛŒ <b>A5</b> Ùˆ <b>A3</b> ÙÙ‚Ø· ÛŒÚ© ØªØ¹Ø±ÙÙ‡Ù” Ú©Ù„ÛŒ (Ø¨Ø¯ÙˆÙ† ØªÙÚ©ÛŒÚ© Ø¨Ø§Ø²Ù‡ ÙÙ†Ø±) Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡.
      </div>

      <table class="tariff-table" data-key="bindingBase">
        <thead>
          <tr>
            <th>Ø³Ø§ÛŒØ²</th>
            <th>Ø¨Ø§Ø²Ù‡ ÙÙ†Ø± (Ø¨Ø±Ú¯ ØªÙ‚Ø±ÛŒØ¨ÛŒ)</th>
            <th>Ø¹Ø§Ø¯ÛŒ</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <!-- A4 (Ú†Ù†Ø¯ Ø¨Ø§Ø²Ù‡) -->
          <tr>
            <td>A4</td>
            <td contenteditable="true">Û¸ ØªØ§ Û±Û¸</td>
            <td contenteditable="true">7000</td>
            <td contenteditable="true">6500</td>
            <td contenteditable="true">6200</td>
            <td contenteditable="true">6000</td>
          </tr>
          <tr>
            <td>A4</td>
            <td contenteditable="true">Û²Û° ØªØ§ Û³Û°</td>
            <td contenteditable="true">9000</td>
            <td contenteditable="true">8500</td>
            <td contenteditable="true">8200</td>
            <td contenteditable="true">8000</td>
          </tr>
          <tr>
            <td>A4</td>
            <td contenteditable="true">Û³Ûµ ØªØ§ Û´Û°</td>
            <td contenteditable="true">11000</td>
            <td contenteditable="true">10500</td>
            <td contenteditable="true">10000</td>
            <td contenteditable="true">9600</td>
          </tr>
          <tr>
            <td>A4</td>
            <td contenteditable="true">Û´Ûµ ØªØ§ ÛµÛ°</td>
            <td contenteditable="true">13000</td>
            <td contenteditable="true">12500</td>
            <td contenteditable="true">12000</td>
            <td contenteditable="true">11500</td>
          </tr>

          <!-- A5 ÛŒÚ© Ø±Ø¯ÛŒÙ Ú©Ù„ÛŒ -->
          <tr>
            <td>A5</td>
            <td>Ù‡Ù…Ù‡ Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø±</td>
            <td contenteditable="true">9000</td>
            <td contenteditable="true">8500</td>
            <td contenteditable="true">8200</td>
            <td contenteditable="true">8000</td>
          </tr>

          <!-- A3 ÛŒÚ© Ø±Ø¯ÛŒÙ Ú©Ù„ÛŒ -->
          <tr>
            <td>A3</td>
            <td>Ù‡Ù…Ù‡ Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø±</td>
            <td contenteditable="true">15000</td>
            <td contenteditable="true">14500</td>
            <td contenteditable="true">14000</td>
            <td contenteditable="true">13500</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ø§ÙØ²ÙˆÙ†Ù‡ Ø·Ù„Ù‚ ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">Ø§ÙØ²ÙˆÙ†Ù‡ Ø·Ù„Ù‚ (Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡)</div>
      <div class="tariff-hint">Ù…Ø¨Ù†Ø§ÛŒ ÙÙ†Ø±ÛŒ Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚ Ø§Ø³ØªØ› Ø¯Ø± ØµÙˆØ±Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø·Ù„Ù‚ Ø´ÙØ§Ù ÛŒØ§ Ø¶Ø®ÛŒÙ…ØŒ Ø§ÛŒÙ† Ù…Ø¨Ù„Øº Ø¨Ù‡ ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>

      <table class="tariff-table" data-key="bindingCover">
        <thead>
          <tr>
            <th>Ù†ÙˆØ¹ Ø·Ù„Ù‚</th>
            <th>Ø³Ø§ÛŒØ²</th>
            <th>Ø¹Ø§Ø¯ÛŒ / Ø¬Ø²ÙˆÙ‡</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚ (Ù…Ø¨Ù†Ø§ÛŒ Ù‚ÛŒÙ…Øª)</td>
            <td>Ù‡Ù…Ù‡ Ø³Ø§ÛŒØ²Ù‡Ø§</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
            <td contenteditable="true">0</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø´ÙØ§Ù</td>
            <td contenteditable="true">A4</td>
            <td contenteditable="true">2000</td>
            <td contenteditable="true">1800</td>
            <td contenteditable="true">1700</td>
            <td contenteditable="true">1600</td>
          </tr>
          <tr>
            <td contenteditable="true">Ø¶Ø®ÛŒÙ…</td>
            <td contenteditable="true">A4</td>
            <td contenteditable="true">4000</td>
            <td contenteditable="true">3700</td>
            <td contenteditable="true">3500</td>
            <td contenteditable="true">3300</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø±Ø´ (Ú©ØªØ§Ø¨) ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø±Ø´ (ÙÙ‚Ø· Ú©ØªØ§Ø¨)</div>
      <div class="tariff-hint">Ø¯Ø± ØµÙˆØ±Øª Ø§Ù†ØªØ®Ø§Ø¨ Â«Ú©ØªØ§Ø¨Â» Ø¯Ø± Ù†ÙˆØ¹ Ú©Ø§Ø± ÙÙ†Ø±ÛŒØŒ Ø§ÛŒÙ† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ù„Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (ÛŒÚ© Ù†ÙˆØ¹ Ø¨Ø±Ø´ Ø¨ÛŒØ´ØªØ± Ù†Ø¯Ø§Ø±ÛŒÙ…).</div>

      <table class="tariff-table" data-key="bindingCut">
        <thead>
          <tr>
            <th>Ù†ÙˆØ¹ Ø¨Ø±Ø´</th>
            <th>Ø¹Ø§Ø¯ÛŒ / Ø¬Ù„Ø¯</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Ø¨Ø±Ø´ Ú©ØªØ§Ø¨</td>
            <td contenteditable="true">3000</td>
            <td contenteditable="true">2700</td>
            <td contenteditable="true">2500</td>
            <td contenteditable="true">2300</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ù…Ù†Ú¯Ù†Ù‡ ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ¹Ø±ÙÙ‡ Ù…Ù†Ú¯Ù†Ù‡</div>
      <div class="tariff-hint">ÙÙ‚Ø· Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡Ø› Ø¯Ø± Ø®Ø¯Ù…Øª Ø§Ø¶Ø§ÙÙ‡ Ù…Ù†Ú¯Ù†Ù‡ Ø±ÙˆÛŒ Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†ØªØŒ Ù‚ÛŒÙ…Øª Ø¨Ø±Ú¯â€ŒÙ‡Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>

      <table class="tariff-table" data-key="staple">
        <thead>
          <tr>
            <th>ØªÙˆØ¶ÛŒØ­</th>
            <th>Ø¹Ø§Ø¯ÛŒ / Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Ù…Ù†Ú¯Ù†Ù‡ (Ù‡Ø± Ø¹Ø¯Ø¯)</td>
            <td contenteditable="true">500</td>
            <td contenteditable="true">400</td>
            <td contenteditable="true">350</td>
            <td contenteditable="true">300</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ===================== Ù¾Ø±Ø³ ===================== -->
    <div class="tariff-section">
      <div class="tariff-section-title">ØªØ¹Ø±ÙÙ‡ Ù¾Ø±Ø³ (Ù„Ù…ÛŒÙ†ÛŒØª)</div>
      <div class="tariff-hint">Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø³Ø§ÛŒØ² Ú©Ø§Ø±Øª/Ø¨Ø±Ú¯Ù‡.</div>

      <table class="tariff-table" data-key="lamination">
        <thead>
          <tr>
            <th>Ø³Ø§ÛŒØ²</th>
            <th>Ø¹Ø§Ø¯ÛŒ / Ù‡Ø± Ù¾Ø±Ø³</th>
            <th>Ø³Ø·Ø­ Û±</th>
            <th>Ø³Ø·Ø­ Û²</th>
            <th>Ø³Ø·Ø­ Û³</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">Ú©Ø§Ø±ØªÛŒ</td>
            <td contenteditable="true">3000</td>
            <td contenteditable="true">2700</td>
            <td contenteditable="true">2500</td>
            <td contenteditable="true">2400</td>
          </tr>
          <tr>
            <td contenteditable="true">A5</td>
            <td contenteditable="true">5000</td>
            <td contenteditable="true">4700</td>
            <td contenteditable="true">4500</td>
            <td contenteditable="true">4300</td>
          </tr>
          <tr>
            <td contenteditable="true">A4</td>
            <td contenteditable="true">7000</td>
            <td contenteditable="true">6600</td>
            <td contenteditable="true">6300</td>
            <td contenteditable="true">6000</td>
          </tr>
          <tr>
            <td contenteditable="true">A3</td>
            <td contenteditable="true">10000</td>
            <td contenteditable="true">9500</td>
            <td contenteditable="true">9000</td>
            <td contenteditable="true">8500</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
<script>
    const TARIFF_STORAGE_KEY = "tariffs_v7_full";

    function readAllTariffTables() {
      const data = {};
      document.querySelectorAll(".tariff-table").forEach(tbl => {
        const key = tbl.dataset.key;
        if (!key) return; // Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´ÙˆÙ†Ø¯
        const rows = [];
        tbl.querySelectorAll("tbody tr").forEach(tr => {
          const cells = Array.from(tr.querySelectorAll("td")).map(td => td.textContent.trim());
          rows.push(cells);
        });
        data[key] = rows;
      });
      return data;
    }

    function applyTariffData(data) {
      document.querySelectorAll(".tariff-table").forEach(tbl => {
        const key = tbl.dataset.key;
        if (!key || !data[key]) return;

        const rows = tbl.querySelectorAll("tbody tr");
        data[key].forEach((row, i) => {
          if (!rows[i]) return;
          const tds = rows[i].querySelectorAll("td");
          row.forEach((val, j) => {
            if (tds[j]) tds[j].textContent = val;
          });
        });
      });
    }

    document.getElementById("btnSaveTariffs").addEventListener("click", () => {
      const data = readAllTariffTables();
      localStorage.setItem(TARIFF_STORAGE_KEY, JSON.stringify(data));
      alert("ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯.");
    });

    document.getElementById("btnLoadTariffs").addEventListener("click", () => {
      const stored = localStorage.getItem(TARIFF_STORAGE_KEY);
      if (!stored) {
        alert("Ù‡ÛŒÚ† ØªØ¹Ø±ÙÙ‡â€ŒØ§ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
        return;
      }
      const data = JSON.parse(stored);
      applyTariffData(data);
      alert("ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù†Ø¯.");
    });

    document.getElementById("btnResetTariffs").addEventListener("click", () => {
      if (!confirm("Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ù…ÙˆÙ†Ù‡ØŸ (ØªØºÛŒÛŒØ±Ø§Øª ÙØ¹Ù„ÛŒ Ø§Ø² Ø¨ÛŒÙ† Ù…ÛŒâ€ŒØ±ÙˆØ¯)")) return;
      localStorage.removeItem(TARIFF_STORAGE_KEY);
      location.reload();
    });
  </script>
</div>

</div> <!-- /container -->

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ -->
<div id="customerSearchModal" class="modal">
  <div class="modal-box">
    <h2>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ</h2>
    <div class="row">
      <div class="field">
        <label>Ù†Ø§Ù… ÛŒØ§ ØªÙ„ÙÙ†:</label>
        <input id="searchCustomerInput" type="text" placeholder="Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù†Ø§Ù… ÛŒØ§ ØªÙ„ÙÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
      </div>
    </div>
    <div class="hint">Ø¯Ø± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒØŒ Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ù„ÛŒØ³Øª Ù…Ø´ØªØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</div>
    <div class="modal-buttons">
      <button id="btnSearchApply" class="btn-modal-ok" type="button">Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ø¨Ø³ØªÙ†</button>
      <button id="btnSearchCancel" class="btn-modal-cancel" type="button">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ -->
<div id="customerNewModal" class="modal">
  <div class="modal-box">
    <h2>Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h2>
    <div class="row">
      <div class="field">
        <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ:</label>
        <input id="newCustomerName" type="text" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ">
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label>ØªÙ„ÙÙ†:</label>
        <input id="newCustomerPhone" type="text" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³">
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label>Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ:</label>
        <div class="radio-row">
          <input type="radio" name="newCustomerType" id="newCustNormal" value="normal" checked>
          <label for="newCustNormal">Ø¹Ø§Ø¯ÛŒ</label>
          <input type="radio" name="newCustomerType" id="newCustPartner" value="partner">
          <label for="newCustPartner">Ù‡Ù…Ú©Ø§Ø±</label>
        </div>
      </div>
    </div>
    <div class="row hidden" id="newCustomerPriceLevelRow">
      <div class="field">
        <label>Ø³Ø·Ø­ Ù‚ÛŒÙ…Øª:</label>
        <select id="newCustomerPriceLevel">
          <option value="1">Ø³Ø·Ø­ Û±</option>
          <option value="2">Ø³Ø·Ø­ Û²</option>
          <option value="3">Ø³Ø·Ø­ Û³</option>
        </select>
      </div>
    </div>
    <div class="hint">Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒØŒ Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
    <div class="modal-buttons">
      <button id="btnNewCustomerSave" class="btn-modal-ok" type="button">Ø«Ø¨Øª Ùˆ Ø¨Ø±Ú¯Ø´Øª</button>
      <button id="btnNewCustomerCancel" class="btn-modal-cancel" type="button">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± -->
<div id="loginModal" class="modal show">
  <div class="modal-box">
    <h2>ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</h2>
    <div class="row">
      <div class="field">
        <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
        <input id="loginUser" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ admin ÛŒØ§ user1">
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
        <input id="loginPass" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
      </div>
    </div>
    
    <div class="modal-buttons">
      <button id="btnLogin" class="btn-modal-ok" type="button">ÙˆØ±ÙˆØ¯</button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ³ÙˆÛŒÙ‡ Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ -->
<div id="debtSettlementModal" class="modal">
  <div class="modal-box" style="max-width: 800px;">
    <div class="modal-header">
      <h2>Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ</h2>
      <button class="close" onclick="document.getElementById('debtSettlementModal').style.display='none'" title="Ø¨Ø³ØªÙ†">&times;</button>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="field">
          <label>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ:</label>
          <input id="debtCustomerSearch" type="text" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
        </div>
      </div>
      <div class="hint" style="margin-bottom: 15px;">
        Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø±ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
      </div>
      <table id="debtCustomersTable" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="background:#f5f5f5;">
            <th style="border:1px solid #ddd; padding:8px;">Ù…Ø´ØªØ±ÛŒ</th>
            <th style="border:1px solid #ddd; padding:8px;">ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
            <th style="border:1px solid #ddd; padding:8px;">Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„</th>
            <th style="border:1px solid #ddd; padding:8px;">Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´</th>
          </tr>
        </thead>
        <tbody id="debtCustomersBody"></tbody>
      </table>
    </div>
    <div class="modal-buttons">
      <button type="button" onclick="document.getElementById('debtSettlementModal').style.display='none'" class="btn-modal-cancel">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² -->
<div id="openOrdersModal" class="modal">
  <div class="modal-box">
    <h2>Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²</h2>
    <div class="hint">
      Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ù…Ø±ÙˆØ² Ø«Ø¨Øª Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ùˆ Ù‡Ù†ÙˆØ² ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
      Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Â«Ø¨Ø§Ø² Ú©Ø±Ø¯Ù†Â» Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¯Ø± ÙØ±Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.
    </div>
    <table style="width:100%;margin-top:8px;">
      <thead>
        <tr>
          <th>#</th>
          <th>ÙˆØ¶Ø¹ÛŒØª</th>
          <th>Ù…Ø´ØªØ±ÛŒ / Ø¹Ù†ÙˆØ§Ù† Ø³ÙØ§Ø±Ø´</th>
          <th>Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø±ØªØ¨Ø·</th>
          <th>Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø² Ø¯ÛŒØ±ÙˆØ²ØŸ</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody id="openOrdersBody"></tbody>
    </table>
    <div class="modal-buttons">
      <button id="btnOpenOrdersClose" class="btn-modal-cancel" type="button">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>
</div>


<!-- Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ² / Ø¨Ø³ØªÙ† Ø±ÙˆØ² -->
<div id="dailyCloseModal" class="modal">
  <div class="modal-box">
    <h2>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ / Ø¨Ø³ØªÙ† Ø±ÙˆØ²</h2>

    <div class="row" style="margin-bottom:8px;">
      <div class="field">
        <label>Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®:</label>
        <select id="reportDateSelector">
          <option value="today">Ø§Ù…Ø±ÙˆØ²</option>
          <option value="yesterday">Ø¯ÛŒØ±ÙˆØ²</option>
          <option value="custom">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®...</option>
        </select>
      </div>
      <div class="field" id="customDateField" style="display:none;">
        <input id="customReportDate" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û±Û´Û°Û³/Û°Û·/Û±Ûµ">
      </div>
    </div>

    <div class="section" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ø®Ù„Ø§ØµÙ‡ Ø§Ù…Ø±ÙˆØ² (Ø·Ø¨Ù‚ Ø³ÛŒØ³ØªÙ…)</div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div class="row">
          <div class="field">
            <label>Ø¯Ø±ÛŒØ§ÙØª Ù†Ù‚Ø¯ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†:</label>
            <span id="dailyCashIn" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆØ² Ù…Ø´ØªØ±ÛŒØ§Ù†:</label>
            <span id="dailyPosIn" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ù…Ø´ØªØ±ÛŒØ§Ù†:</label>
            <span id="dailyCardIn" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ù†Ø³ÛŒÙ‡ Ù…Ø´ØªØ±ÛŒØ§Ù† (Ù…Ø§Ù†Ø¯Ù‡):</label>
            <span id="dailyCustomerDebt" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚:</label>
            <span id="dailyNonCashOut" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚:</label>
            <span id="dailyCashOut" style="font-weight:bold;"></span>
          </div>
        </div>
        <div class="row" style="grid-column:1/-1;">
          <div class="field">
            <label>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ø·Ø¨Ù‚ Ø³ÛŒØ³ØªÙ…:</label>
            <span id="dailyExpectedCash" style="font-weight:bold;color:#e65100;"></span>
          </div>
        </div>
      </div>
    </div>

    <div class="section" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">ÙˆØ±ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±</div>
      <div class="row">
        <div class="field">
          <label>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ØµÙ†Ø¯ÙˆÙ‚:</label>
          <input id="dailyRealCash" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 5,000,000">
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Ù¾Ø±ØªÛŒ Ú©Ø§ØºØ° (Ø¨Ø±Ú¯):</label>
          <input id="dailyPaperWaste" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 50">
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
          <textarea id="dailyNote" placeholder="ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù¾Ø±ØªÛŒ ÛŒØ§ Ù…ØºØ§ÛŒØ±Øª"></textarea>
        </div>
      </div>
    </div>

    <div class="section" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ù†ØªÛŒØ¬Ù‡ Ù…ØºØ§ÛŒØ±Øª</div>
      <div class="row">
        <div class="field">
          <label>ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚:</label>
          <span id="dailyDiffText" style="font-weight:bold;"></span>
        </div>
      </div>
    </div>

    <div class="section" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
      <div id="dailyNonCashPaymentsContainer" style="max-height:150px; overflow-y:auto;">
        <table id="dailyNonCashPaymentsTable" style="width:100%; font-size:11pt;">
          <thead>
            <tr>
              <th>Ù…Ø¨Ù„Øº</th>
              <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th>Ø¨Ø§Ø¨Øª</th>
            </tr>
          </thead>
          <tbody id="dailyNonCashPaymentsBody">
            <tr>
              <td colspan="4" style="text-align:center; color:#999;">Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®Øª ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ø§Ù…Ø±ÙˆØ²</div>
      <div id="dailyOpenOrdersContainer" style="max-height:200px; overflow-y:auto;">
        <table id="dailyOpenOrdersTable" style="width:100%; font-size:11pt;">
          <thead>
            <tr>
              <th>Ø´Ù…Ø§Ø±Ù‡</th>
              <th>Ù…Ø´ØªØ±ÛŒ</th>
              <th>Ø¬Ø²Ø¦ÛŒØ§Øª</th>
              <th>ÙˆØ¶Ø¹ÛŒØª</th>
              <th>Ù…Ø§Ù†Ø¯Ù‡</th>
              <th>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="dailyOpenOrdersBody">
            <tr>
              <td colspan="4" style="text-align:center; color:#999;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="modal-buttons">
      <button id="btnDailyCloseSave" class="btn-modal-ok" type="button">Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´</button>
      <button id="btnDailyClosePrint" class="btn-modal-ok" type="button" style="background:#1976d2;">ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´</button>
      <button id="btnDailyCloseCancel" class="btn-modal-cancel" type="button">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ -->
<div id="cashFromBoxModal" class="modal">
  <div class="modal-box">
    <h2>Ø«Ø¨Øª Ø¹Ù…Ù„ÛŒØ§Øª ØµÙ†Ø¯ÙˆÙ‚</h2>

    <div class="row">
      <div class="field">
        <label>ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª:</label>
        <input id="cashPayDateTime" type="text" placeholder="Ø§Ú©Ù†ÙˆÙ†">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Ù…Ø¨Ù„Øº:</label>
        <input id="cashPayAmount" type="text" class="money" placeholder="Ù…Ø«Ù„Ø§Ù‹ 200,000">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
        <select id="cashPayMethod">
          <option value="cash">Ù†Ù‚Ø¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚</option>
          <option value="office_card">Ú©Ø§Ø±Øª Ø¯ÙØªØ±</option>
          <option value="personal_card">Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒ</option>
          <option value="bank_transfer">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ</option>
          <option value="other">Ø³Ø§ÛŒØ±</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
        <select id="cashPayType">
          <option value="cost">Ù‡Ø²ÛŒÙ†Ù‡</option>
          <option value="peyk">Ù¾ÛŒÚ©</option>
          <option value="refund">Ø¨Ø±Ú¯Ø´Øª ÙˆØ¬Ù‡ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ</option>
          <option value="customer_debt">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ</option>
          <option value="supplier">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡</option>
          <option value="manager_payment">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø¯ÛŒØ±</option>
          <option value="owner_draw">Ø¨Ø±Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ</option>
          <option value="other">Ø³Ø§ÛŒØ±</option>
        </select>
      </div>
    </div>

    <div id="cashPeykSection" class="section hidden" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾ÛŒÚ©</div>

      <div class="row">
        <div class="field">
          <label>Ù¾ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´ØŸ</label>
          <select id="peykSection">
            <option value="copy_print">Ø³ÙØ§Ø±Ø´ Ú†Ø§Ù¾/Ú©Ù¾ÛŒ</option>
            <option value="design">Ø·Ø±Ø§Ø­ÛŒ</option>
            <option value="wholesale">ÙØ±ÙˆØ´ Ø¹Ù…Ø¯Ù‡</option>
            <option value="material">Ø®Ø±ÛŒØ¯ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</option>
            <option value="personal">Ø§Ù…ÙˆØ± Ø´Ø®ØµÛŒ / ØºÛŒØ±Ú©Ø§Ø±ÛŒ</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Ù…Ù‚ØµØ¯ Ù¾ÛŒÚ©:</label>
          <select id="peykDestination">
            <option value="andisheh">Ø§Ù†Ø¯ÛŒØ´Ù‡</option>
            <option value="karaj">Ú©Ø±Ø¬</option>
            <option value="fardis">ÙØ±Ø¯ÛŒØ³</option>
            <option value="shahriyar">Ø´Ù‡Ø±ÛŒØ§Ø±</option>
            <option value="baghestan">Ø¨Ø§ØºØ³ØªØ§Ù†</option>
            <option value="malard">Ù…Ù„Ø§Ø±Ø¯</option>
            <option value="tehran">ØªÙ‡Ø±Ø§Ù†</option>
            <option value="other">Ø³Ø§ÛŒØ± (ØªÙˆØ¶ÛŒØ­ Ø¯Ø³ØªÛŒ)</option>
          </select>
        </div>
      </div>

      <div class="row hidden" id="peykDestinationOtherRow">
        <div class="field">
          <label>ØªÙˆØ¶ÛŒØ­ Ù…Ù‚ØµØ¯:</label>
          <input id="peykDestinationOther" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ ÙÙ„Ø§Ù† Ø´Ù‡Ø± / Ù…Ø­Ù„Ù‡">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
          <input id="peykOrderNo" type="text" placeholder="Ø§Ú¯Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ Ø§Ø³Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
        </div>
      </div>
    </div>

    <div id="cashCustomerDebtSection" class="section hidden" style="margin-bottom:8px;">
      <div class="section-title" style="font-size:13pt;">Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ</div>

      <div class="row">
        <div class="field" style="flex: 1;">
          <label>Ù…Ø´ØªØ±ÛŒ:</label>
          <input id="cashPayDebtCustomer" type="text" readonly placeholder="Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯" style="background: #f5f5f5;">
        </div>
        <div class="field" style="flex: 0 0 auto;">
          <label>&nbsp;</label>
          <button type="button" id="btnSelectDebtCustomer" class="btn-small" style="background:#2196f3;color:#fff; margin-top: 0;">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</button>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒ:</label>
          <input id="cashPayDebtBalance" type="text" readonly style="background: #fff3cd; font-weight: bold; color: #856404;">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Ø¨Ø§Ø¨Øª:</label>
        <input id="cashPayReason" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ø§ØºØ°ØŒ ØªØ³ÙˆÛŒÙ‡ Ù†Ø³ÛŒÙ‡ØŒ ...">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Ù…Ø´ØªØ±ÛŒ / Ø·Ø±Ù Ø­Ø³Ø§Ø¨:</label>
        <input id="cashPayCustomer" type="text" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒØŒ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ ÛŒØ§ Ø´Ø®Øµ">
      </div>
    </div>

    <div class="hint">
      Ø§ÛŒÙ† ÙØ±Ù… Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ú†Ù‡ Ù…Ø¨Ù„ØºÛŒØŒ Ø¨Ù‡ Ú†Ù‡ Ø±ÙˆØ´ÛŒ Ùˆ Ø¨Ø§Ø¨Øª Ú†Ù‡ Ù…ÙˆØ±Ø¯ÛŒ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚/Ø­Ø³Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø´Ø¯Ù‡ Ø§Ø³Øª.
    </div>

    <div class="modal-buttons">
      <button id="btnCashSave" class="btn-modal-ok" type="button">Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª</button>
      <button id="btnCashCancel" class="btn-modal-cancel" type="button">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  // --- Ø«Ø§Ø¨Øªâ€ŒÙ‡Ø§ ---
  const STORAGE_KEY = "orders_v13";
  const CASH_STORAGE_KEY = "cashPayments_v4";
  const DAILY_CLOSE_KEY = "dailyClose_v1";
  const REAL_CASH_BASE_KEY = "realCashBase_v1";
  const ORDER_SEQ_KEY = "orderSeq_v1";
  // --- Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§ ---
  function normalizeDigits(str) {
    if (str == null) return "";
    str = String(str);
    const persian = "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹";
    const arabic  = "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©";
    let out = "";
    for (let ch of str) {
      const p = persian.indexOf(ch);
      if (p > -1) { out += String(p); continue; }
      const a = arabic.indexOf(ch);
      if (a > -1) { out += String(a); continue; }
      if (ch === "," || ch === "Ù¬") continue;
      if (ch === " " || ch === "â€" || ch === "â€") continue;
      out += ch;
    }
    return out;
  }
  function parseMoney(str) {
    if (!str) return 0;
    let s = normalizeDigits(str);
    s = s.replace(/[^\d\-]/g, "");
    if (!s) return 0;
    const n = parseInt(s, 10);
    return isNaN(n) ? 0 : n;
  }
  function parseIntSafe(str) {
    if (!str) return 0;
    let s = normalizeDigits(str);
    s = s.replace(/[^\d\-]/g, "");
    if (!s) return 0;
    const n = parseInt(s, 10);
    return isNaN(n) ? 0 : n;
  }
  
  function getNextOrderNumber() {
    try {
      let raw = localStorage.getItem(ORDER_SEQ_KEY) || "0";
      let seq = parseInt(raw, 10);
      if (!Number.isFinite(seq) || seq < 0) seq = 0;
      seq += 1;
      localStorage.setItem(ORDER_SEQ_KEY, String(seq));
      return String(seq);
    } catch (e) {
      // Ø¯Ø± ØµÙˆØ±Øª Ù‡Ø± Ø®Ø·Ø§ÛŒÛŒØŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¹Ø¯Ø¯ Ø²Ù…Ø§Ù†ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      return String(Date.now());
    }
  }

  function getCurrentPriceLevelKey() {
    const sel = document.getElementById("orderPriceLevel");
    if (!sel) return "normal";
    const val = sel.value || "normal";
    return val;
  }

  function getTariffColumnIndexForLevel(levelKey) {
    // columns: 0=size/desc,1=range/desc,2=normal,3=level1,4=level2,5=level3
    switch (levelKey) {
      case "1": return 3;
      case "2": return 4;
      case "3": return 5;
      case "normal":
      default:
        return 2;
    }
  }

  function matchesQuantityRange(rangeText, quantity) {
    if (!rangeText) return true;
    const cleaned = rangeText.replace(/[^0-9+]+/g, " ").trim();
    if (!cleaned) return true;
    const parts = cleaned.split(/\s+/);
    const first = parseInt(parts[0] || "0", 10);
    let second = parts.length > 1 ? parseInt(parts[1], 10) : null;

    if (rangeText.includes("+")) {
      return quantity >= first;
    }
    if (second == null || isNaN(second)) {
      return quantity === first;
    }
    return quantity >= first && quantity <= second;
  }

  function findBwPricePerSheet(size, totalSheets, levelKey) {
    const table = document.querySelector('table[data-key="bw"] tbody');
    if (!table) return null;
    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const rows = table.querySelectorAll("tr");
    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;
      const rowSize = (tds[0].textContent || "").trim();
      if (rowSize !== size) continue;
      const rangeText = (tds[1].textContent || "").trim();
      if (!matchesQuantityRange(rangeText, totalSheets)) continue;
      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText);
      if (price > 0) return price;
    }
    return null;
  }

  function getBwSingleDiscountPerSheet(levelKey) {
    const table = document.querySelector('table[data-key="bwSingleDiscount"] tbody');
    if (!table) return 0;
    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const row = table.querySelector("tr");
    if (!row) return 0;
    const tds = row.querySelectorAll("td");
    if (tds.length < colIdx + 1) return 0;
    const txt = (tds[colIdx].textContent || "").trim();
    const val = parseMoney(txt);
    return val || 0;
  }

  function findColorBasePricePerSheet(size, totalSheets, levelKey) {
    const table = document.querySelector('table[data-key="color80"] tbody');
    if (!table) return null;
    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const rows = table.querySelectorAll("tr");
    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;
      const rowSize = (tds[0].textContent || "").trim();
      if (rowSize !== size) continue;
      const rangeText = (tds[1].textContent || "").trim();
      if (!matchesQuantityRange(rangeText, totalSheets)) continue;
      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText);
      if (price > 0) return price;
    }
    return null;
  }

  function getColorDuplexExtraPerSheet(levelKey) {
    const table = document.querySelector('table[data-key="colorDuplexExtra"] tbody');
    if (!table) return 0;
    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const row = table.querySelector("tr");
    if (!row) return 0;
    const tds = row.querySelectorAll("td");
    if (tds.length < colIdx + 1) return 0;
    const txt = (tds[colIdx].textContent || "").trim();
    const val = parseMoney(txt);
    return val || 0;
  }


  function getColorCoverageAdjustPerSheet(levelKey, coverageCode) {
    // coverageCode: "50-70" (Ù…Ø¨Ù†Ø§ØŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)ØŒ "0-50" (Ú©Ù…â€ŒØ±Ù†Ú¯)ØŒ "70-100" (Ù¾Ø±Ø±Ù†Ú¯)
    if (!coverageCode || coverageCode === "50-70") return 0;
    const table = document.querySelector('table[data-key="colorCoverageAdjust"] tbody');
    if (!table) return 0;
    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const rows = table.querySelectorAll("tr");

    let targetRangeText = "";
    if (coverageCode === "0-50") {
      targetRangeText = "Û°Ùª ØªØ§ ÛµÛ°Ùª";
    } else if (coverageCode === "70-100") {
      targetRangeText = "Û·Û°Ùª ØªØ§ Û±Û°Û°Ùª";
    }

    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;

      const rangeText = (tds[0].textContent || "").trim();
      if (!rangeText.includes(targetRangeText)) continue;

      const adjustType = (tds[1].textContent || "").trim();
      let amount = parseMoney((tds[colIdx].textContent || "").trim());
      if (!amount) return 0;

      // Ø§Ú¯Ø± Ù†ÙˆØ¹ "ØªØ®ÙÛŒÙ" Ø¨Ø§Ø´Ø¯ØŒ Ù…Ù‚Ø¯Ø§Ø± Ø§Ø² Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ú©Ø³Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯
      if (adjustType.includes("ØªØ®ÙÛŒÙ")) {
        amount = -amount;
      }
      // Ø§Ú¯Ø± Ù†ÙˆØ¹ "Ø§ÙØ²ÙˆÙ†Ù‡" Ø¨Ø§Ø´Ø¯ØŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      // (Ø¹Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„ Ù…Ø«Ø¨Øª Ø§Ø³ØªØŒ Ù¾Ø³ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…)
      return amount;
    }

    return 0;
  }


  function getColorWeightExtraPerSheet(levelKey, paperType, paperWeight) {
    // Ø§ÙØ²ÙˆÙ†Ù‡ Ú¯Ø±Ù…Ø§Ú˜ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ù†Ø³Ø¨Øª Ø¨Ù‡ ØªØ­Ø±ÛŒØ± Û¸Û°
    const table = document.querySelector('table[data-key="colorWeightExtra"] tbody');
    if (!table) return 0;

    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const rows = table.querySelectorAll("tr");
    if (!rows || !rows.length) return 0;

    if (!paperType || !paperWeight) return 0;

    const normPaperType = String(paperType).trim();

    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;

      const typeTextRaw   = (tds[0].textContent || "").trim();
      const weightTextRaw = (tds[1].textContent || "").trim();

      if (!typeTextRaw || !typeTextRaw.includes(normPaperType)) continue;

      const rowWeight    = parseIntSafe(normalizeDigits(weightTextRaw));
      const wantedWeight = parseIntSafe(paperWeight);
      if (!rowWeight || !wantedWeight) continue;
      if (rowWeight !== wantedWeight) continue;

      const txt = (tds[colIdx].textContent || "").trim();
      const val = parseMoney(txt);
      if (!val) return 0;

      return val; // Ø¹Ø¯Ø¯ Ù…Ø«Ø¨Øª Ø§Ø³Øª Ùˆ Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    }

    return 0;
  }



  // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¯Ø§Ø®Ù„ Ø¨Ø§Ø²Ù‡Ù” Ù…ØªÙ†ÛŒ Ø¬Ø¯ÙˆÙ„ Ù‡Ø³Øª ÛŒØ§ Ù†Ù‡
  // Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ:
  //  "Û¸ ØªØ§ Û±Û¸ Ø¨Ø±Ú¯"  ØŒ  "8 ØªØ§ 18" ØŒ "8-18" ØŒ "ØªØ§ 20 Ø¨Ø±Ú¯" ØŒ "20+" ØŒ "Ø¨ÛŒØ´ Ø§Ø² 40 Ø¨Ø±Ú¯"
  function matchesQuantityRange(rangeText, qty) {
    if (!rangeText) return true;            // Ø§Ú¯Ø± Ú†ÛŒØ²ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ØŒ Ù‡Ù…Ù‡ Ø±Ø§ Ù‚Ø¨ÙˆÙ„ Ú©Ù†
    if (!qty) return false;

    // Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
    const txt = normalizeDigits(String(rangeText)).trim();

    // Ø§Ú¯Ø± Ø¹Ù…Ø¯Ø§Ù‹ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ "-" ÛŒØ§ "Ù‡Ù…Ù‡" ÛŒØ¹Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡Ù” Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
    if (txt === "-" || txt === "" || txt.includes("Ù‡Ù…Ù‡")) {
      return true;
    }

    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø§Ø±Ù‚Ø§Ù… Ø¯Ø§Ø®Ù„ Ù…ØªÙ†
    const numbers = (txt.match(/\d+/g) || []).map(n => parseInt(n, 10));

    if (!numbers.length) {
      // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¹Ø¯Ø¯ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡ Ù‡Ù…Ù‡ Ø±Ø§ Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      return true;
    }

    // Ø­Ø§Ù„Øª "20+" ÛŒØ§ "Ø¨ÛŒØ´ Ø§Ø² 40"
    if (/[+]|Ø¨Ø§Ù„Ø§|Ø¨ÛŒØ´/ .test(txt)) {
      const min = numbers[0];
      return qty >= min;
    }

    // Ø­Ø§Ù„Øª "ØªØ§ 20" â†’ Û± ØªØ§ Û²Û°
    if (/ØªØ§/.test(txt) && numbers.length === 1) {
      const max = numbers[0];
      return qty >= 1 && qty <= max;
    }

    // Ø­Ø§Ù„Øª Ø¨Ø§Ø²Ù‡ "8-18" ÛŒØ§ "8 ØªØ§ 18"
    if (numbers.length >= 2) {
      const min = Math.min(numbers[0], numbers[1]);
      const max = Math.max(numbers[0], numbers[1]);
      return qty >= min && qty <= max;
    }

    // Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ø¹Ø¯Ø¯ Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± Ù†Ø¸Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
    const only = numbers[0];
    return qty <= only;
  }

  function parseGuideMaxPages(rangeText) {
    if (!rangeText) return null;
    const txt = normalizeDigits(String(rangeText)).trim();
    if (!txt) return null;
    if (/Ø¨ÛŒØ´/.test(txt)) return Infinity;
    const numbers = (txt.match(/\d+/g) || []).map(n => parseInt(n, 10));
    if (!numbers.length) return null;
    return Math.max(...numbers);
  }

  function mapGuideSizeToSpiralCode(sizeNum) {
    if (!sizeNum) return null;
    if (sizeNum <= 18) return "18";
    if (sizeNum <= 30) return "20_30";
    if (sizeNum <= 40) return "35_40";
    return "40p";
  }

  function getBindingGuideRows() {
    const table = document.querySelector('table[data-key="bindingSizeGuide"] tbody');
    if (!table) return [];
    const rows = Array.from(table.querySelectorAll("tr"));
    return rows
      .map(tr => {
        const tds = tr.querySelectorAll("td");
        if (tds.length < 2) return null;
        const sizeLabel = (tds[0].textContent || "").trim();
        const limitText = (tds[1].textContent || "").trim();
        const maxPages = parseGuideMaxPages(limitText);
        const sizeNumberMatch = normalizeDigits(sizeLabel).match(/\d+/);
        const sizeNumber = sizeNumberMatch ? parseInt(sizeNumberMatch[0], 10) : null;
        const spiralCode = mapGuideSizeToSpiralCode(sizeNumber);
        return {
          sizeLabel,
          maxPages,
          sizeNumber,
          spiralCode,
          rangeText: limitText
        };
      })
      .filter(Boolean);
  }

  function findBindingGuideSuggestion(pages) {
    const qty = parseIntSafe(pages);
    if (!qty || qty <= 0) return null;
    const rows = getBindingGuideRows();
    if (!rows.length) return null;

    let match = rows.find(r => r.maxPages && qty <= r.maxPages);
    if (!match) {
      match = rows[rows.length - 1];
    }
    return match || null;
  }

  function getBindingSpiralCodeByIndex(paperSize, index) {
    if (paperSize !== "A4") return "18";
    const codes = ["18", "20_30", "35_40", "40p"];
    if (index == null || index < 0) return codes[0];
    return codes[index] || codes[codes.length - 1];
  }

  function findBindingBaseEntryByPages(size, pagesPerSet, levelKey) {
    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†Ø±ÛŒ Ø¨Ø±Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡
    const table = document.querySelector('table[data-key="bindingBase"] tbody');
    if (!table) return null;

    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const rows = table.querySelectorAll("tr");
    if (!rows || !rows.length) return null;

    const qty = parseIntSafe(pagesPerSet);
    if (!qty) return null;

    let orderIdx = -1;

    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;

      const rowSize = (tds[0].textContent || "").trim();
      if (rowSize !== size) continue;

      orderIdx += 1;

      const rangeText = (tds[1].textContent || "").trim();
      if (!matchesQuantityRange(rangeText, qty)) continue;

      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText);
      if (price <= 0) return null;

      return {
        price,
        spiralCode: getBindingSpiralCodeByIndex(size, orderIdx)
      };
    }

    return null;
  }

  function findBindingBasePricePerSet(size, pagesPerSet, levelKey) {
    const info = findBindingBaseEntryByPages(size, pagesPerSet, levelKey);
    return info ? info.price : null;
  }

  function findBindingBasePriceBySpiral(paperSize, spiralCode, levelKey) {
    const table = document.querySelector('table[data-key="bindingBase"] tbody');
    if (!table) return null;

    const rows = Array.from(table.querySelectorAll("tr"));
    if (!rows.length) return null;

    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const sizeRows = rows.filter(tr => {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) return false;
      const rowSize = (tds[0].textContent || "").trim();
      return rowSize === paperSize;
    });

    if (!sizeRows.length) return null;

    if (paperSize === "A5" || paperSize === "A3") {
      const tds = sizeRows[0].querySelectorAll("td");
      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText);
      return price > 0 ? price : null;
    }

    let idx = -1;
    switch (spiralCode) {
      case "18":
        idx = 0;
        break;
      case "20_30":
        idx = 1;
        break;
      case "35_40":
        idx = 2;
        break;
      case "40p":
        idx = 3;
        break;
      default:
        idx = 0;
        break;
    }

    if (idx < 0 || idx >= sizeRows.length) return null;

    const tds = sizeRows[idx].querySelectorAll("td");
    if (tds.length < colIdx + 1) return null;

    const priceText = (tds[colIdx].textContent || "").trim();
    const price = parseMoney(priceText);
    return price > 0 ? price : null;
  }

  function findBindingCoverExtra(paperSize, coverType, levelKey) {
    if (!coverType || coverType === "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚") return 0;
    const table = document.querySelector('table[data-key="bindingCover"] tbody');
    if (!table) return 0;

    const rows = Array.from(table.querySelectorAll("tr"));
    if (!rows.length) return 0;

    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const wantedCover = String(coverType).trim();
    const wantedSize  = String(paperSize || "").trim();
    let fallbackPrice = 0;

    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;

      const rowCover = (tds[0].textContent || "").trim();
      const rowSize  = (tds[1].textContent || "").trim();
      if (!rowCover) continue;

      const coverMatches =
        rowCover === wantedCover ||
        rowCover.includes(wantedCover) ||
        wantedCover.includes(rowCover);
      if (!coverMatches) continue;

      const sizeMatches =
        !rowSize ||
        rowSize === "Ù‡Ù…Ù‡ Ø³Ø§ÛŒØ²Ù‡Ø§" ||
        !wantedSize ||
        rowSize === wantedSize ||
        rowSize.includes(wantedSize);

      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText) || 0;
      if (!price) continue;

      if (sizeMatches) {
        return price;
      }

      fallbackPrice = price;
    }

    return fallbackPrice;
  }

  function findBindingCutExtra(levelKey) {
    const table = document.querySelector('table[data-key="bindingCut"] tbody');
    if (!table) return 0;

    const colIdx = getTariffColumnIndexForLevel(levelKey);
    const row = table.querySelector("tr");
    if (!row) return 0;

    const tds = row.querySelectorAll("td");
    if (tds.length < colIdx + 1) return 0;

    const priceText = (tds[colIdx].textContent || "").trim();
    const price = parseMoney(priceText);
    return price || 0;
  }

  function calculateBindingPriceFromSelections(paperSize, levelKey, spiralCode, coverVal, jobType) {
    if (!spiralCode) {
      return { price: null, error: "missingSpiral" };
    }

    const basePrice = findBindingBasePriceBySpiral(paperSize, spiralCode, levelKey);
    if (basePrice == null) {
      return { price: null, error: "baseNotFound" };
    }

    const coverExtra = findBindingCoverExtra(paperSize, coverVal, levelKey) || 0;
    let cutExtra = 0;
    if (jobType === "Ú©ØªØ§Ø¨") {
      cutExtra = findBindingCutExtra(levelKey) || 0;
    }

    const total = basePrice + coverExtra + cutExtra;
    return {
      price: total,
      basePrice,
      coverExtra,
      cutExtra
    };
  }

  function getBindingSpiralCodeFromPages(pages) {
    const guideInfo = findBindingGuideSuggestion(pages);
    return guideInfo ? guideInfo.spiralCode : null;
  }


  function findLaminationPricePerUnit(size, levelKey) {
    // Ø¬Ø³ØªØ¬ÙˆÛŒ ØªØ¹Ø±ÙÙ‡Ù” Ù¾Ø±Ø³/Ù„Ù…ÛŒÙ†ÛŒØª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù¾Ø±Ø³ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø³Ø§ÛŒØ²
    const table = document.querySelector('table[data-key="lamination"] tbody');
    if (!table) return null;

    // Ø¬Ø¯ÙˆÙ„ Ù¾Ø±Ø³ Ø³ØªÙˆÙ† Ø¨Ø§Ø²Ù‡/ØªÙˆØ¶ÛŒØ­ Ù†Ø¯Ø§Ø±Ø¯Ø› Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø²ÛŒØ± Ù‡Ø³ØªÙ†Ø¯:
    // 0: Ø³Ø§ÛŒØ²ØŒ 1: Ø¹Ø§Ø¯ÛŒØŒ 2: Ø³Ø·Ø­ Û±ØŒ 3: Ø³Ø·Ø­ Û²ØŒ 4: Ø³Ø·Ø­ Û³
    let colIdx = 1;
    switch (levelKey) {
      case "normal":
        colIdx = 1; // Ø¹Ø§Ø¯ÛŒ
        break;
      case "1":
        colIdx = 2; // Ø³Ø·Ø­ Û±
        break;
      case "2":
        colIdx = 3; // Ø³Ø·Ø­ Û²
        break;
      case "3":
        colIdx = 4; // Ø³Ø·Ø­ Û³
        break;
      default:
        colIdx = 1;
        break;
    }

    const rows = table.querySelectorAll("tr");
    if (!rows || !rows.length) return null;

    const targetSize = String(size || "").trim();
    if (!targetSize) return null;

    for (const tr of rows) {
      const tds = tr.querySelectorAll("td");
      if (tds.length < colIdx + 1) continue;

      const rowSize = (tds[0].textContent || "").trim();
      if (!rowSize || rowSize !== targetSize) continue;

      const priceText = (tds[colIdx].textContent || "").trim();
      const price = parseMoney(priceText);
      if (price > 0) return price;
    }

    return null;
  }

  // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ù‡ ÙØ±Ù…Øª Ø¹Ø¯Ø¯ÛŒ (Ù…Ø«Ø§Ù„ 1404/09/01) Ø¨Ù‡ ØªØ§ÛŒÙ…â€ŒØ§Ø³ØªÙ…Ù¾ ØªÙ‚Ø±ÛŒØ¨ÛŒ
  // Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯ÛŒ ÛŒØ§ Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ù…Ø¹Ø§Ø¯Ù„ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø¯Ø± dateTime Ø§Ø³Øª
  // Ø§Ú¯Ø± ÛŒÚ© Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ØªÙ‚ÙˆÛŒÙ… Ø¬Ù„Ø§Ù„ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ØŒ Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ø§ Ø¨Ø§ÛŒØ¯ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ù†ÙˆØ´Øª.
  function parseJalaliDateToTimestamp(dateStr, endOfDay) {
    if (!dateStr) return null;
    // ØªÙ„Ø§Ø´ Ø³Ø§Ø¯Ù‡: Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù…Ø«Ù„ 1404/09/01 ÙˆØ§Ø±Ø¯ Ú©Ù†Ø¯ØŒ ÙØ¹Ù„Ø§Ù‹ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø¨Ù‡ Date Ø¨Ø³Ù¾Ø§Ø±ÛŒÙ…
    // ÛŒØ§ Ø§Ú¯Ø± ÙØ±Ù…Øª yyyy-mm-dd Ø¨ÙˆØ¯ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ….
    let normalized = dateStr.trim();
    // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù…Ù…ÛŒØ² Ø¨Ø§ Ø®Ø· ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ±
    normalized = normalized.replace(/\./g, "/");
    // Ø§Ú¯Ø± Ø·ÙˆÙ„ 10 Ùˆ Ø´Ø§Ù…Ù„ / Ø§Ø³ØªØŒ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Date
    let d = new Date(normalized);
    if (isNaN(d.getTime())) {
      return null;
    }
    if (endOfDay) {
      d.setHours(23, 59, 59, 999);
    } else {
      d.setHours(0, 0, 0, 0);
    }
    return d.getTime();
  }

function formatMoney(num) {
    if (!num) return "0";
    try { return num.toLocaleString("fa-IR"); }
    catch (e) { return String(num); }
  }
  function setupMoneyInputs() {
    const moneyInputs = document.querySelectorAll("input.money");
    moneyInputs.forEach(inp => {
      if (inp.readOnly) return;
      inp.addEventListener("input", function () {
        let raw = normalizeDigits(inp.value);
        raw = raw.replace(/[^\d\-]/g, "");
        if (!raw) { inp.value = ""; return; }
        const num = parseInt(raw, 10);
        if (isNaN(num)) { inp.value = ""; return; }
        inp.value = formatMoney(num);
      });
      inp.addEventListener("blur", function () {
        if (!inp.value) return;
        const num = parseMoney(inp.value);
        inp.value = num ? formatMoney(num) : "";
      });
    });
  }

   
  // --- Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ù†Ù‚Ø´â€ŒÙ‡Ø§ ---

  const USERS_STORAGE_KEY = "copyApp_users_v1";
  let currentUser = null;
  let currentEditingOrderId = null;

  function loadUsers() {
    try {
      const raw = window.localStorage.getItem(USERS_STORAGE_KEY);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      if (!Array.isArray(parsed)) return [];
      return parsed;
    } catch (e) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:", e);
      return [];
    }
  }

  function saveUsers(users) {
    try {
      window.localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users || []));
    } catch (e) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:", e);
    }
  }

  function ensureDefaultAdminUser() {
    let users = loadUsers();
    if (!users.some(u => u && u.username === "admin")) {
      users.push({
        id: Date.now().toString(),
        fullName: "Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…",
        username: "admin",
        password: "1234",
        role: "admin"
      });
      saveUsers(users);
    }
  }

  function fixAdminRole() {
  let users = loadUsers();
  let changed = false;

  users = users.map(u => {
    if (!u) return u;
    if (u.username === "admin" && u.role !== "admin") {
      u.role = "admin";
      changed = true;
    }
    return u;
  });

  if (changed) {
    saveUsers(users);
  }
}
// Ø¯Ø± Ø´Ø±ÙˆØ¹ØŒ Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ ÛŒÚ©ÛŒ Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒÙ…
  ensureDefaultAdminUser();
// Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ Ù†Ù‚Ø´ Ø§Ø´ØªØ¨Ø§Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ù†Ù‚Ø´â€ŒØ´ Ø±Ùˆ Ø§ØµÙ„Ø§Ø­ Ú©Ù†
  fixAdminRole();

  
function applyRolePermissions() {
    const role = currentUser && currentUser.role ? currentUser.role : "admin";

    const menuButtons = document.querySelectorAll(".main-menu button[data-page]");
    menuButtons.forEach(btn => {
      btn.classList.remove("hidden");
      btn.disabled = false;
    });

    const btnOpenOrders = document.getElementById("btnOpenOrders");
    const btnCashFromBox = document.getElementById("btnCashFromBox");
    const btnUsersPage = document.getElementById("btnUsersPage");

    if (btnOpenOrders) btnOpenOrders.classList.remove("hidden");
    if (btnCashFromBox) btnCashFromBox.classList.remove("hidden");

    if (role === "cashier") {
      // ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±: ÙÙ‚Ø· Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ùˆ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† + Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² + ØµÙ†Ø¯ÙˆÙ‚
      menuButtons.forEach(btn => {
        const page = btn.dataset.page;
        if (page !== "orders" && page !== "customers") {
          btn.classList.add("hidden");
        }
      });
      if (btnUsersPage) btnUsersPage.classList.add("hidden");
    } else if (role === "supervisor") {
      // Ø³Ø±Ù¾Ø±Ø³Øª: Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù‡Ù…Ù‡ ØµÙØ­Ø§ØªØŒ Ø§Ù…Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙÙ‚Ø· Ø¨Ù‡ ØµÙˆØ±Øª Ù†Ù…Ø§ÛŒØ´ÛŒ
      if (btnUsersPage) btnUsersPage.classList.remove("hidden");
    } else {
      // Ù…Ø¯ÛŒØ±: Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„
      if (btnUsersPage) btnUsersPage.classList.remove("hidden");
    }

    if (typeof applyUserPagePermissions === "function") {
      applyUserPagePermissions();
    }
  }

  
// Ù…Ø¯ÛŒØ±ÛŒØª ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
  const usersTableBody = document.getElementById("usersTableBody");
  const newUserFullNameInput = document.getElementById("newUserFullName");
  const newUserUsernameInput = document.getElementById("newUserUsername");
  const newUserPasswordInput = document.getElementById("newUserPassword");
  const newUserRoleSelect = document.getElementById("newUserRole");
  const btnAddUser = document.getElementById("btnAddUser");
  const btnCancelEdit = document.getElementById("btnCancelEdit");
  const editingUserIdInput = document.getElementById("editingUserId");
  const userFormTitle = document.getElementById("userFormTitle");
  const userFormStatus = document.getElementById("userFormStatus");
  const userAddSection = document.getElementById("userAddSection");

  // Ø³Ú©Ø´Ù† ØªØºÛŒÛŒØ± Ù†Ù‚Ø´
  const roleChangeSection = document.getElementById("roleChangeSection");
  const roleChangeStatus = document.getElementById("roleChangeStatus");
  const roleChangeSelect = document.getElementById("roleChangeSelect");
  const roleChangeUserIdInput = document.getElementById("roleChangeUserId");
  const btnSaveRoleChange = document.getElementById("btnSaveRoleChange");
  const btnCancelRoleChange = document.getElementById("btnCancelRoleChange");

  function getRoleText(role) {
    switch (role) {
      case "admin": return "Ù…Ø¯ÛŒØ±";
      case "supervisor": return "Ø³Ø±Ù¾Ø±Ø³Øª";
      case "cashier": return "ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±";
      default: return role || "-";
    }
  }

  function getRoleBadgeClass(role) {
    switch (role) {
      case "admin": return "role-badge admin";
      case "supervisor": return "role-badge supervisor";
      case "cashier": return "role-badge cashier";
      default: return "role-badge";
    }
  }

  function resetUserForm() {
    if (editingUserIdInput) editingUserIdInput.value = "";
    if (userFormTitle) userFormTitle.textContent = "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯";
    if (userFormStatus) userFormStatus.textContent = "Ø­Ø§Ù„Øª: Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯";
    if (btnAddUser) btnAddUser.textContent = "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±";
    if (newUserFullNameInput) newUserFullNameInput.value = "";
    if (newUserUsernameInput) newUserUsernameInput.value = "";
    if (newUserPasswordInput) newUserPasswordInput.value = "";
    if (newUserRoleSelect) newUserRoleSelect.value = "cashier";
  }

  function fillUserFormForEdit(user) {
    if (!editingUserIdInput) return;
    editingUserIdInput.value = user.id;
    if (newUserFullNameInput) newUserFullNameInput.value = user.fullName || "";
    if (newUserUsernameInput) newUserUsernameInput.value = user.username || "";
    if (newUserRoleSelect) newUserRoleSelect.value = user.role || "cashier";
    if (userFormTitle) userFormTitle.textContent = "ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±";
    if (userFormStatus) {
      const name = user.fullName || user.username || "";
      userFormStatus.textContent = name ? ("Ø­Ø§Ù„Øª: ÙˆÛŒØ±Ø§ÛŒØ´ " + name) : "Ø­Ø§Ù„Øª: ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±";
    }
    if (btnAddUser) btnAddUser.textContent = "Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª";
  }

  function resetRoleChangeSection() {
    if (!roleChangeSection) return;
    roleChangeSection.classList.add("hidden");
    if (roleChangeUserIdInput) roleChangeUserIdInput.value = "";
    if (roleChangeSelect) roleChangeSelect.value = "cashier";
    if (roleChangeStatus) roleChangeStatus.textContent = "Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.";
  }

  function openRoleChangeSection(user) {
    if (!roleChangeSection) return;
    if (roleChangeUserIdInput) roleChangeUserIdInput.value = user.id;
    if (roleChangeSelect) roleChangeSelect.value = user.role || "cashier";
    if (roleChangeStatus) {
      const name = user.fullName || user.username || "";
      roleChangeStatus.textContent = name ? ("Ø¯Ø± Ø­Ø§Ù„ ØªØºÛŒÛŒØ± Ù†Ù‚Ø´: " + name) : "ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±";
    }
    roleChangeSection.classList.remove("hidden");
    if (typeof roleChangeSection.scrollIntoView === "function") {
      roleChangeSection.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }

  function refreshUsersTable() {
    if (!usersTableBody) return;
    const users = loadUsers();
    usersTableBody.innerHTML = "";
    if (!users.length) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="6" style="text-align:center;color:#666;">Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>';
      usersTableBody.appendChild(tr);
      return;
    }
    users.forEach((u, index) => {
      const tr = document.createElement("tr");
      const safeFullName = (u.fullName || "").replace(/"/g, '&quot;');
      const safeUsername = (u.username || "").replace(/"/g, '&quot;');
      const role = u.role || "cashier";
      const badgeClass = getRoleBadgeClass(role);
      tr.setAttribute("data-user-id", u.id);
      const statusText = (u.active === false) ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${safeFullName}</td>
        <td>${safeUsername}</td>
        <td><span class="${badgeClass}">${getRoleText(role)}</span></td>
        <td>${statusText}</td>
        <td class="user-actions-col">
          <div class="user-actions">
            <button type="button" class="btn-chip edit" data-action="edit-user" data-user-id="${u.id}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
            <button type="button" class="btn-chip role" data-action="change-role" data-user-id="${u.id}">ØªØºÛŒÛŒØ± Ù†Ù‚Ø´</button>
            <button type="button" class="btn-chip delete" data-action="delete-user" data-user-id="${u.id}">Ø­Ø°Ù</button>
          </div>
        </td>
      `;
      usersTableBody.appendChild(tr);
    });

    applyUserPagePermissions();
  }

  function applyUserPagePermissions() {
    const role = currentUser && currentUser.role ? currentUser.role : "admin";
    if (!userAddSection) return;

    if (role === "admin") {
      userAddSection.style.display = "";
      if (usersTableBody) {
        usersTableBody.querySelectorAll(".user-actions-col button").forEach(btn => {
          btn.disabled = false;
          btn.style.opacity = "1";
        });
      }
      if (roleChangeSection) {
        // Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø³Ú©Ø´Ù† ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯ (Ø¯Ø± ØµÙˆØ±Øª ÙØ¹Ø§Ù„ Ø´Ø¯Ù†)
      }
    } else {
      // Ø³Ø±Ù¾Ø±Ø³Øª Ùˆ ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±: ÙÙ‚Ø· Ù…Ø´Ø§Ù‡Ø¯Ù‡
      userAddSection.style.display = "none";
      if (usersTableBody) {
        usersTableBody.querySelectorAll(".user-actions-col button").forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = "0.5";
        });
      }
      if (roleChangeSection) {
        roleChangeSection.classList.add("hidden");
      }
    }
  }

  if (btnAddUser) {
    btnAddUser.addEventListener("click", () => {
      if (!currentUser || currentUser.role !== "admin") {
        alert("ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯.");
        return;
      }
      const fullName = newUserFullNameInput ? newUserFullNameInput.value.trim() : "";
      const username = newUserUsernameInput ? newUserUsernameInput.value.trim() : "";
      const password = newUserPasswordInput ? newUserPasswordInput.value : "";
      const role = newUserRoleSelect ? newUserRoleSelect.value : "cashier";

      if (!username) {
        alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
        return;
      }

      let users = loadUsers();
      const editingId = editingUserIdInput ? editingUserIdInput.value : "";

      const duplicate = users.find(u => u.username === username && String(u.id) !== String(editingId || ""));
      if (duplicate) {
        alert("Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª.");
        return;
      }

      if (editingId) {
        const index = users.findIndex(u => String(u.id) === String(editingId));
        if (index === -1) {
          alert("Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        } else {
          users[index].fullName = fullName || username;
          users[index].username = username;
          users[index].role = role;
          if (password) {
            users[index].password = password;
          }
          saveUsers(users);
          alert("ØªØºÛŒÛŒØ±Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
        }
      } else {
        const newUser = {
          id: Date.now().toString(),
          fullName: fullName || username,
          username: username,
          password: password || "",
          role: role
        };
        users.push(newUser);
        saveUsers(users);
        alert("Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");
      }

      resetUserForm();
      refreshUsersTable();
    });
  }

  if (btnCancelEdit) {
    btnCancelEdit.addEventListener("click", () => {
      resetUserForm();
    });
  }

  if (btnSaveRoleChange) {
    btnSaveRoleChange.addEventListener("click", () => {
      if (!currentUser || currentUser.role !== "admin") {
        alert("ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯.");
        return;
      }
      if (!roleChangeUserIdInput || !roleChangeSelect) return;
      const userId = roleChangeUserIdInput.value;
      const newRole = roleChangeSelect.value || "cashier";
      let users = loadUsers();
      const index = users.findIndex(u => String(u.id) === String(userId));
      if (index === -1) {
        alert("Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        return;
      }
      users[index].role = newRole;
      saveUsers(users);
      alert("Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.");
      resetRoleChangeSection();
      refreshUsersTable();
    });
  }

  if (btnCancelRoleChange) {
    btnCancelRoleChange.addEventListener("click", () => {
      resetRoleChangeSection();
    });
  }

  if (usersTableBody) {
    usersTableBody.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      const action = btn.getAttribute("data-action");
      const userId = btn.getAttribute("data-user-id");
      if (!action || !userId) return;

      if (action === "delete-user") {
        if (!currentUser || currentUser.role !== "admin") {
          alert("ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø­Ø°Ù Ú©Ù†Ø¯.");
          return;
        }
        if (!confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")) {
          return;
        }
        let users = loadUsers();
        users = users.filter(u => String(u.id) !== String(userId));
        saveUsers(users);
        alert("Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø´Ø¯.");
        refreshUsersTable();
      } else if (action === "edit-user") {
        if (!currentUser || currentUser.role !== "admin") {
          alert("ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†Ø¯.");
          return;
        }
        const users = loadUsers();
        const user = users.find(u => String(u.id) === String(userId));
        if (!user) {
          alert("Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          return;
        }
        fillUserFormForEdit(user);
        if (userAddSection && typeof userAddSection.scrollIntoView === "function") {
          userAddSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      } else if (action === "change-role") {
        if (!currentUser || currentUser.role !== "admin") {
          alert("ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯.");
          return;
        }
        const users = loadUsers();
        const user = users.find(u => String(u.id) === String(userId));
        if (!user) {
          alert("Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          return;
        }
        openRoleChangeSection(user);
      }
    });
  }

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
  resetUserForm();
  resetRoleChangeSection();
  refreshUsersTable();


// Ù†Ù‚Ø´Ù‡Ù” ØµÙØ­Ø§Øª Ø§ØµÙ„ÛŒ
  const pages = {
    orders: document.getElementById("pageOrders"),
    reports: document.getElementById("pageReports"),
    customers: document.getElementById("pageCustomers"),
    prices: document.getElementById("pagePrices"),
    users: document.getElementById("pageUsers"),
  };

  // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡: Ù†Ù‚Ø´ Ø¨Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ø¯ØŸ
  function canAccessPage(role, page) {
    // Ù…Ø¯ÛŒØ± Ùˆ Ø³Ø±Ù¾Ø±Ø³Øª Ø¨Ù‡ Ù‡Ù…Ù‡Ù” ØµÙØ­Ø§Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù†Ø¯
    if (role === "admin" || role === "supervisor") return true;

    // ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø± ÙÙ‚Ø· Ø¨Ù‡ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ùˆ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ø¯
    if (role === "cashier") {
      return page === "orders" || page === "customers";
    }

    // Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± (ÛŒØ§ Ù‚Ø¯ÛŒÙ…ÛŒ) ÙØ¹Ù„Ø§Ù‹ Ø¨Ù‡ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù†Ø¯
    return true;
  }

  // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø¨Ø§ Ø¯Ø±Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ
  function showPage(name) {
    const role = currentUser && currentUser.role ? currentUser.role : "admin";

    if (!canAccessPage(role, name)) {
      alert("Ø´Ù…Ø§ Ø¨Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.");
      name = "orders";
    }

    Object.keys(pages).forEach(key => {
      if (pages[key]) {
        pages[key].classList.toggle("hidden", key !== name);
      }
    });

    if (name === "customers") {
      attachCustomerAccountsEvents();
      refreshCustomerAccountsList();
    } else if (name === "users") {
      refreshUsersTable();
      applyUserPagePermissions();
    }
  }

  // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
  document.querySelectorAll(".main-menu button").forEach(btn => {
    btn.addEventListener("click", () => {
      // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ØŒ Ø§Ø¬Ø§Ø²Ù‡Ù” Ø³ÙˆØ¦ÛŒÚ† ØµÙØ­Ù‡ Ù†Ø¯Ù‡
      if (!currentUser) {
        const lm = document.getElementById("loginModal");
        if (lm) lm.classList.add("show");
        else alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø´ÙˆÛŒØ¯.");
        return;
      }

      document
        .querySelectorAll(".main-menu button")
        .forEach(b => b.classList.remove("active"));

      btn.classList.add("active");
      const pageName = btn.dataset.page;
      if (pageName) {
        showPage(pageName);
        if (pageName === "reports" && typeof onEnterReportsPage === "function") {
          onEnterReportsPage();
        }
      }
    });
  });

  // Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´
  showPage("orders");




  // --- Ù„Ø§Ú¯ÛŒÙ† ---
  const loginModal = document.getElementById("loginModal");
  const currentUserNameSpan = document.getElementById("currentUserName");
  const currentUserRoleSpan = document.getElementById("currentUserRoleLabel");
  const btnLogin = document.getElementById("btnLogin");
  const btnChangeUser = document.getElementById("btnChangeUser");

  function updateCurrentUserUI() {
    const nameToShow = currentUser && (currentUser.fullName || currentUser.username) ? (currentUser.fullName || currentUser.username) : "(ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡)";
    if (currentUserNameSpan) {
      currentUserNameSpan.textContent = nameToShow;
    }
    if (currentUserRoleSpan) {
      const role = currentUser && currentUser.role ? currentUser.role : "";
      let roleText = "";
      if (role === "admin") roleText = "(Ù…Ø¯ÛŒØ±)";
      else if (role === "supervisor") roleText = "(Ø³Ø±Ù¾Ø±Ø³Øª)";
      else if (role === "cashier") roleText = "(ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±)";
      currentUserRoleSpan.textContent = roleText;
    }
  }

  if (btnLogin) {
    btnLogin.addEventListener("click", () => {
      const usernameInput = document.getElementById("loginUser");
      const passwordInput = document.getElementById("loginPass");
      const username = usernameInput ? usernameInput.value.trim() : "";
      const password = passwordInput ? passwordInput.value : "";

      if (!username) {
        alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
        return;
      }

      let users = loadUsers();
      let idx = users.findIndex(u => u && u.username === username);
      if (idx === -1) {
        alert("Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        return;
      }

      let user = users[idx];

      // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡ØŒ Ø§ÙˆÙ„ÛŒÙ† Ø±Ù…Ø² ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ø§ÛŒØ´ Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      if (!user.password) {
        if (!password) {
          alert("Ø¨Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ† ÙˆØ±ÙˆØ¯ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±ØŒ ÛŒÚ© Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ØªØ¹ÛŒÛŒÙ† Ú©Ù†ÛŒØ¯.");
          return;
        }
        user.password = password;
        users[idx] = user;
        saveUsers(users);
      } else if (user.password !== password) {
        alert("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.");
        return;
      }

      currentUser = user;
      updateCurrentUserUI();
      if (loginModal) {
        loginModal.classList.remove("show");
      }

      applyRolePermissions();
    });
  }

  if (btnChangeUser) {
    btnChangeUser.addEventListener("click", () => {
      currentUser = null;
      updateCurrentUserUI();
      if (loginModal) {
        const userInput = document.getElementById("loginUser");
        const passInput = document.getElementById("loginPass");
        if (userInput) userInput.value = "";
        if (passInput) passInput.value = "";
        loginModal.classList.add("show");
      }
    });
  }

// --- Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ ---
  const customerSearchModal = document.getElementById("customerSearchModal");
  const customerNewModal    = document.getElementById("customerNewModal");

  document.getElementById("btnSearchCustomer").addEventListener("click", () => {
    customerSearchModal.classList.add("show");
  });
  document.getElementById("btnSearchCancel").addEventListener("click", () => {
    customerSearchModal.classList.remove("show");
  });
  document.getElementById("btnSearchApply").addEventListener("click", () => {
    customerSearchModal.classList.remove("show");
  });

  document.getElementById("btnNewCustomer").addEventListener("click", () => {
    customerNewModal.classList.add("show");
  });
  document.getElementById("btnNewCustomerCancel").addEventListener("click", () => {
    customerNewModal.classList.remove("show");
  });

  const newCustomerName          = document.getElementById("newCustomerName");
  const newCustomerTypeRadios    = document.querySelectorAll("input[name='newCustomerType']");
  const newCustomerPriceLevelRow = document.getElementById("newCustomerPriceLevelRow");
  const newCustomerPriceLevelSel = document.getElementById("newCustomerPriceLevel");
  const orderPriceLevelSelect    = document.getElementById("orderPriceLevel");
  const txtCustomerName          = document.getElementById("txtCustomerName");

  let currentCustomerInfo = {
    type: "normal",
    priceLevel: "normal",
  };

  function updateNewCustomerPriceLevelVisibility() {
    let t = "normal";
    newCustomerTypeRadios.forEach(r => { if (r.checked) t = r.value; });
    if (t === "partner") newCustomerPriceLevelRow.classList.remove("hidden");
    else newCustomerPriceLevelRow.classList.add("hidden");
  }
  newCustomerTypeRadios.forEach(r => {
    r.addEventListener("change", updateNewCustomerPriceLevelVisibility);
  });
  function updateOrderPriceLevelFromCustomer() {
    if (currentCustomerInfo.type === "partner") {
      orderPriceLevelSelect.value = currentCustomerInfo.priceLevel || "1";
    } else {
      orderPriceLevelSelect.value = "normal";
    }
  }
  document.getElementById("btnNewCustomerSave").addEventListener("click", () => {
    const name = newCustomerName.value.trim();
    if (name) txtCustomerName.value = name;

    let cType = "normal";
    newCustomerTypeRadios.forEach(r => { if (r.checked) cType = r.value; });
    let lvl = "normal";
    if (cType === "partner") lvl = newCustomerPriceLevelSel.value || "1";

    currentCustomerInfo = { type: cType, priceLevel: lvl };
    updateOrderPriceLevelFromCustomer();
    customerNewModal.classList.remove("show");
  });

  // --- Ø¹Ù†Ø§ØµØ± ÙØ±Ù… Ø³ÙØ§Ø±Ø´ ---
  const itemsBody          = document.getElementById("itemsBody");
  const btnAddItem         = document.getElementById("btnAddItem");
  const btnApplyToRow      = document.getElementById("btnApplyToRow");

  const serviceTypeInput   = document.getElementById("serviceType");
  const shortDescInput     = document.getElementById("shortDesc");
  const pagesPerSetInput   = document.getElementById("pagesPerSet");
  const setCountInput      = document.getElementById("setCount");
  const totalPagesInput    = document.getElementById("totalPages");

  const paperSizeSelect    = document.getElementById("paperSize");
  const colorModeSelect    = document.getElementById("colorMode");
  const colorCoverageSelect= document.getElementById("colorCoverage");
  const printTypeSelect    = document.getElementById("printType");
  const paperTypeSelect    = document.getElementById("paperType");
  const paperWeightSelect  = document.getElementById("paperWeight");

  const fieldPaperSize     = document.getElementById("fieldPaperSize");
  const fieldColor         = document.getElementById("fieldColor");
  const fieldColorCoverage = document.getElementById("fieldColorCoverage");
  const fieldPrintType     = document.getElementById("fieldPrintType");
  const fieldPagesPerSet   = document.getElementById("fieldPagesPerSet");
  const fieldSetCount      = document.getElementById("fieldSetCount");
  const fieldTotalPages    = document.getElementById("fieldTotalPages");
  const fieldPaperType     = document.getElementById("fieldPaperType");
  const paperWeightField   = document.getElementById("paperWeightField");

  const bindingSpiralRow   = document.getElementById("bindingSpiralRow");
  const bindingCoverRow    = document.getElementById("bindingCoverRow");
  const bindingCoverAnchorMain  = document.getElementById("bindingCoverRowAnchorMain");
  const bindingCoverAnchorExtra = document.getElementById("bindingCoverRowAnchorExtra");
  const bindingJobTypeRow  = document.getElementById("bindingJobTypeRow");
  const bindingSpiralSize  = document.getElementById("bindingSpiralSize");
  const bindingCover       = document.getElementById("bindingCover");
  const bindingSpiralHint  = document.getElementById("bindingSpiralHint");
  const extraBindingHintRow    = document.getElementById("extraBindingHintRow");
  const extraBindingSpiralHint = document.getElementById("extraBindingSpiralHint");
  const bindingJobTypeRadios = document.querySelectorAll("input[name='bindingJobType']");

  function resolveBindingInfo(paperSize, levelKey, sheetCountOverride) {
    let bindInfo = null;

    const effectiveSheets = sheetCountOverride != null
      ? parseIntSafe(sheetCountOverride)
      : parseIntSafe(pagesPerSetInput ? pagesPerSetInput.value : "");

    const guideInfo = effectiveSheets ? findBindingGuideSuggestion(effectiveSheets) : null;

    if (effectiveSheets) {
      bindInfo = findBindingBaseEntryByPages(paperSize, effectiveSheets, levelKey);
    }

    if (!bindInfo && effectiveSheets) {
      const autoSpiral = (guideInfo && guideInfo.spiralCode) || getBindingSpiralCodeFromPages(effectiveSheets);
      if (autoSpiral) {
        const byAuto = findBindingBasePriceBySpiral(paperSize, autoSpiral, levelKey);
        if (byAuto != null) {
          bindInfo = { price: byAuto, spiralCode: autoSpiral };
        }
      }
    }

    if (!bindInfo && bindingSpiralSize && bindingSpiralSize.value) {
      const bySpiral = findBindingBasePriceBySpiral(paperSize, bindingSpiralSize.value, levelKey);
      if (bySpiral != null) {
        bindInfo = { price: bySpiral, spiralCode: bindingSpiralSize.value };
      }
    }

    if (bindInfo && guideInfo) {
      bindInfo.guideInfo = guideInfo;
    } else if (!bindInfo && guideInfo) {
      bindInfo = { price: null, spiralCode: guideInfo.spiralCode || "", guideInfo };
    }

    return bindInfo;
  }

  const extraSection       = document.getElementById("extraSection");
  const extraBindingChk    = document.getElementById("extraBinding");
  const extraStapleChk     = document.getElementById("extraStaple");
  const extraCourierChk    = document.getElementById("extraCourier");
  const lblExtraBinding    = document.querySelector("label[for='extraBinding']");
  const lblExtraStaple     = document.querySelector("label[for='extraStaple']");
  const priceBindingField  = document.getElementById("priceBindingField");
  const priceStapleField   = document.getElementById("priceStapleField");
  const priceBindingInput  = document.getElementById("priceBinding");
  const priceStapleInput   = document.getElementById("priceStaple");

  const courierRow         = document.getElementById("courierRow");
  const courierAmountInput = document.getElementById("courierAmount");
  const courierWhoRadios   = document.querySelectorAll("input[name='courierWho']");

  const pagesHint          = document.getElementById("pagesHint");
  const labelPagesPerSet   = document.getElementById("labelPagesPerSet");
  const labelSetCount      = document.getElementById("labelSetCount");
  const labelTotalPages    = document.getElementById("labelTotalPages");

  const priceMainLabel     = document.getElementById("priceMainLabel");
  const priceMainInput     = document.getElementById("priceMain");
  const pricePerSetInput   = document.getElementById("pricePerSet");
  const rowTotalInput      = document.getElementById("rowTotal");
  
  const 
  btnSuggestPrice   = document.getElementById("btnSuggestPrice");
  if (btnSuggestPrice) {
    btnSuggestPrice.addEventListener("click", function () {
      const type = serviceTypeInput.value;

      // Ø­Ø§Ù„Øª ÙÙ†Ø±ÛŒ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø®Ø¯Ù…Øª Ø§ØµÙ„ÛŒ
      if (type === "ÙÙ†Ø±ÛŒ") {
        const paperSize = paperSizeSelect.value || "A4";
        const levelKey  = getCurrentPriceLevelKey();
        let spiralCode = bindingSpiralSize ? bindingSpiralSize.value : "";
        const coverVal   = bindingCover ? bindingCover.value : "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
        const jobType    = typeof getBindingJobType === "function" ? getBindingJobType() : "Ø¬Ø²ÙˆÙ‡";
        const approxPages = parseIntSafe(pagesPerSetInput ? pagesPerSetInput.value : "");
        const guideInfo = findBindingGuideSuggestion(approxPages);
        if (guideInfo && guideInfo.spiralCode && bindingSpiralSize) {
          bindingSpiralSize.value = guideInfo.spiralCode;
          spiralCode = guideInfo.spiralCode;
        }
        updateBindingSuggestion(spiralCode, { guideInfo });

        const calc = calculateBindingPriceFromSelections(paperSize, levelKey, spiralCode, coverVal, jobType);
        if (!calc || calc.price == null) {
          if (!spiralCode) {
            alert("Ù„Ø·ÙØ§Ù‹ Ø³Ø§ÛŒØ² ÙÙ†Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
          } else {
            alert("Ø±Ø¯ÛŒÙÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ø§ÛŒØ² ÙÙ†Ø± Ùˆ Ø³Ø§ÛŒØ² Ú©Ø§Ø± Ø¯Ø± Ø¬Ø¯ÙˆÙ„ ÙÙ†Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          }
          return;
        }

        priceMainInput.value = formatMoney(calc.price);
        recalcDetail();
        return;
      }

      // Ø­Ø§Ù„Øª Ù¾Ø±Ø³ (Ù„Ù…ÛŒÙ†ÛŒØª) Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø®Ø¯Ù…Øª Ø§ØµÙ„ÛŒ
      if (type === "Ù¾Ø±Ø³") {
        const paperSize = paperSizeSelect.value || "A4";
        const levelKey  = getCurrentPriceLevelKey();
        let setCount    = parseIntSafe(setCountInput.value);
        if (!setCount) setCount = 0;

        const lamBase = findLaminationPricePerUnit(paperSize, levelKey);
        if (lamBase == null) {
          alert("Ø¯Ø± Ø¬Ø¯ÙˆÙ„ ØªØ¹Ø±ÙÙ‡ Ù¾Ø±Ø³/Ù„Ù…ÛŒÙ†ÛŒØªØŒ Ø±Ø¯ÛŒÙÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ø§ÛŒØ² Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          return;
        }

        priceMainInput.value = formatMoney(lamBase);
        recalcDetail();
        return;
      }

      // Ø³Ø§ÛŒØ± Ø­Ø§Ù„Ø§Øª: ÙÙ‚Ø· Ú©Ù¾ÛŒ Ùˆ Ù¾Ø±ÛŒÙ†Øª
      if (type !== "Ú©Ù¾ÛŒ" && type !== "Ù¾Ø±ÛŒÙ†Øª") {
        alert("Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ¹Ø±ÙÙ‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†ØªØŒ ÙÙ†Ø±ÛŒ Ùˆ Ù¾Ø±Ø³ ÙØ¹Ø§Ù„ Ø§Ø³Øª.");
        return;
      }

      const paperSize = paperSizeSelect.value || "A4";
      const colorMode = colorModeSelect.value || "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯";
      const printType = printTypeSelect.value || "ÛŒÚ©â€ŒØ±Ùˆ";

      let pagesPerSet = parseIntSafe(pagesPerSetInput.value);
      let setCount    = parseIntSafe(setCountInput.value);
      if (!pagesPerSet || !setCount) {
        alert("Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨ØªÙˆØ§Ù† Ù‚ÛŒÙ…Øª Ø±Ø§ Ø§Ø² Ø±ÙˆÛŒ ØªØ¹Ø±ÙÙ‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ø±Ø¯.");
        return;
      }

      let sheetsPerSet = 0;
      let totalSheets  = 0;

      if (type === "Ú©Ù¾ÛŒ") {
        sheetsPerSet = pagesPerSet;
        totalSheets  = sheetsPerSet * setCount;
      } else if (type === "Ù¾Ø±ÛŒÙ†Øª") {
        if (printType === "Ø¯ÙˆØ±Ùˆ") {
          sheetsPerSet = Math.ceil(pagesPerSet / 2);
        } else {
          sheetsPerSet = pagesPerSet;
        }
        totalSheets = sheetsPerSet * setCount;
      }

      if (!totalSheets) {
        alert("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¨Ø±Ú¯ ØµÙØ± Ø§Ø³ØªØ› Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¯ÛŒÙ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯.");
        return;
      }

      const levelKey = getCurrentPriceLevelKey();
      let pricePerSheet = null;

      if (colorMode === "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") {
        let basePrice = findBwPricePerSheet(paperSize, totalSheets, levelKey);
        if (basePrice == null) {
          alert("Ø¯Ø± Ø¬Ø¯ÙˆÙ„ ØªØ¹Ø±ÙÙ‡ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯ØŒ Ø±Ø¯ÛŒÙÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ø§ÛŒØ² Ùˆ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          return;
        }
        if (printType === "ÛŒÚ©â€ŒØ±Ùˆ") {
          const disc = getBwSingleDiscountPerSheet(levelKey);
          basePrice = Math.max(0, basePrice - disc);
        }
        pricePerSheet = basePrice;
      } 
      else if (colorMode === "Ø±Ù†Ú¯ÛŒ") {
        let basePrice = findColorBasePricePerSheet(paperSize, totalSheets, levelKey);
        if (basePrice == null) {
          alert("Ø¯Ø± Ø¬Ø¯ÙˆÙ„ ØªØ¹Ø±ÙÙ‡ Ø±Ù†Ú¯ÛŒØŒ Ø±Ø¯ÛŒÙÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ø§ÛŒØ² Ùˆ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
          return;
        }
        if (printType === "Ø¯ÙˆØ±Ùˆ") {
          const extra = getColorDuplexExtraPerSheet(levelKey);
          basePrice += extra;
        }
        if (typeof getColorCoverageAdjustPerSheet === "function" && colorCoverageSelect) {
          const coverageCode = colorCoverageSelect.value || "50-70";
          const covAdj = getColorCoverageAdjustPerSheet(levelKey, coverageCode);
          basePrice = Math.max(0, basePrice + covAdj);
        }
        if (typeof getColorWeightExtraPerSheet === "function" && paperTypeSelect && paperWeightSelect) {
          const pType   = paperTypeSelect.value || "";
          const pWeight = parseIntSafe(paperWeightSelect.value);
          if (pType && pWeight) {
            const wExtra = getColorWeightExtraPerSheet(levelKey, pType, pWeight);
            basePrice = Math.max(0, basePrice + wExtra);
          }
        }
        pricePerSheet = basePrice;
      }


      
      // Ø¯Ø± ØµÙˆØ±Øª Ø§Ù†ØªØ®Ø§Ø¨ ÙÙ†Ø±ÛŒ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø®Ø¯Ù…Øª Ø§Ø¶Ø§ÙÙ‡ØŒ Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ø±Ø§ Ø§Ø² ØªØ¹Ø±ÙÙ‡ ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†ÛŒÙ…
      if (extraBindingChk && extraBindingChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª")) {
        const bindingSheets = sheetsPerSet || pagesPerSet;
        const bindInfo = resolveBindingInfo(paperSize, levelKey, bindingSheets);
        const guideInfo = (bindInfo && bindInfo.guideInfo) || findBindingGuideSuggestion(bindingSheets);
        if (bindInfo && bindInfo.price > 0) {
          if (bindInfo.spiralCode && bindingSpiralSize) {
            bindingSpiralSize.value = bindInfo.spiralCode;
          }
          const coverVal   = bindingCover ? bindingCover.value : "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
          const coverExtra = findBindingCoverExtra(paperSize, coverVal, levelKey) || 0;
          priceBindingInput.value = formatMoney(bindInfo.price + coverExtra);
        }
        updateBindingSuggestion(bindingSpiralSize ? bindingSpiralSize.value : "", { guideInfo });
      }

if (pricePerSheet == null || pricePerSheet <= 0) {
        alert("Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø§Ø² ØªØ¹Ø±ÙÙ‡ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ø› Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¬Ø¯ÙˆÙ„ ØªØ¹Ø±ÙÙ‡ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
        return;
      }

      priceMainInput.value = formatMoney(pricePerSheet);
      recalcDetail();
    });
  }
  
  function autoTariffFromForm() {
    // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø¯ÙˆÙ† Ù…Ø²Ø§Ø­Ù…ØªÙ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ØŒ ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª Ú©Ø§Ù…Ù„ Ø¨ÙˆØ¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¯ÛŒÙØŒ Ù‚ÛŒÙ…Øª Ø±Ø§ Ø§Ø² ØªØ¹Ø±ÙÙ‡ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
    const type = serviceTypeInput.value;

    // Ø§Ú¯Ø± Ù†ÙˆØ¹ Ø®Ø¯Ù…Øª ÙÙ†Ø±ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ø±Ø§ Ø¨ÛŒâ€ŒØ³Ø±ÙˆØµØ¯Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒÙ…
    if (type === "ÙÙ†Ø±ÛŒ") {
      const paperSize = paperSizeSelect.value || "A4";
      const levelKey  = getCurrentPriceLevelKey();
      let spiralCode = bindingSpiralSize ? bindingSpiralSize.value : "";
      const coverVal   = bindingCover ? bindingCover.value : "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
      const jobType    = typeof getBindingJobType === "function" ? getBindingJobType() : "Ø¬Ø²ÙˆÙ‡";
      const approxPages = parseIntSafe(pagesPerSetInput ? pagesPerSetInput.value : "");
      const guideInfo = findBindingGuideSuggestion(approxPages);
      if (guideInfo && guideInfo.spiralCode && bindingSpiralSize) {
        bindingSpiralSize.value = guideInfo.spiralCode;
        spiralCode = guideInfo.spiralCode;
      }
      updateBindingSuggestion(spiralCode, { guideInfo });

      const calc = calculateBindingPriceFromSelections(paperSize, levelKey, spiralCode, coverVal, jobType);
      if (calc && calc.price > 0) {
        priceMainInput.value = formatMoney(calc.price);
        recalcDetail();
      }
      return;
    }

    // Ø§Ú¯Ø± Ù†ÙˆØ¹ Ø®Ø¯Ù…Øª Ù¾Ø±Ø³ (Ù„Ù…ÛŒÙ†ÛŒØª) Ø¨Ø§Ø´Ø¯ØŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³ Ø±Ø§ Ø¨ÛŒâ€ŒØ³Ø±ÙˆØµØ¯Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒÙ…
    if (type === "Ù¾Ø±Ø³") {
      const paperSize = paperSizeSelect.value || "A4";
      const levelKey  = getCurrentPriceLevelKey();
      const lamBase   = findLaminationPricePerUnit(paperSize, levelKey);
      if (lamBase != null && lamBase > 0) {
        priceMainInput.value = formatMoney(lamBase);
        recalcDetail();
      }
      return;
    }

    // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø­Ø§Ù„Ø§ØªØŒ ÙÙ‚Ø· Ú©Ù¾ÛŒ Ùˆ Ù¾Ø±ÛŒÙ†Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    if (type !== "Ú©Ù¾ÛŒ" && type !== "Ù¾Ø±ÛŒÙ†Øª") {
      return;
    }

    const paperSize = paperSizeSelect.value || "A4";
    const colorMode = colorModeSelect.value || "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯";
    const printType = printTypeSelect.value || "ÛŒÚ©â€ŒØ±Ùˆ";

    let pagesPerSet = parseIntSafe(pagesPerSetInput.value);
    let setCount    = parseIntSafe(setCountInput.value);
    if (!pagesPerSet || !setCount) {
      return;
    }

    let sheetsPerSet = 0;
    let totalSheets  = 0;

    if (type === "Ú©Ù¾ÛŒ") {
      sheetsPerSet = pagesPerSet;
      totalSheets  = sheetsPerSet * setCount;
    } else if (type === "Ù¾Ø±ÛŒÙ†Øª") {
      if (printType === "Ø¯ÙˆØ±Ùˆ") {
        sheetsPerSet = Math.ceil(pagesPerSet / 2);
      } else {
        sheetsPerSet = pagesPerSet;
      }
      totalSheets = sheetsPerSet * setCount;
    }

    if (!totalSheets) {
      return;
    }

    const levelKey = getCurrentPriceLevelKey();
    let pricePerSheet = null;

    if (colorMode === "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") {
      let basePrice = findBwPricePerSheet(paperSize, totalSheets, levelKey);
      if (basePrice == null) {
        return;
      }
      if (printType === "ÛŒÚ©â€ŒØ±Ùˆ") {
        const disc = getBwSingleDiscountPerSheet(levelKey);
        basePrice = Math.max(0, basePrice - disc);
      }
      pricePerSheet = basePrice;
    } 
    else if (colorMode === "Ø±Ù†Ú¯ÛŒ") {
      let basePrice = findColorBasePricePerSheet(paperSize, totalSheets, levelKey);
      if (basePrice == null) {
        return;
      }
      if (printType === "Ø¯ÙˆØ±Ùˆ") {
        const extra = getColorDuplexExtraPerSheet(levelKey);
        basePrice += extra;
      }
      if (typeof getColorCoverageAdjustPerSheet === "function" && colorCoverageSelect) {
        const coverageCode = colorCoverageSelect.value || "50-70";
        const covAdj = getColorCoverageAdjustPerSheet(levelKey, coverageCode);
        basePrice = Math.max(0, basePrice + covAdj);
      }
      if (typeof getColorWeightExtraPerSheet === "function" && paperTypeSelect && paperWeightSelect) {
        const pType   = paperTypeSelect.value || "";
        const pWeight = parseIntSafe(paperWeightSelect.value);
        if (pType && pWeight) {
          const wExtra = getColorWeightExtraPerSheet(levelKey, pType, pWeight);
          basePrice = Math.max(0, basePrice + wExtra);
        }
      }
      pricePerSheet = basePrice;
    }

    
    // Ø§Ú¯Ø± ÙÙ†Ø±ÛŒ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø®Ø¯Ù…Øª Ø§Ø¶Ø§ÙÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ø±Ø§ Ø§Ø² Ø¬Ø¯ÙˆÙ„ ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    // Ù…Ù†Ø·Ù‚: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ ÙˆØ§Ù‚Ø¹ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ â†’ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Â«Ø³Ø§ÛŒØ² ÙÙ†Ø±Â» â†’ Ù†Ú¯Ø§Ø´Øª Ø¨Ù‡ Ø¨Ø§Ø²Ù‡Ù” ÙÙ†Ø± Ø¯Ø± Ø¬Ø¯ÙˆÙ„ ØªØ¹Ø±ÙÙ‡ ÙÙ†Ø±ÛŒ Ù¾Ø§ÛŒÙ‡
    if (extraBindingChk && extraBindingChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª")) {
      const bindingSheets = sheetsPerSet || pagesPerSet;
      const bindInfo = resolveBindingInfo(paperSize, levelKey, bindingSheets);
      const guideInfo = (bindInfo && bindInfo.guideInfo) || findBindingGuideSuggestion(bindingSheets);
      if (bindInfo && bindInfo.price > 0) {
        if (bindInfo.spiralCode && bindingSpiralSize) {
          bindingSpiralSize.value = bindInfo.spiralCode;
        }
        const coverVal   = bindingCover ? bindingCover.value : "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
        const coverExtra = findBindingCoverExtra(paperSize, coverVal, levelKey) || 0;
        priceBindingInput.value = formatMoney(bindInfo.price + coverExtra);
      }
      updateBindingSuggestion(bindingSpiralSize ? bindingSpiralSize.value : "", { guideInfo });
    }

if (pricePerSheet == null || pricePerSheet <= 0) {
      return;
    }

    priceMainInput.value = formatMoney(pricePerSheet);
    recalcDetail();
  }

  // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ¹Ø±ÙÙ‡ Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¯ÛŒÙ
  if (serviceTypeInput) {
    serviceTypeInput.addEventListener("change", autoTariffFromForm);
  }
  if (paperSizeSelect) {
    paperSizeSelect.addEventListener("change", autoTariffFromForm);
  }
  if (colorModeSelect) {
    colorModeSelect.addEventListener("change", autoTariffFromForm);
  }
  if (colorCoverageSelect) {
    colorCoverageSelect.addEventListener("change", autoTariffFromForm);
  }
  if (printTypeSelect) {
    printTypeSelect.addEventListener("change", autoTariffFromForm);
  }
  if (pagesPerSetInput) {
    pagesPerSetInput.addEventListener("input", function () {
      updateBindingSuggestion();
      autoTariffFromForm();
    });
  }
  if (setCountInput) {
    setCountInput.addEventListener("input", autoTariffFromForm);
  }
  if (typeof orderPriceLevelSelect !== "undefined" && orderPriceLevelSelect) {
    orderPriceLevelSelect.addEventListener("change", autoTariffFromForm);
  }

  if (bindingSpiralSize) {
    bindingSpiralSize.addEventListener("change", function () {
      updateBindingSuggestion(bindingSpiralSize.value || "");
      autoTariffFromForm();
      recalcDetail();
    });
  }

  if (bindingCover) {
    bindingCover.addEventListener("change", function () {
      autoTariffFromForm();
      recalcDetail();
    });
  }

  refreshBindingCoverVisibility();
  updateBindingSuggestion(bindingSpiralSize ? bindingSpiralSize.value : "");

const rowPricePerSet     = document.getElementById("rowPricePerSet");

  const fileSection        = document.getElementById("fileSection");

  const orderTotalInput    = document.getElementById("orderTotal");
  const courierCustomerInfo = document.getElementById("courierCustomerInfo");
  const orderPaidInput     = document.getElementById("orderPaid");
  const orderBalanceInput  = document.getElementById("orderBalance");
  const orderDateTimeInput = document.getElementById("orderDateTime");
  const orderPaymentTypeSelect = document.getElementById("orderPaymentType");

  // ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´
  const orderStatusHidden   = document.getElementById("orderStatusHidden");
  const orderStatusText     = document.getElementById("orderStatusText");
  const inProgressNoteSection = document.getElementById("inProgressNoteSection");
  const inProgressNoteInput = document.getElementById("inProgressNote");
  const btnStatusDelivered  = document.getElementById("btnStatusDelivered");
  const btnStatusReady      = document.getElementById("btnStatusReady");
  const btnStatusInProgress = document.getElementById("btnStatusInProgress");
  const carryToTomorrowChk  = document.getElementById("carryToTomorrow");

  // Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² / ØµÙ†Ø¯ÙˆÙ‚
  const btnOpenOrders       = document.getElementById("btnOpenOrders");
  const openOrdersModal     = document.getElementById("openOrdersModal");
  const openOrdersBody      = document.getElementById("openOrdersBody");
  const btnOpenOrdersClose  = document.getElementById("btnOpenOrdersClose");
  const btnCashFromBox      = document.getElementById("btnCashFromBox");

  // Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚
  const cashFromBoxModal        = document.getElementById("cashFromBoxModal");
  const cashPayDateTimeInput    = document.getElementById("cashPayDateTime");
  const cashPayAmountInput      = document.getElementById("cashPayAmount");
  const cashPayMethodSelect     = document.getElementById("cashPayMethod");
  const cashPayTypeSelect       = document.getElementById("cashPayType");
  const cashPeykSectionDiv      = document.getElementById("cashPeykSection");
  const cashCustomerDebtSectionDiv = document.getElementById("cashCustomerDebtSection");
  const cashPayDebtCustomerInput = document.getElementById("cashPayDebtCustomer");
  const cashPayDebtBalanceInput = document.getElementById("cashPayDebtBalance");
  const btnSelectDebtCustomer   = document.getElementById("btnSelectDebtCustomer");
  const peykSectionSelect       = document.getElementById("peykSection");
  const peykDestinationSelect   = document.getElementById("peykDestination");
  const peykDestinationOtherRow = document.getElementById("peykDestinationOtherRow");
  const peykDestinationOtherInp = document.getElementById("peykDestinationOther");
  const peykOrderNoInput        = document.getElementById("peykOrderNo");
  const cashPayReasonInput      = document.getElementById("cashPayReason");
  const cashPayCustomerInput    = document.getElementById("cashPayCustomer");
  const btnCashSave             = document.getElementById("btnCashSave");
  const btnCashCancel           = document.getElementById("btnCashCancel");

  // Ø¨Ø³ØªÙ† Ø±ÙˆØ² / Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²
  const dailyCloseModal      = document.getElementById("dailyCloseModal");
  const dailyCashInEl        = document.getElementById("dailyCashIn");
  const dailyPosInEl         = document.getElementById("dailyPosIn");
  const dailyCardInEl        = document.getElementById("dailyCardIn");
  const dailyCustomerDebtEl  = document.getElementById("dailyCustomerDebt");
  const dailyNonCashOutEl    = document.getElementById("dailyNonCashOut");
  const dailyCashOutEl       = document.getElementById("dailyCashOut");
  const dailyExpectedCashEl  = document.getElementById("dailyExpectedCash");
  const dailyRealCashInput   = document.getElementById("dailyRealCash");
  const dailyNoteInput       = document.getElementById("dailyNote");
  const dailyDiffTextEl      = document.getElementById("dailyDiffText");
  const btnDailyCloseSave    = document.getElementById("btnDailyCloseSave");
  const btnDailyCloseCancel  = document.getElementById("btnDailyCloseCancel");
  const btnDailyClosePrint   = document.getElementById("btnDailyClosePrint");

  // Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ
  const dailyOpenOrdersBody   = document.getElementById("dailyOpenOrdersBody");
  const dailyNonCashPaymentsBody = document.getElementById("dailyNonCashPaymentsBody");
  const dailyPaperWasteInput  = document.getElementById("dailyPaperWaste");

  // Ø¹Ù†Ø§ØµØ± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®
  const reportDateSelector     = document.getElementById("reportDateSelector");
  const customDateField        = document.getElementById("customDateField");
  const customReportDate       = document.getElementById("customReportDate");


  // Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
  const cashPaymentsBody    = document.getElementById("cashPaymentsBody");

  // ØªØ§Ø±ÛŒØ® ÙØ¹Ù„ÛŒ
  if (orderDateTimeInput && !orderDateTimeInput.value) {
    const now = new Date();
    orderDateTimeInput.value = now.toLocaleString("fa-IR");
  }

  let selectedRow = null;

  function updatePaperFieldsByColor() {
    const type = serviceTypeInput.value;
    const isColor = (colorModeSelect.value === "Ø±Ù†Ú¯ÛŒ");
    if (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª") {
      fieldPaperType.style.display   = isColor ? "flex" : "none";
      paperWeightField.style.display = isColor ? "flex" : "none";
      if (fieldColorCoverage) {
        fieldColorCoverage.style.display = isColor ? "flex" : "none";
      }
    } else {
      fieldPaperType.style.display   = "none";
      paperWeightField.style.display = "none";
      if (fieldColorCoverage) {
        fieldColorCoverage.style.display = "none";
      }
    }
  }

  function updatePaperSizeOptionsForType() {
    const type = serviceTypeInput.value;
    const opts = Array.from(paperSizeSelect.options);
    opts.forEach(opt => {
      const t = opt.textContent.trim();
      if (t === "Ú©Ø§Ø±ØªÛŒ") {
        const allow = (type === "Ù¾Ø±Ø³");
        opt.disabled = !allow;
        opt.hidden   = !allow;
        if (!allow && paperSizeSelect.value === "Ú©Ø§Ø±ØªÛŒ") {
          paperSizeSelect.value = "A4";
        }
      }
    });
  }

  function moveBindingCoverRow(anchor) {
    if (!bindingCoverRow || !anchor) return;
    if (bindingCoverRow.parentElement !== anchor) {
      anchor.appendChild(bindingCoverRow);
    }
  }

  function refreshBindingCoverVisibility() {
    if (!bindingCoverRow) return;
    const type = serviceTypeInput.value;
    const isBindingService = (type === "ÙÙ†Ø±ÛŒ");
    const isCopyOrPrint = (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");
    const showForExtra = isCopyOrPrint && extraBindingChk.checked;

    if (isBindingService) {
      moveBindingCoverRow(bindingCoverAnchorMain);
      bindingCoverRow.classList.remove("hidden");
    } else if (showForExtra) {
      moveBindingCoverRow(bindingCoverAnchorExtra);
      bindingCoverRow.classList.remove("hidden");
    } else {
      bindingCoverRow.classList.add("hidden");
    }
  }

  function getBindingSpiralLabel(code) {
    if (!code || !bindingSpiralSize) return "";
    const opts = Array.from(bindingSpiralSize.options || []);
    const match = opts.find(opt => opt.value === code);
    return match ? match.textContent.trim() : code;
  }

  function formatBindingGuideText(guideInfo, fallbackLabel) {
    if (guideInfo) {
      const parts = [];
      if (guideInfo.sizeLabel) parts.push(guideInfo.sizeLabel);
      if (guideInfo.rangeText) parts.push(guideInfo.rangeText);
      return parts.join(" - ");
    }
    return fallbackLabel || "";
  }

  function updateBindingSuggestion(code, options = {}) {
    const selectedCode = code || (bindingSpiralSize ? bindingSpiralSize.value : "");
    let guideInfo = options.guideInfo || null;
    if (!guideInfo && pagesPerSetInput) {
      const approxPages = parseIntSafe(pagesPerSetInput.value);
      if (approxPages) {
        guideInfo = findBindingGuideSuggestion(approxPages);
      }
    }

    let autoCode = options.autoCode || (guideInfo ? guideInfo.spiralCode : null);
    if (!autoCode && !guideInfo && pagesPerSetInput) {
      const approxPages = parseIntSafe(pagesPerSetInput.value);
      if (approxPages) {
        autoCode = getBindingSpiralCodeFromPages(approxPages);
      }
    }

    const selectedLabel = getBindingSpiralLabel(selectedCode);
    const autoLabel = autoCode ? getBindingSpiralLabel(autoCode) : "";
    const suggestionText = formatBindingGuideText(guideInfo, autoLabel || selectedLabel);

    if (bindingSpiralHint) {
      bindingSpiralHint.textContent = suggestionText
        ? "Ø³Ø§ÛŒØ² ÙÙ†Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: " + suggestionText
        : "";
    }
    if (extraBindingSpiralHint) {
      extraBindingSpiralHint.textContent = suggestionText || "Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨";
    }
  }

  function getBindingJobType() {
    let v = "Ø¬Ø²ÙˆÙ‡";
    bindingJobTypeRadios.forEach(r => { if (r.checked) v = r.value; });
    return v;
  }

  function updateExtraControlsByServiceType() {
    const type = serviceTypeInput.value;
    const isCopyOrPrint = (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");

    extraSection.style.display = "block";

    if (isCopyOrPrint) {
      extraBindingChk.style.display = "inline-block";
      lblExtraBinding.style.display = "inline-block";
      extraStapleChk.style.display  = "inline-block";
      lblExtraStaple.style.display  = "inline-block";
    } else {
      extraBindingChk.checked = false;
      extraStapleChk.checked  = false;

      extraBindingChk.style.display = "none";
      lblExtraBinding.style.display = "none";
      extraStapleChk.style.display  = "none";
      lblExtraStaple.style.display  = "none";
    }

    updateExtraPriceVisibility();
  }

  function updateUIByServiceType() {
    const type = serviceTypeInput.value;

    fieldPaperSize.style.display   = "flex";
    fieldColor.style.display       = "flex";
    if (fieldColorCoverage) fieldColorCoverage.style.display = "flex";
    fieldPrintType.style.display   = "flex";
    fieldPagesPerSet.style.display = "flex";
    fieldSetCount.style.display    = "flex";
    fieldTotalPages.style.display  = "flex";
    fieldPaperType.style.display   = "flex";
    paperWeightField.style.display = "flex";
    bindingSpiralRow.classList.add("hidden");
    bindingCoverRow.classList.add("hidden");
    bindingJobTypeRow.classList.add("hidden");
    fileSection.style.display      = "block";
    priceBindingField.classList.add("hidden");
    priceStapleField.classList.add("hidden");
    rowPricePerSet.style.display   = "flex";

    labelPagesPerSet.textContent = "ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:";
    labelSetCount.textContent    = "ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ / Ø¬Ø²ÙˆÙ‡:";
    labelTotalPages.textContent  = "Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯:";
    pagesHint.textContent        = "ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ã— ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ = Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯.";
    priceMainLabel.textContent   = "Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯:";

    updatePaperSizeOptionsForType();

    if (type === "Ú©Ù¾ÛŒ") {
      fileSection.style.display = "none";
      pagesHint.textContent = "Ø¯Ø± Ú©Ù¾ÛŒ: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ã— ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÛŒ = Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯.";
      priceMainLabel.textContent = "Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯:";
      updatePaperFieldsByColor();
    } else if (type === "Ù¾Ø±ÛŒÙ†Øª") {
      fileSection.style.display = "block";
      labelPagesPerSet.textContent = "ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡:";
      labelTotalPages.textContent  = "Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯ (Ú†Ø§Ù¾):";
      pagesHint.textContent = "Ø§Ú¯Ø± Ø¯ÙˆØ±Ùˆ Ø¨Ø§Ø´Ø¯ØŒ ØµÙØ­Ø§Øª Ø¨Ù‡ Ø¨Ø±Ú¯ ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ú¯ Ã— ØªØ¹Ø¯Ø§Ø¯ = Ø¨Ø±Ú¯ Ú©Ù„.";
      priceMainLabel.textContent = "Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯:";
      updatePaperFieldsByColor();
    } else if (type === "ÙÙ†Ø±ÛŒ") {
      fileSection.style.display      = "none";
      fieldColor.style.display       = "none";
      if (fieldColorCoverage) fieldColorCoverage.style.display = "none";
      fieldPrintType.style.display   = "none";
      fieldPagesPerSet.style.display = "block";
      fieldTotalPages.style.display  = "none";
      fieldPaperType.style.display   = "none";
      paperWeightField.style.display = "none";
      bindingSpiralRow.classList.remove("hidden");
      bindingCoverRow.classList.remove("hidden");
      bindingJobTypeRow.classList.remove("hidden");
      labelPagesPerSet.textContent   = "ØªÙ‚Ø±ÛŒØ¨ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:";
      labelSetCount.textContent      = "ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡:";
      pagesHint.textContent          = "ÙÙ†Ø±ÛŒ Ù…Ø³ØªÙ‚Ù„: Ø³Ø§ÛŒØ² ÙÙ†Ø± Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡ Ø¯Ø± Ù‚ÛŒÙ…Øª Ù…Ø¤Ø«Ø± Ø§Ø³Øª. (ØªÙ‚Ø±ÛŒØ¨ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§ÛŒØ² Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª.)";
      priceMainLabel.textContent     = "Ù‚ÛŒÙ…Øª ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡:";
      rowPricePerSet.style.display   = "none";
    }
    // Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ù†ÙˆØ¹ Ø®Ø¯Ù…ØªØŒ ÙˆØ¶Ø¹ÛŒØª Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡ (ÙÙ†Ø±ÛŒ/Ù…Ù†Ú¯Ù†Ù‡/Ù¾ÛŒÚ©) Ùˆ Ù†ÙˆØ¹ Ø·Ù„Ù‚ Ø±Ø§ Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    updateExtraPriceVisibility();
    if (type === "Ù¾Ø±Ø³") {
      fileSection.style.display      = "none";
      fieldColor.style.display       = "none";
      if (fieldColorCoverage) fieldColorCoverage.style.display = "none";
      fieldPrintType.style.display   = "none";
      fieldPagesPerSet.style.display = "none";
      fieldTotalPages.style.display  = "none";
      fieldPaperType.style.display   = "none";
      paperWeightField.style.display = "none";
      labelSetCount.textContent      = "ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±Ø³:";
      pagesHint.textContent          = "Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø³ ÙÙ‚Ø· Ø³Ø§ÛŒØ² Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³ Ù…Ù‡Ù… Ø§Ø³Øª.";
      priceMainLabel.textContent     = "Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³:";
      rowPricePerSet.style.display   = "none";
    } else if (type === "Ù…Ù†Ú¯Ù†Ù‡") {
      fileSection.style.display      = "none";
      fieldPaperSize.style.display   = "none";
      fieldColor.style.display       = "none";
      if (fieldColorCoverage) fieldColorCoverage.style.display = "none";
      fieldPrintType.style.display   = "none";
      fieldPagesPerSet.style.display = "none";
      fieldTotalPages.style.display  = "none";
      fieldPaperType.style.display   = "none";
      paperWeightField.style.display = "none";
      labelSetCount.textContent      = "ØªØ¹Ø¯Ø§Ø¯ Ù…Ù†Ú¯Ù†Ù‡:";
      pagesHint.textContent          = "Ø¨Ø±Ø§ÛŒ Ù…Ù†Ú¯Ù†Ù‡ ÙÙ‚Ø· ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡ Ù…Ù‡Ù… Ø§Ø³Øª.";
      priceMainLabel.textContent     = "Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡:";
      rowPricePerSet.style.display   = "none";
    }

    updateExtraControlsByServiceType();
    updateBindingSuggestion(bindingSpiralSize ? bindingSpiralSize.value : "");
  }

  serviceTypeInput.addEventListener("change", function () {
    updateUIByServiceType();
    recalcDetail();
  });
  colorModeSelect.addEventListener("change", function () {
    updatePaperFieldsByColor();
  });
  if (colorCoverageSelect) {
    colorCoverageSelect.addEventListener("change", function () {
      recalcDetail();
    });
  }
  printTypeSelect.addEventListener("change", function () {
    recalcDetail();
  });

  bindingJobTypeRadios.forEach(r => {
    r.addEventListener("change", function () {
      autoTariffFromForm();
      recalcDetail();
    });
  });

  function updateExtraPriceVisibility() {
    const type = serviceTypeInput.value;
    const isCopyOrPrint = (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");

    // Ù†Ù…Ø§ÛŒØ´ / Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡
    priceBindingField.classList.toggle("hidden", !(extraBindingChk.checked && isCopyOrPrint));
    priceStapleField.classList.toggle("hidden", !(extraStapleChk.checked && isCopyOrPrint));
    courierRow.classList.toggle("hidden", !extraCourierChk.checked);
    if (extraBindingHintRow) {
      const showHint = extraBindingChk.checked && isCopyOrPrint;
      extraBindingHintRow.classList.toggle("hidden", !showHint);
    }
    refreshBindingCoverVisibility();
  }
  [extraBindingChk, extraStapleChk, extraCourierChk].forEach(ch => {
    ch.addEventListener("change", function () {
      updateExtraPriceVisibility();
      autoTariffFromForm();
      recalcDetail();
      updateOrderTotal();
    });
  });

  courierAmountInput.addEventListener("input", function () {
    updateOrderTotal();
  });
  courierWhoRadios.forEach(r => {
    r.addEventListener("change", function () {
      updateOrderTotal();
    });
  });

  function getCourierInfo() {
    if (!extraCourierChk.checked) {
      return { enabled: false, who: "", amount: 0 };
    }
    let who = "customer";
    courierWhoRadios.forEach(r => { if (r.checked) who = r.value; });
    const amount = parseMoney(courierAmountInput.value);
    return {
      enabled: amount > 0,
      who,
      amount
    };
  }

  function recalcDetail() {
    const type = serviceTypeInput.value;
    let pagesPerSet = parseIntSafe(pagesPerSetInput.value);
    let setCount    = parseIntSafe(setCountInput.value);
    if (!setCount) setCount = 0;

    let sheetsPerSet = 0;
    let totalSheets  = 0;

    if (type === "Ú©Ù¾ÛŒ") {
      sheetsPerSet = pagesPerSet;
      totalSheets  = sheetsPerSet * setCount;
      totalPagesInput.value = totalSheets ? formatMoney(totalSheets) : "";
    } else if (type === "Ù¾Ø±ÛŒÙ†Øª") {
      if (!pagesPerSet) pagesPerSet = 0;
      if (printTypeSelect.value === "Ø¯ÙˆØ±Ùˆ") {
        sheetsPerSet = Math.ceil(pagesPerSet / 2);
      } else {
        sheetsPerSet = pagesPerSet;
      }
      totalSheets = sheetsPerSet * setCount;
      totalPagesInput.value = totalSheets ? formatMoney(totalSheets) : "";
    } else if (type === "ÙÙ†Ø±ÛŒ") {
      totalSheets = 0;
      totalPagesInput.value = "";
    } else if (type === "Ù¾Ø±Ø³") {
      totalSheets = setCount;
      totalPagesInput.value = "";
    } else if (type === "Ù…Ù†Ú¯Ù†Ù‡") {
      totalSheets = setCount;
      totalPagesInput.value = "";
    }

    const priceMain    = parseMoney(priceMainInput.value);
    const hasBinding   = extraBindingChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");
    const hasStaple    = extraStapleChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");
    const priceBinding = parseMoney(priceBindingInput.value);
    const priceStaple  = parseMoney(priceStapleInput.value);

    let printTotal   = 0;
    let bindingTotal = 0;
    let stapleTotal  = 0;
    let rowTotal     = 0;
    let perSetPrice  = 0;

    if (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª") {
      printTotal = totalSheets * priceMain;
      if (hasBinding) bindingTotal = setCount * priceBinding;
      if (hasStaple)  stapleTotal  = setCount * priceStaple;
      rowTotal = printTotal + bindingTotal + stapleTotal;
      if (setCount > 0) perSetPrice = Math.round(rowTotal / setCount);
    } else {
      rowTotal = setCount * priceMain;
      perSetPrice = 0;
    }

    rowTotalInput.value    = rowTotal ? formatMoney(rowTotal) : "";
    pricePerSetInput.value = perSetPrice ? formatMoney(perSetPrice) : "";

    recalcDetail._cache = {
      sheetsPerSet,
      totalSheets,
      printTotal,
      bindingTotal,
      stapleTotal,
      rowTotal,
      perSetPrice
    };
  }

  [pagesPerSetInput, setCountInput, priceMainInput, priceBindingInput, priceStapleInput].forEach(inp => {
    inp.addEventListener("input", recalcDetail);
  });

  function createNewRow() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="radio" name="rowSelect"></td>
      <td class="td-type"></td>
      <td class="td-short"></td>
      <td class="td-detail"></td>
      <td class="td-count"></td>
      <td class="td-price"></td>
      <td class="td-total"></td>
      <td><button type="button" class="btn-remove-row">âœ–</button></td>
    `;
    itemsBody.appendChild(tr);

    const radio = tr.querySelector('input[type="radio"]');
    radio.addEventListener("change", function () {
      selectedRow = tr;
      loadRowToForm(tr);
    });
    const btnRemove = tr.querySelector(".btn-remove-row");
    btnRemove.addEventListener("click", function () {
      if (selectedRow === tr) {
        selectedRow = null;
        clearDetailForm();
      }
      tr.remove();
      updateOrderTotal();
    });

    return tr;
  }
  btnAddItem.addEventListener("click", function () {
    const tr = createNewRow();
    const radio = tr.querySelector('input[type="radio"]');
    radio.checked = true;
    selectedRow = tr;
  });

  function loadRowToForm(tr) {
    const type      = tr.dataset.serviceType || "Ú©Ù¾ÛŒ";
    const shortDesc = tr.dataset.shortDesc   || "";
    const pagesPerSet = parseIntSafe(tr.dataset.pagesPerSet || "0");
    const setCount    = parseIntSafe(tr.dataset.setCount    || "0");
    const totalSheets = parseIntSafe(tr.dataset.totalSheets || "0");
    const priceMain   = parseIntSafe(tr.dataset.priceMain   || "0");
    const extraBinding= tr.dataset.extraBinding === "1";
    const extraStaple = tr.dataset.extraStaple === "1";
    const spiralSize  = tr.dataset.bindingSpiralSize || bindingSpiralSize.value;
    const coverVal    = tr.dataset.bindingCover      || "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
    const jobType     = tr.dataset.bindingJobType    || "Ø¬Ø²ÙˆÙ‡";
    const paperSize   = tr.dataset.paperSize || paperSizeSelect.value;
    const colorMode   = tr.dataset.colorMode || colorModeSelect.value;
    const printType   = tr.dataset.printType || printTypeSelect.value;
    const paperType   = tr.dataset.paperType || paperTypeSelect.value;
    const paperWeight = tr.dataset.paperWeight || paperWeightSelect.value;
    const colorCoverage = tr.dataset.colorCoverage || "50-70";

    serviceTypeInput.value = type;
    shortDescInput.value   = shortDesc;
    paperSizeSelect.value  = paperSize;
    colorModeSelect.value  = colorMode;
    printTypeSelect.value  = printType;
    paperTypeSelect.value  = paperType;
    paperWeightSelect.value= paperWeight;
    if (colorCoverageSelect) {
      colorCoverageSelect.value = colorCoverage;
    }
    pagesPerSetInput.value = pagesPerSet ? formatMoney(pagesPerSet) : "";
    setCountInput.value    = setCount ? formatMoney(setCount) : "";
    totalPagesInput.value  = totalSheets ? formatMoney(totalSheets) : "";
    priceMainInput.value   = priceMain ? formatMoney(priceMain) : "";
    priceBindingInput.value= parseIntSafe(tr.dataset.priceBinding || "0") ? formatMoney(parseIntSafe(tr.dataset.priceBinding || "0")) : "";
    priceStapleInput.value = parseIntSafe(tr.dataset.priceStaple  || "0") ? formatMoney(parseIntSafe(tr.dataset.priceStaple || "0")) : "";

    bindingSpiralSize.value = spiralSize;
    bindingCover.value      = coverVal;
    updateBindingSuggestion(bindingSpiralSize.value || "");
    bindingJobTypeRadios.forEach(r => { r.checked = (r.value === jobType); });

    extraBindingChk.checked = extraBinding;
    extraStapleChk.checked  = extraStaple;

    updateUIByServiceType();
    updateExtraPriceVisibility();
    recalcDetail();
  }

  function clearDetailForm() {
    shortDescInput.value   = "";
    pagesPerSetInput.value = "";
    setCountInput.value    = "";
    totalPagesInput.value  = "";
    priceMainInput.value   = "";
    priceBindingInput.value= "";
    priceStapleInput.value = "";
    pricePerSetInput.value = "";
    rowTotalInput.value    = "";
    extraBindingChk.checked = false;
    extraStapleChk.checked  = false;
    if (colorCoverageSelect) {
      colorCoverageSelect.value = "50-70";
    }
    updateExtraPriceVisibility();
    bindingJobTypeRadios.forEach(r => { r.checked = (r.value === "Ø¬Ø²ÙˆÙ‡"); });
    updateBindingSuggestion(bindingSpiralSize ? bindingSpiralSize.value : "");
  }

  btnApplyToRow.addEventListener("click", function () {
    if (!selectedRow) {
      const existingRows = itemsBody.querySelectorAll("tr");
      if (existingRows.length === 0) {
        const tr = createNewRow();
        const radio = tr.querySelector('input[type="radio"]');
        radio.checked = true;
        selectedRow = tr;
      } else {
        alert("Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø±Ø¯ÛŒÙ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.");
        return;
      }
    }

    const type      = serviceTypeInput.value;
    const shortDesc = shortDescInput.value.trim();
    const pagesPerSet = parseIntSafe(pagesPerSetInput.value);
    const setCount    = parseIntSafe(setCountInput.value);

    const cache = recalcDetail._cache || {};
    const sheetsPerSet = cache.sheetsPerSet || 0;
    const totalSheets  = cache.totalSheets  || 0;
    const rowTotal     = cache.rowTotal     || 0;
    const perSetPrice  = cache.perSetPrice  || 0;
    const priceMain    = parseMoney(priceMainInput.value);
    const hasBinding   = extraBindingChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");
    const hasStaple    = extraStapleChk.checked && (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª");
    const priceBinding = parseMoney(priceBindingInput.value);
    const priceStaple  = parseMoney(priceStapleInput.value);

    const spiralSize = bindingSpiralSize.value;
    const coverVal   = bindingCover.value || "Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚";
    const jobType    = getBindingJobType();
    const colorMode  = colorModeSelect.value;
    const coverageCode = colorCoverageSelect ? colorCoverageSelect.value : "50-70";
    let coverageLabel = "";
    if (colorMode === "Ø±Ù†Ú¯ÛŒ") {
      if (coverageCode === "0-50") {
        coverageLabel = " | Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯: Ú©Ù… (Û°â€“ÛµÛ°Ùª)";
      } else if (coverageCode === "70-100") {
        coverageLabel = " | Ù¾ÙˆØ´Ø´ Ø±Ù†Ú¯: Ø²ÛŒØ§Ø¯ (Û·Û°â€“Û±Û°Û°Ùª)";
      }
    }

    let detailText = "";
    if (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª") {
      const extraParts = [];
      if (hasBinding && priceBinding) extraParts.push("ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡: " + formatMoney(priceBinding));
      if (hasStaple && priceStaple)   extraParts.push("Ù…Ù†Ú¯Ù†Ù‡ Ù‡Ø± Ø¬Ø²ÙˆÙ‡: " + formatMoney(priceStaple));
      if (extraCourierChk.checked) {
        const cInfo = getCourierInfo();
        if (cInfo.enabled) {
          extraParts.push("Ù¾ÛŒÚ© (" + (cInfo.who === "shop" ? "Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ø§" : "Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ") +
                          " - " + formatMoney(cInfo.amount) + ")");
        } else extraParts.push("Ù¾ÛŒÚ©");
      }
      const extraStr = extraParts.length ? extraParts.join(" ØŒ ") : "Ø¨Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡";

      detailText =
        "ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡: " + formatMoney(setCount) +
        " | Ø¨Ø±Ú¯ Ù‡Ø± Ø¬Ø²ÙˆÙ‡: " + formatMoney(sheetsPerSet) +
        " | Ø¬Ù…Ø¹ Ø¨Ø±Ú¯: " + formatMoney(totalSheets) +
        " | Ù†ÙˆØ¹ Ú†Ø§Ù¾: " + colorModeSelect.value + coverageLabel +
        " | Ø³Ø§ÛŒØ²: " + paperSizeSelect.value +
        " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯: " + formatMoney(priceMain) +
        " | " + extraStr;

    } else if (type === "ÙÙ†Ø±ÛŒ") {
      detailText =
        "Ù†ÙˆØ¹ Ú©Ø§Ø±: " + jobType +
        " | ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡: " + formatMoney(setCount) +
        " | Ø³Ø§ÛŒØ²: " + paperSizeSelect.value +
        " | Ø·Ù„Ù‚: " + coverVal;
    } else if (type === "Ù¾Ø±Ø³") {
      detailText =
        "ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±Ø³: " + formatMoney(setCount) +
        " | Ø³Ø§ÛŒØ²: " + paperSizeSelect.value +
        " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³: " + formatMoney(priceMain);
    } else if (type === "Ù…Ù†Ú¯Ù†Ù‡") {
      detailText =
        "ØªØ¹Ø¯Ø§Ø¯ Ù…Ù†Ú¯Ù†Ù‡: " + formatMoney(setCount) +
        " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡: " + formatMoney(priceMain);
    }

    selectedRow.querySelector(".td-type").textContent   = type;
    selectedRow.querySelector(".td-short").textContent  = shortDesc;
    selectedRow.querySelector(".td-detail").textContent = detailText;
    selectedRow.querySelector(".td-count").textContent  = formatMoney(setCount);

    let priceCellValue = "";
    if (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª") {
      priceCellValue = perSetPrice ? formatMoney(perSetPrice) : formatMoney(priceMain);
    } else {
      priceCellValue = formatMoney(priceMain);
    }

    selectedRow.querySelector(".td-price").textContent = priceCellValue;
    selectedRow.querySelector(".td-total").textContent = rowTotal ? formatMoney(rowTotal) : "0";

    selectedRow.dataset.serviceType       = type;
    selectedRow.dataset.shortDesc         = shortDesc;
    selectedRow.dataset.pagesPerSet       = pagesPerSet;
    selectedRow.dataset.setCount          = setCount;
    selectedRow.dataset.totalSheets       = totalSheets;
    selectedRow.dataset.priceMain         = priceMain;
    selectedRow.dataset.extraBinding      = hasBinding ? "1" : "0";
    selectedRow.dataset.extraStaple       = hasStaple ? "1" : "0";
    selectedRow.dataset.priceBinding      = priceBinding;
    selectedRow.dataset.priceStaple       = priceStaple;
    selectedRow.dataset.rowTotal          = rowTotal;
    selectedRow.dataset.bindingSpiralSize = spiralSize;
    selectedRow.dataset.bindingCover      = coverVal;
    selectedRow.dataset.bindingJobType    = jobType;

    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø²ÛŒØ±Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
    selectedRow.dataset.paperSize     = paperSizeSelect.value;
    selectedRow.dataset.colorMode     = colorModeSelect.value;
    selectedRow.dataset.printType     = printTypeSelect.value;
    selectedRow.dataset.paperType     = paperTypeSelect.value;
    selectedRow.dataset.paperWeight   = paperWeightSelect.value;
    selectedRow.dataset.colorCoverage = coverageCode;

    updateOrderTotal();
  });

  function updateOrderTotal() {
    let sum = 0;
    itemsBody.querySelectorAll("tr").forEach(tr => {
      const v = parseIntSafe(tr.dataset.rowTotal || "0");
      if (!isNaN(v)) sum += v;
    });

    const courier = getCourierInfo();
    let courierNote = "";
    let showCourierNote = false;
    if (courier.enabled && courier.who === "customer") {
      sum += courier.amount;
      courierNote = "Ø´Ø§Ù…Ù„ Ù‡Ø²ÛŒÙ†Ù‡ Ù¾ÛŒÚ© (Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ): " + formatMoney(courier.amount) + " Ø±ÛŒØ§Ù„";
      showCourierNote = true;
    }
    if (courierCustomerInfo) {
      if (showCourierNote) {
        courierCustomerInfo.textContent = courierNote;
        courierCustomerInfo.style.display = "block";
      } else {
        courierCustomerInfo.textContent = "";
        courierCustomerInfo.style.display = "none";
      }
    }

    orderTotalInput.value = formatMoney(sum);
    updateBalance();
  }

  function updateBalance() {
    const total = parseMoney(orderTotalInput.value);
    const paid  = parseMoney(orderPaidInput.value);
    const bal   = total - paid;
    orderBalanceInput.value = formatMoney(bal);
  }
  orderPaidInput.addEventListener("input", updateBalance);

  const COPY_STORAGE_KEY = "copyOrders_v1";
  const COPY_CASH_STORAGE_KEY = "cashBoxPayments_v1";
  const btnSaveOrder = document.getElementById("btnSaveOrder");
  const savedOrdersBody = document.getElementById("savedOrdersBody");

  function loadSavedOrdersToReport() {
    savedOrdersBody.innerHTML = "";
    
    const statusNow = orderStatusHidden.value || "registered";
    if (statusNow === "in_progress") {
      const note = (inProgressNoteInput ? inProgressNoteInput.value.trim() : "");
      if (!note) {
        alert("Ø¨Ø±Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Â«Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…Â» Ø«Ø¨Øª ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.");
        inProgressNoteSection && inProgressNoteSection.classList.remove("hidden");
        try { inProgressNoteInput && inProgressNoteInput.focus(); } catch(e){}
        return;
      }
    }

const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    orders.forEach((o, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${o.dateTime || ""}</td>
        <td>${o.orderNo || ""}</td>
        <td>${o.customerName || ""}</td>
        <td>${o.user || ""}</td>
        <td>${(o.items || []).length}</td>
        <td>${formatMoney(o.total || 0)}</td>
        <td>${formatMoney(o.paid || 0)}</td>
        <td>${formatMoney(o.balance || 0)}</td>
      `;
      savedOrdersBody.appendChild(tr);
    });
  }

  function makePeykDetailText(p) {
    if (!p || p.payType !== "peyk") return "";
    const sectionMap = {
      copy_print: "Ú†Ø§Ù¾/Ú©Ù¾ÛŒ",
      design: "Ø·Ø±Ø§Ø­ÛŒ",
      wholesale: "ÙØ±ÙˆØ´ Ø¹Ù…Ø¯Ù‡",
      material: "Ø®Ø±ÛŒØ¯ Ù…ÙˆØ§Ø¯",
      personal: "Ø´Ø®ØµÛŒ / ØºÛŒØ±Ú©Ø§Ø±ÛŒ"
    };
    const destMap = {
      andisheh: "Ø§Ù†Ø¯ÛŒØ´Ù‡",
      karaj: "Ú©Ø±Ø¬",
      fardis: "ÙØ±Ø¯ÛŒØ³",
      shahriyar: "Ø´Ù‡Ø±ÛŒØ§Ø±",
      baghestan: "Ø¨Ø§ØºØ³ØªØ§Ù†",
      malard: "Ù…Ù„Ø§Ø±Ø¯",
      tehran: "ØªÙ‡Ø±Ø§Ù†",
      other: "Ø³Ø§ÛŒØ±"
    };

    const sec = sectionMap[p.peykSection] || "";
    let dest = destMap[p.peykDestination] || "";
    if (p.peykDestination === "other" && p.peykDestinationText) {
      dest = "Ø³Ø§ÛŒØ±: " + p.peykDestinationText;
    }
    let txt = "";
    if (sec) txt += "Ø¨Ø®Ø´: " + sec;
    if (dest) {
      if (txt) txt += " | ";
      txt += "Ù…Ù‚ØµØ¯: " + dest;
    }
    if (p.peykOrderNo) {
      if (txt) txt += " | ";
      txt += "Ø³ÙØ§Ø±Ø´: " + p.peykOrderNo;
    }
    return txt;
  }

  function loadCashPaymentsToReport() {
    if (!cashPaymentsBody) return;
    cashPaymentsBody.innerHTML = "";
    const pays = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");
    pays.forEach((p, idx) => {
      const peykDetail = makePeykDetailText(p);
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${p.dateTime || ""}</td>
        <td>${formatMoney(p.amount || 0)}</td>
        <td>${p.payMethodLabel || ""}</td>
        <td>${p.payTypeLabel || ""}</td>
        <td>${peykDetail || ""}</td>
        <td>${p.reason || ""}</td>
        <td>${p.customerName || ""}</td>
        <td>${p.user || ""}</td>
      `;
      cashPaymentsBody.appendChild(tr);
    });
  }

  // ===== Ø¨Ø³ØªÙ† Ø±ÙˆØ² / Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ² =====
  function openDailyCloseModal() {
    const allOrders = loadAllOrders();
    const todayNum  = todayNumber();

    // Ú¯Ø±ÙØªÙ† Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù¾Ø§ÛŒÙ‡ Ø§Ø² Ø±ÙˆØ² Ù‚Ø¨Ù„ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)
    const yesterdayNum = todayNum - 1;
    const realCashBaseMap = JSON.parse(localStorage.getItem(REAL_CASH_BASE_KEY) || "{}");
    const baseCash = realCashBaseMap[yesterdayNum] || 0;

    // Ø¬Ù…Ø¹ Ø¯Ø±ÛŒØ§ÙØªâ€ŒÙ‡Ø§ Ùˆ Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† (ØªÙ…Ø§Ù… Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§)
    let todayCashIn = 0;
    let todayPosIn = 0;
    let todayCardIn = 0;
    let totalCustomerDebt = 0;

    allOrders.forEach(o => {
      const balance = o.total - o.paid;
      totalCustomerDebt += balance;

      const dNum = orderDateToNumber(o);
      if (dNum !== todayNum) return;

      if (o.paymentType === "Ù†Ù‚Ø¯ÛŒ") {
        todayCashIn += (o.paid || 0);
      } else if (o.paymentType === "Ù¾ÙˆØ²") {
        todayPosIn += (o.paid || 0);
      } else if (o.paymentType === "Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª") {
        todayCardIn += (o.paid || 0);
      }
    });

    // Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù…Ø±ÙˆØ²
    const pays = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");
    let todayCashOut = 0;
    let todayNonCashOut = 0;
    pays.forEach(p => {
      const dt = (p.dateTime || "").split(/[,\s]/)[0]; // Ø¨Ø®Ø´ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
      const dNum = jalaliStringToNumber(dt);
      if (!dNum || dNum !== todayNum) return;
      if (p.payMethod === "cash") {
        todayCashOut += (p.amount || 0);
      } else {
        // Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ: Ú©Ø§Ø±Øª Ø¯ÙØªØ±ØŒ Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒØŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒØŒ Ø³Ø§ÛŒØ±
        todayNonCashOut += (p.amount || 0);
      }
    });

    // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø± = Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù¾Ø§ÛŒÙ‡ Ø±ÙˆØ² Ù‚Ø¨Ù„ + Ø¯Ø±ÛŒØ§ÙØª Ù†Ù‚Ø¯ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† - Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚
    const expectedCash = baseCash + todayCashIn - todayCashOut;

    dailyCashInEl.textContent        = formatMoney(todayCashIn);
    dailyPosInEl.textContent         = formatMoney(todayPosIn);
    dailyCardInEl.textContent        = formatMoney(todayCardIn);
    dailyCustomerDebtEl.textContent  = formatMoney(totalCustomerDebt);
    dailyNonCashOutEl.textContent    = formatMoney(todayNonCashOut);
    dailyCashOutEl.textContent       = formatMoney(todayCashOut);
    dailyExpectedCashEl.textContent  = formatMoney(expectedCash);
    dailyExpectedCashEl.dataset.value = String(expectedCash);

    dailyRealCashInput.value = expectedCash ? formatMoney(expectedCash) : "";
    dailyPaperWasteInput.value = "";
    dailyNoteInput.value     = "";
    dailyDiffTextEl.textContent   = "";
    dailyDiffTextEl.dataset.value = "0";

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ
    loadDailyOpenOrders();
    loadDailyNonCashPayments();

    dailyCloseModal.classList.add("show");
    recalcDailyDiff();
  }

  function recalcDailyDiff() {
    const expected = parseMoney(dailyExpectedCashEl.dataset.value || "0");
    const real     = parseMoney(dailyRealCashInput.value);
    const diff     = real - expected;

    let txt = "";
    if (!real && !expected) {
      txt = "";
    } else if (diff === 0) {
      txt = "Ø¨Ø¯ÙˆÙ† Ù…ØºØ§ÛŒØ±Øª";
    } else if (diff > 0) {
      txt = "Ø§Ø¶Ø§ÙÙ‡ ØµÙ†Ø¯ÙˆÙ‚: " + formatMoney(diff);
    } else {
      txt = "Ú©Ø³Ø±ÛŒ ØµÙ†Ø¯ÙˆÙ‚: " + formatMoney(-diff);
    }
    dailyDiffTextEl.textContent   = txt;
    dailyDiffTextEl.dataset.value = String(diff);
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ Ø§Ù…Ø±ÙˆØ²
  function loadDailyNonCashPayments() {
    const pays = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");
    const todayNum = todayNumber();

    dailyNonCashPaymentsBody.innerHTML = "";

    let hasPayments = false;
    pays.forEach(p => {
      const dt = (p.dateTime || "").split(/[,\s]/)[0]; // Ø¨Ø®Ø´ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
      const dNum = jalaliStringToNumber(dt);
      if (!dNum || dNum !== todayNum) return;

      if (p.payMethod !== "cash") {
        hasPayments = true;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formatMoney(p.amount || 0)}</td>
          <td>${getPaymentMethodLabel(p.payMethod || "")}</td>
          <td>${getPaymentTypeLabel(p.payType || "")}</td>
          <td>${p.reason || ""}</td>
        `;
        dailyNonCashPaymentsBody.appendChild(tr);
      }
    });

    if (!hasPayments) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="4" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®Øª ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td>';
      dailyNonCashPaymentsBody.appendChild(tr);
    }
  }

  // ØªØ¨Ø¯ÛŒÙ„ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ
  function getPaymentMethodLabel(method) {
    switch(method) {
      case "office_card": return "Ú©Ø§Ø±Øª Ø¯ÙØªØ±";
      case "personal_card": return "Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒ";
      case "bank_transfer": return "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ";
      case "other": return "Ø³Ø§ÛŒØ±";
      default: return method;
    }
  }

  // ØªØ¨Ø¯ÛŒÙ„ Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ
  function getPaymentTypeLabel(type) {
    switch(type) {
      case "cost": return "Ù‡Ø²ÛŒÙ†Ù‡";
      case "peyk": return "Ù¾ÛŒÚ©";
      case "refund": return "Ø¨Ø±Ú¯Ø´Øª ÙˆØ¬Ù‡";
      case "customer_debt": return "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ";
      case "supplier": return "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡";
      case "manager_payment": return "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø¯ÛŒØ±";
      case "owner_draw": return "Ø¨Ø±Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ";
      case "other": return "Ø³Ø§ÛŒØ±";
      default: return type;
    }
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ø§Ù…Ø±ÙˆØ²
  function loadDailyOpenOrders() {
    const allOrders = loadAllOrders();
    const todayNum = todayNumber();

    dailyOpenOrdersBody.innerHTML = "";

    let hasOrders = false;
    allOrders.forEach(o => {
      const dNum = orderDateToNumber(o);
      if (dNum !== todayNum) return;

      // Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²: ÙˆØ¶Ø¹ÛŒØª Ø«Ø¨Øª Ø´Ø¯Ù‡ØŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… ÛŒØ§ Ø¢Ù…Ø§Ø¯Ù‡ (Ø§Ù…Ø§ ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡)
      if (o.status === "registered" || o.status === "in_progress" || o.status === "ready") {
        const balance = o.total - o.paid;
        hasOrders = true;
        const tr = document.createElement("tr");
        const shortDesc = o.items && o.items.length > 0 ? o.items[0].short : "Ø¨Ø¯ÙˆÙ† Ø¬Ø²Ø¦ÛŒØ§Øª";
        tr.innerHTML = `
          <td>${o.orderNo || "Ø¨Ø¯ÙˆÙ† Ø´Ù…Ø§Ø±Ù‡"}</td>
          <td>${o.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡"}</td>
          <td>${shortDesc}</td>
          <td>${getDetailedStatusText(o)}</td>
          <td>${formatMoney(balance)}</td>
          <td>
            <button class="btn-small btn-status" data-order-id="${o.id}" data-action="ready">Ø¢Ù…Ø§Ø¯Ù‡</button>
            <button class="btn-small btn-status" data-order-id="${o.id}" data-action="delivered">ØªØ­ÙˆÛŒÙ„</button>
            <button class="btn-small" data-order-id="${o.id}" data-action="transfer">Ø§Ù†ØªÙ‚Ø§Ù„ ÙØ±Ø¯Ø§</button>
          </td>
        `;
        dailyOpenOrdersBody.appendChild(tr);
      }
    });

    if (!hasOrders) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="6" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td>';
      dailyOpenOrdersBody.appendChild(tr);
    }
  }

  // ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ ØµÙˆØ±Øª ØªÙØµÛŒÙ„ÛŒ
  function getDetailedStatusText(order) {
    const status = order.status;
    const carryToTomorrow = order.carryToTomorrow;

    if (carryToTomorrow) {
      return "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ÙØ±Ø¯Ø§";
    } else if (status === "registered") {
      return "Ø«Ø¨Øª Ø´Ø¯Ù‡ - Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø´Ø±ÙˆØ¹";
    } else if (status === "in_progress") {
      return "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…";
    } else if (status === "ready") {
      return "Ø¢Ù…Ø§Ø¯Ù‡ - ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡";
    } else {
      return status;
    }
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´
  document.addEventListener("click", function(e) {
    if (e.target.classList.contains("btn-status") || e.target.dataset.action) {
      const orderId = e.target.dataset.orderId;
      const action = e.target.dataset.action;

      if (!orderId || !action) return;

      const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      const orderIndex = orders.findIndex(o => o.id == orderId);

      if (orderIndex !== -1) {
        if (action === "ready") {
          orders[orderIndex].status = "ready";
          alert("ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.");
        } else if (action === "delivered") {
          orders[orderIndex].status = "delivered";
          alert("Ø³ÙØ§Ø±Ø´ ØªØ­ÙˆÛŒÙ„ Ø´Ø¯.");
        } else if (action === "transfer") {
          orders[orderIndex].carryToTomorrow = true;
          alert("Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ ÙØ±Ø¯Ø§ Ø§Ù†ØªÙ‚Ø§Ù„ ÛŒØ§ÙØª.");
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
        loadDailyOpenOrders(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„
        updateOpenOrdersButtonState(); // Ø¨Ø±ÙˆØ²Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²
      }
    }
  });


  // ØªØ¨Ø¯ÛŒÙ„ ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ
  function getStatusText(status) {
    switch(status) {
      case "registered": return "Ø«Ø¨Øª Ø´Ø¯Ù‡";
      case "in_progress": return "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…";
      case "ready": return "Ø¢Ù…Ø§Ø¯Ù‡";
      case "delivered": return "ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡";
      default: return status;
    }
  }

  // Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²
  function printDailyReport() {
    const printWindow = window.open('', '_blank');
    const today = (new Date()).toLocaleDateString("fa-IR");
    const user = currentUserNameSpan.textContent || "Ú©Ø§Ø±Ø¨Ø±";

    let html = `
      <html>
        <head>
          <title>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ - ${today}</title>
          <style>
            body { font-family: "B Homa", Tahoma, sans-serif; direction: rtl; margin: 20px; }
            .header { text-align: center; border-bottom: 2px solid #1976d2; padding-bottom: 10px; margin-bottom: 20px; }
            .section { margin-bottom: 20px; }
            .section-title { background: #e3f2fd; color: #0d47a1; padding: 8px; font-weight: bold; border-radius: 6px; }
            table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
            th { background: #f5f5f5; font-weight: bold; }
            .summary { display: flex; justify-content: space-around; margin: 20px 0; }
            .summary-item { background: #fafcff; padding: 10px; border-radius: 8px; text-align: center; }
          
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
        </head>
        <body>
          <div class="header">
            <h1>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h1>
            <div style="margin: 10px 0; font-size: 14px; color: #666;">
              <p><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
              <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510 | <strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
            </div>
            <p>ØªØ§Ø±ÛŒØ®: ${today} | Ú©Ø§Ø±Ø¨Ø±: ${user}</p>
          </div>

          <div class="summary">
            <div class="summary-item">
              <div>Ø¯Ø±ÛŒØ§ÙØª Ù†Ù‚Ø¯ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†: ${dailyCashInEl.textContent}</div>
            </div>
            <div class="summary-item">
              <div>Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆØ² Ù…Ø´ØªØ±ÛŒØ§Ù†: ${dailyPosInEl.textContent}</div>
            </div>
            <div class="summary-item">
              <div>Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ù…Ø´ØªØ±ÛŒØ§Ù†: ${dailyCardInEl.textContent}</div>
            </div>
            <div class="summary-item">
              <div>Ù†Ø³ÛŒÙ‡ Ù…Ø´ØªØ±ÛŒØ§Ù†: ${dailyCustomerDebtEl.textContent}</div>
            </div>
            <div class="summary-item">
              <div>Ù¾Ø±Ø¯Ø§Ø®Øª ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚: ${dailyNonCashOutEl.textContent}</div>
            </div>
            <div class="summary-item">
              <div>Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚: ${dailyCashOutEl.textContent}</div>
            </div>
            <div class="summary-item" style="grid-column:1/-1;">
              <div>Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³ÛŒØ³ØªÙ…: ${dailyExpectedCashEl.textContent}</div>
            </div>
          </div>

          <div class="section">
            <div class="section-title">ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚</div>
            <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ: ${dailyRealCashInput.value}</p>
            <p>Ù¾Ø±ØªÛŒ Ú©Ø§ØºØ°: ${dailyPaperWasteInput.value} Ø¨Ø±Ú¯</p>
            <p>ÙˆØ¶Ø¹ÛŒØª: ${dailyDiffTextEl.textContent}</p>
            <p>ØªÙˆØ¶ÛŒØ­Ø§Øª: ${dailyNoteInput.value}</p>
          </div>

          <div class="section">
            <div class="section-title">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ø§Ù…Ø±ÙˆØ²</div>
            <table>
              <thead>
                <tr>
                  <th>Ø´Ù…Ø§Ø±Ù‡</th>
                  <th>Ù…Ø´ØªØ±ÛŒ</th>
                  <th>ÙˆØ¶Ø¹ÛŒØª</th>
                  <th>Ù…Ø§Ù†Ø¯Ù‡</th>
                </tr>
              </thead>
              <tbody>
                ${dailyOpenOrdersBody.innerHTML}
              </tbody>
            </table>
          </div>

          <div class="section">
            <div class="section-title">Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
            <table>
              <thead>
                <tr>
                  <th>Ù…Ø¨Ù„Øº</th>
                  <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                  <th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                  <th>Ø¨Ø§Ø¨Øª</th>
                </tr>
              </thead>
              <tbody>
                ${dailyNonCashPaymentsBody.innerHTML}
              </tbody>
            </table>
          </div>

          <div class="section">
            <div class="section-title">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ø§Ù…Ø±ÙˆØ²</div>
            <table>
              <thead>
                <tr>
                  <th>Ø´Ù…Ø§Ø±Ù‡</th>
                  <th>Ù…Ø´ØªØ±ÛŒ</th>
                  <th>Ø¬Ø²Ø¦ÛŒØ§Øª</th>
                  <th>ÙˆØ¶Ø¹ÛŒØª</th>
                  <th>Ù…Ø§Ù†Ø¯Ù‡</th>
                </tr>
              </thead>
              <tbody>
                ${dailyOpenOrdersBody.innerHTML.replace(/<button[^>]*>.*?<\/button>/g, '')}
              </tbody>
            </table>
          </div>
        </body>
      </html>
    `;

    printWindow.document.write(html);
    printWindow.document.close();
    printWindow.print();
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ù…Ø´Ø®Øµ
  function loadReportForDate(dateType, customDate = null) {
    let targetDate, targetNum;

    if (dateType === "today") {
      targetDate = new Date();
      targetNum = todayNumber();
    } else if (dateType === "yesterday") {
      targetDate = new Date();
      targetDate.setDate(targetDate.getDate() - 1);
      const yesterdayFa = targetDate.toLocaleDateString("fa-IR");
      targetNum = jalaliStringToNumber(yesterdayFa);
    } else if (dateType === "custom" && customDate) {
      targetNum = jalaliStringToNumber(customDate);
      targetDate = new Date(); // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¹Ù†ÙˆØ§Ù†
    } else {
      return;
    }

    // Ø§Ú¯Ø± Ú¯Ø²Ø§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    const dailyMap = loadDailyCloseMap();
    if (dailyMap[targetNum]) {
      displaySavedReport(dailyMap[targetNum]);
      return;
    }

    // Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†
    if (dateType === "today") {
      openDailyCloseModal();
    } else {
      // Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ØŒ Ø§Ú¯Ø± Ú¯Ø²Ø§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ù¾ÛŒØ§Ù… Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡
      alert("Ú¯Ø²Ø§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ® ÛŒØ§ÙØª Ù†Ø´Ø¯.");
      reportDateSelector.value = "today";
      loadReportForDate("today");
    }
  }

  // Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
  function displaySavedReport(report) {
    // Ø®Ù„Ø§ØµÙ‡
    dailyCashInEl.textContent = formatMoney(report.expectedCash + report.diff); // ØªÙ‚Ø±ÛŒØ¨ÛŒ
    dailyPosInEl.textContent = "0"; // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡
    dailyCardInEl.textContent = "0"; // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡
    dailyCustomerDebtEl.textContent = "0"; // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡
    dailyNonCashOutEl.textContent = "0"; // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡
    dailyCashOutEl.textContent = "0"; // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡
    dailyExpectedCashEl.textContent = formatMoney(report.expectedCash);
    dailyExpectedCashEl.dataset.value = String(report.expectedCash);

    // ÙˆØ±ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
    dailyRealCashInput.value = formatMoney(report.realCash);
    dailyPaperWasteInput.value = String(report.paperWaste || 0);
    dailyNoteInput.value = report.note || "";

    // Ù†ØªÛŒØ¬Ù‡ Ù…ØºØ§ÛŒØ±Øª
    const diff = report.realCash - report.expectedCash;
    let txt = "";
    if (diff === 0) {
      txt = "Ø¨Ø¯ÙˆÙ† Ù…ØºØ§ÛŒØ±Øª";
    } else if (diff > 0) {
      txt = "Ø§Ø¶Ø§ÙÙ‡ ØµÙ†Ø¯ÙˆÙ‚: " + formatMoney(diff);
    } else {
      txt = "Ú©Ø³Ø±ÛŒ ØµÙ†Ø¯ÙˆÙ‚: " + formatMoney(-diff);
    }
    dailyDiffTextEl.textContent = txt;

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯)
    dailyOpenOrdersBody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#999;">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</td></tr>';
    dailyNonCashPaymentsBody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#999;">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</td></tr>';

    dailyCloseModal.classList.add("show");
  }


  // ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´
  function setOrderStatus(status) {
    let cls = "status-label ";
    let txt = "";

    if (status === "delivered") {
      cls += "status-delivered";
      txt = "ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡";
      carryToTomorrowChk.checked = false;
      if (inProgressNoteSection) inProgressNoteSection.classList.add("hidden");
      if (inProgressNoteInput) inProgressNoteInput.value = "";
    } else if (status === "ready") {
      cls += "status-ready";
      txt = "Ø¢Ù…Ø§Ø¯Ù‡ (ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡)";
      if (inProgressNoteSection) inProgressNoteSection.classList.add("hidden");
      if (inProgressNoteInput) inProgressNoteInput.value = "";
    } else if (status === "in_progress") {
      cls += "status-inprogress";
      txt = "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…";
      if (inProgressNoteSection) inProgressNoteSection.classList.remove("hidden");
      setTimeout(() => { try { inProgressNoteInput && inProgressNoteInput.focus(); } catch(e){} }, 0);
    } else {
      status = "registered";
      cls += "status-registered";
      txt = "Ø«Ø¨Øª Ø´Ø¯Ù‡";
      if (inProgressNoteSection) inProgressNoteSection.classList.add("hidden");
      if (inProgressNoteInput) inProgressNoteInput.value = "";
    }

    orderStatusHidden.value = status;
    orderStatusText.className = cls;
    orderStatusText.textContent = txt;
  }

  btnStatusDelivered.addEventListener("click", function () { setOrderStatus("delivered"); });
  btnStatusReady.addEventListener("click", function () { setOrderStatus("ready"); });
  btnStatusInProgress.addEventListener("click", function () { setOrderStatus("in_progress"); });

  // ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ù…ØªÙ† (Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²)
  function statusToText(status, carryFromYesterday) {
    let base = "Ø«Ø¨Øª Ø´Ø¯Ù‡ØŒ Ú†Ø§Ù¾ Ù†Ø´Ø¯Ù‡";
    if (status === "ready") base = "Ø¢Ù…Ø§Ø¯Ù‡ØŒ ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡";

    const tags = [];
    if (status === "in_progress") tags.push("Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…");
    if (carryFromYesterday) tags.push("Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø² Ø¯ÛŒØ±ÙˆØ²");

    if (tags.length) return base + " (" + tags.join("ØŒ ") + ")";
    return base;
  }

  // Ú©Ù„Ø§Ø³ Ø¯Ú©Ù…Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²
  function getOpenOrdersButtonClass(orders) {
    const openOrders = (orders || []).filter(o => {
      if (!o) return false;
      const status = o.status || "";
      const isNotDelivered = status !== "delivered";
      const isCarry = !!o.carryToTomorrow;
      const isInProgress = status === "in_progress";
      const isReady = status === "ready";
      return isNotDelivered && (isCarry || isInProgress || isReady);
    });

    if (openOrders.length === 0) return "open-green";

    const hasUrgent = openOrders.some(o => (o.status === "in_progress") || !!o.carryToTomorrow);
    if (hasUrgent) return "open-red";

    const hasReady = openOrders.some(o => o.status === "ready");
    if (hasReady) return "open-yellow";

    return "open-red";
  }

  function updateOpenOrdersButtonState() {
    if (!btnOpenOrders) return;
    const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

    const cls = getOpenOrdersButtonClass(orders);
    btnOpenOrders.classList.remove("open-red","open-yellow","open-green");
    btnOpenOrders.classList.add(cls);
  }

  // Ø®Ù„Ø§ØµÙ‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² (Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ù‡Ù…Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§)
  function getOrderItemsSummary(order) {
    const items = order.items || [];
    if (!items.length) return "Ø¨Ø¯ÙˆÙ† Ø±Ø¯ÛŒÙ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡";

    const lines = items.map((it, i) => {
      const type = it.type || "Ù†Ø§Ù…Ø´Ø®Øµ";
      const short = (it.short || "").trim();
      return (i + 1) + ") " + type + (short ? " - " + short : "");
    });

    return lines.join("<br>");
  }

  // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²
  function showOpenOrdersModal() {
    openOrdersBody.innerHTML = "";
    const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    let idx = 0;

    const openOrders = orders.filter(o => {
      if (!o) return false;
      const status = o.status || "";
      const isNotDelivered = status !== "delivered";
      const isCarry = !!o.carryToTomorrow;
      const isInProgress = status === "in_progress";
      const isReady = status === "ready";
      // Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²: Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…ØŒ Ø¢Ù…Ø§Ø¯Ù‡/ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡ØŒ ÛŒØ§ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ÙØ±Ø¯Ø§ (Ùˆ ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡)
      return isNotDelivered && (isCarry || isInProgress || isReady);
    });

    openOrders.forEach(o => {
      if (!o.dateTime) return;
      const datePart = o.dateTime.split(" ")[0];
      const todayFa = (new Date()).toLocaleDateString("fa-IR");
      const carryFromYesterday = !!o.carryToTomorrow && (datePart !== todayFa);

      idx++;
      const tr = document.createElement("tr");
      const statusText = statusToText(o.status, carryFromYesterday);
      const itemsSummary = getOrderItemsSummary(o);

      tr.innerHTML = `
        <td>${idx}</td>
        <td>${statusText}</td>
        <td>${o.customerName || "Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…"}</td>
        <td></td>
        <td>${carryFromYesterday ? "Ø¨Ù„Ù‡" : (o.carryToTomorrow ? "Ø¨Ù„Ù‡" : "Ø®ÛŒØ±")}</td>
        <td>
          <button type="button"
                  class="btn-small"
                  data-open-order-id="${o.id}">
            Ø¨Ø§Ø² Ú©Ø±Ø¯Ù†
          </button>
        </td>
      `;
      tr.children[3].innerHTML = itemsSummary;
      openOrdersBody.appendChild(tr);
    });

    if (idx === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="6">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²ÛŒ (Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…ØŒ Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ ÛŒØ§ Ø¢Ù…Ø§Ø¯Ù‡/ØªØ­ÙˆÛŒÙ„â€ŒÙ†Ø´Ø¯Ù‡) ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>`;
      openOrdersBody.appendChild(tr);
    }

    openOrdersModal.classList.add("show");
  }

  btnOpenOrders.addEventListener("click", showOpenOrdersModal);
  btnOpenOrdersClose.addEventListener("click", () => {
    openOrdersModal.classList.remove("show");
  });

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´ Ø¯Ø± ÙØ±Ù…
  function loadOrderIntoForm(order) {
    currentEditingOrderId = order && order.id ? order.id : null;
    itemsBody.innerHTML = "";
    selectedRow = null;

    document.getElementById("orderNo").value = order.orderNo || "";
    orderDateTimeInput.value = order.dateTime || (new Date()).toLocaleString("fa-IR");
    txtCustomerName.value    = order.customerName || "";

    currentCustomerInfo.type       = order.customerType || "normal";
    currentCustomerInfo.priceLevel = order.priceLevel  || "normal";
    orderPriceLevelSelect.value    = order.priceLevel  || "normal";

    orderPaymentTypeSelect.value = order.paymentType || "Ù†Ù‚Ø¯ÛŒ";
    orderTotalInput.value   = formatMoney(order.total   || 0);
    orderPaidInput.value    = formatMoney(order.paid    || 0);
    orderBalanceInput.value = formatMoney(order.balance || 0);

    setOrderStatus(order.status || "registered");
    carryToTomorrowChk.checked = !!order.carryToTomorrow;

    if (inProgressNoteInput) inProgressNoteInput.value = order.inProgressNote || "";
    if ((order.status || "") === "in_progress") {
      inProgressNoteSection && inProgressNoteSection.classList.remove("hidden");
    }


    extraCourierChk.checked = order.courierType === "courier";
    courierAmountInput.value = order.courierAmount ? formatMoney(order.courierAmount) : "";
    courierWhoRadios.forEach(r => {
      r.checked = (r.value === (order.courierWho || "customer"));
    });
    updateExtraPriceVisibility();
    updateOrderTotal();

    (order.items || []).forEach(item => {
      const tr = createNewRow();

      const type         = item.type || "";
      const setCount     = item.setCount || 0;
      const totalSheets  = item.totalSheets || 0;
      const pagesPerSet  = item.pagesPerSet || 0;
      const priceMain    = item.priceMain || 0;
      const extraBinding = !!item.extraBinding;
      const extraStaple  = !!item.extraStaple;
      const priceBinding = item.priceBinding || 0;
      const priceStaple  = item.priceStaple  || 0;
      const rowTotal     = item.rowTotal || 0;

      let perSetPrice = 0;
      if (setCount > 0) perSetPrice = Math.round(rowTotal / setCount);
      else perSetPrice = priceMain;

      let detailText = "";
      if (type === "Ú©Ù¾ÛŒ" || type === "Ù¾Ø±ÛŒÙ†Øª") {
        const extraParts = [];
        if (extraBinding && priceBinding) extraParts.push("ÙÙ†Ø±ÛŒ Ù‡Ø± Ø¬Ø²ÙˆÙ‡: " + formatMoney(priceBinding));
        if (extraStaple  && priceStaple)  extraParts.push("Ù…Ù†Ú¯Ù†Ù‡ Ù‡Ø± Ø¬Ø²ÙˆÙ‡: " + formatMoney(priceStaple));
        const extraStr = extraParts.length ? extraParts.join(" ØŒ ") : "Ø¨Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÙ‡";

        detailText =
          "ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡: " + formatMoney(setCount) +
          " | Ø¬Ù…Ø¹ Ø¨Ø±Ú¯: " + formatMoney(totalSheets) +
          " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø±Ú¯: " + formatMoney(priceMain) +
          " | " + extraStr;
      } else if (type === "ÙÙ†Ø±ÛŒ") {
        detailText =
          "Ù†ÙˆØ¹ Ú©Ø§Ø±: " + (item.bindingJobType || "") +
          " | ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡: " + formatMoney(setCount) +
          " | Ø³Ø§ÛŒØ²: " + (item.paperSize || "") +
          " | Ø·Ù„Ù‚: " + (item.bindingCover || "");
      } else if (type === "Ù¾Ø±Ø³") {
        detailText =
          "ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±Ø³: " + formatMoney(setCount) +
          " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ù¾Ø±Ø³: " + formatMoney(priceMain);
      } else if (type === "Ù…Ù†Ú¯Ù†Ù‡") {
        detailText =
          "ØªØ¹Ø¯Ø§Ø¯ Ù…Ù†Ú¯Ù†Ù‡: " + formatMoney(setCount) +
          " | Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…Ù†Ú¯Ù†Ù‡: " + formatMoney(priceMain);
      }

      tr.querySelector(".td-type").textContent   = type;
      tr.querySelector(".td-short").textContent  = item.short || "";
      tr.querySelector(".td-detail").textContent = detailText;
      tr.querySelector(".td-count").textContent  = formatMoney(setCount);
      tr.querySelector(".td-price").textContent  = formatMoney(perSetPrice);
      tr.querySelector(".td-total").textContent  = formatMoney(rowTotal);

      tr.dataset.serviceType       = type;
      tr.dataset.shortDesc         = item.short || "";
      tr.dataset.pagesPerSet       = pagesPerSet;
      tr.dataset.setCount          = setCount;
      tr.dataset.totalSheets       = totalSheets;
      tr.dataset.priceMain         = priceMain;
      tr.dataset.extraBinding      = extraBinding ? "1" : "0";
      tr.dataset.extraStaple       = extraStaple ? "1" : "0";
      tr.dataset.priceBinding      = priceBinding;
      tr.dataset.priceStaple       = priceStaple;
      tr.dataset.rowTotal          = rowTotal;
      tr.dataset.bindingSpiralSize = item.bindingSpiralSize || "";
      tr.dataset.bindingCover      = item.bindingCover      || "";
      tr.dataset.bindingJobType    = item.bindingJobType    || "";
    });

    updateOrderTotal();
  }

  openOrdersBody.addEventListener("click", function (e) {
    const btn = e.target.closest("button[data-open-order-id]");
    if (!btn) return;

    const orderId = btn.getAttribute("data-open-order-id");
    const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    const order = orders.find(o => String(o.id) === String(orderId));

    if (!order) {
      alert("Ø³ÙØ§Ø±Ø´ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.");
      return;
    }

    openOrdersModal.classList.remove("show");
    showPage("orders");
    document.querySelectorAll(".main-menu button[data-page]").forEach(b => b.classList.remove("active"));
    document.querySelector('button[data-page="orders"]').classList.add("active");
    loadOrderIntoForm(order);
  });

  // Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚: Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø®Ø´ Ù¾ÛŒÚ© Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ
  function updateCashPeykVisibility() {
    if (!cashPayTypeSelect) return;
    const payType = cashPayTypeSelect.value;
    const isPeyk = payType === "peyk";
    const isCustomerDebt = payType === "customer_debt";

    // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù¾ÛŒÚ©
    if (isPeyk) cashPeykSectionDiv.classList.remove("hidden");
    else cashPeykSectionDiv.classList.add("hidden");

    // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ
    if (isCustomerDebt && cashCustomerDebtSectionDiv) {
      cashCustomerDebtSectionDiv.classList.remove("hidden");
    } else if (cashCustomerDebtSectionDiv) {
      cashCustomerDebtSectionDiv.classList.add("hidden");
      // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ Ù‡Ù†Ú¯Ø§Ù… Ù…Ø®ÙÛŒ Ø´Ø¯Ù†
      if (cashPayDebtCustomerInput) cashPayDebtCustomerInput.value = "";
      if (cashPayDebtBalanceInput) cashPayDebtBalanceInput.value = "";
    }

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ Ú†ÙˆÙ† Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    const customerRow = document.querySelector('.row:has(#cashPayCustomer)');
    if (customerRow) {
      if (isCustomerDebt) {
        customerRow.style.display = 'none';
      } else {
        customerRow.style.display = 'flex';
      }
    }
  }
  function updatePeykDestinationOtherVisibility() {
    if (!peykDestinationSelect) return;
    const isOther = peykDestinationSelect.value === "other";
    if (isOther) peykDestinationOtherRow.classList.remove("hidden");
    else peykDestinationOtherRow.classList.add("hidden");
  }
  cashPayTypeSelect.addEventListener("change", updateCashPeykVisibility);
  peykDestinationSelect.addEventListener("change", updatePeykDestinationOtherVisibility);

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¨Ø¯Ù‡Ú©Ø§Ø±
  if (btnSelectDebtCustomer) {
    btnSelectDebtCustomer.addEventListener("click", function(e) {
      e.preventDefault();
      console.log("Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ú©Ù„ÛŒÚ© Ø´Ø¯");
      showDebtSettlementModal();
    });
  } else {
    console.error("Ø¯Ú©Ù…Ù‡ btnSelectDebtCustomer Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
  }

  // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ ØªØ³ÙˆÛŒÙ‡ Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ
  function showDebtSettlementModal() {
    const debtCustomerSearch = document.getElementById("debtCustomerSearch");
    const modal = document.getElementById("debtSettlementModal");

    if (!modal) {
      console.error("Ù…ÙˆØ¯Ø§Ù„ debtSettlementModal Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
      return;
    }

    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ
    if (debtCustomerSearch) {
      debtCustomerSearch.value = "";
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø¯Ù‡Ú©Ø§Ø±
    loadDebtCustomers();

    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² flex Ø¨Ù‡ Ø¬Ø§ÛŒ block)
    modal.style.display = "flex";
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ (ÛŒÚ© Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
  const debtCustomerSearch = document.getElementById("debtCustomerSearch");
  if (debtCustomerSearch) {
    debtCustomerSearch.addEventListener("input", function() {
      loadDebtCustomers(this.value);
    });
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø¯Ù‡Ú©Ø§Ø±
  function loadDebtCustomers(searchTerm = "") {
    const debtCustomersBody = document.getElementById("debtCustomersBody");
    const allOrders = loadAllOrders();

    // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø´ØªØ±ÛŒ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù†Ø¯Ù‡â€ŒÙ‡Ø§
    const customerBalances = new Map();

    allOrders.forEach(order => {
      const customerName = order.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡";
      const balance = (order.total || 0) - (order.paid || 0);

      if (balance > 0) {
        if (!customerBalances.has(customerName)) {
          customerBalances.set(customerName, {
            totalOrders: 0,
            totalPaid: 0,
            totalBalance: 0,
            orderCount: 0,
            lastOrderDate: order.dateTime || ""
          });
        }

        const customer = customerBalances.get(customerName);
        customer.totalOrders += (order.total || 0);
        customer.totalPaid += (order.paid || 0);
        customer.totalBalance += balance;
        customer.orderCount += 1;

        if (order.dateTime > customer.lastOrderDate) {
          customer.lastOrderDate = order.dateTime;
        }
      }
    });

    // ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ø³ØªØ¬Ùˆ
    let filteredCustomers = Array.from(customerBalances.entries());
    if (searchTerm) {
      filteredCustomers = filteredCustomers.filter(([name, data]) =>
        name.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }

    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø§Ù†Ø¯Ù‡ (Ù†Ø²ÙˆÙ„ÛŒ)
    filteredCustomers.sort(([a, b]) => b[1].totalBalance - a[1].totalBalance);

    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
    debtCustomersBody.innerHTML = "";

    if (filteredCustomers.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="4" style="text-align:center; color:#666; padding:20px;">Ù…Ø´ØªØ±ÛŒ Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      debtCustomersBody.appendChild(tr);
      return;
    }

    filteredCustomers.forEach(([customerName, data]) => {
      const tr = document.createElement("tr");
      tr.style.cursor = "pointer";
      tr.style.transition = "background-color 0.2s";
      tr.onmouseenter = () => tr.style.backgroundColor = "#f0f0f0";
      tr.onmouseleave = () => tr.style.backgroundColor = "";
      tr.onclick = function(e) {
        e.preventDefault();
        console.log("Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ:", customerName);
        selectDebtCustomer(customerName, data.totalBalance);
      };
      tr.innerHTML = `
        <td style="border:1px solid #ddd; padding:8px;">${customerName}</td>
        <td style="border:1px solid #ddd; padding:8px;">${data.orderCount}</td>
        <td style="border:1px solid #ddd; padding:8px;">${formatMoney(data.totalBalance)}</td>
        <td style="border:1px solid #ddd; padding:8px;">${data.lastOrderDate}</td>
      `;
      debtCustomersBody.appendChild(tr);
    });
  }

  // Ø§Ø¹Ù…Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ Ø¨Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
  function applyCustomerDebtPayment(customerName, paymentAmount, dateTime, user) {
    const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    let remainingPayment = paymentAmount;

    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ Ú©Ù‡ Ù‡Ù†ÙˆØ² Ø¨Ø¯Ù‡ÛŒ Ø¯Ø§Ø±Ù†Ø¯
    const customerOrders = orders.filter(order =>
      (order.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡") === customerName &&
      ((order.total || 0) - (order.paid || 0)) > 0
    ).sort((a, b) => {
      // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
      return new Date(b.dateTime || 0) - new Date(a.dateTime || 0);
    });

    // Ø§Ø¹Ù…Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
    for (const order of customerOrders) {
      if (remainingPayment <= 0) break;

      const currentBalance = (order.total || 0) - (order.paid || 0);
      if (currentBalance > 0) {
        const paymentForThisOrder = Math.min(remainingPayment, currentBalance);
        order.paid = (order.paid || 0) + paymentForThisOrder;
        order.balance = (order.total || 0) - order.paid;
        remainingPayment -= paymentForThisOrder;

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ø³ÙØ§Ø±Ø´
        if (!order.payments) order.payments = [];
        order.payments.push({
          amount: paymentForThisOrder,
          dateTime: dateTime,
          user: user,
          type: "customer_debt"
        });
      }
    }

    // Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡
    localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
  }

  // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¨Ø¯Ù‡Ú©Ø§Ø±
  function selectDebtCustomer(customerName, totalBalance) {
    console.log("Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ:", customerName, "Ù…Ø§Ù†Ø¯Ù‡:", totalBalance);
    
    // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ
    if (cashPayDebtCustomerInput) {
      cashPayDebtCustomerInput.value = customerName;
      console.log("ÙÛŒÙ„Ø¯ Ù…Ø´ØªØ±ÛŒ Ù¾Ø± Ø´Ø¯:", cashPayDebtCustomerInput.value);
    } else {
      console.error("ÙÛŒÙ„Ø¯ cashPayDebtCustomerInput Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
    }
    
    if (cashPayDebtBalanceInput) {
      cashPayDebtBalanceInput.value = formatMoney(totalBalance) + " Ø±ÛŒØ§Ù„";
      console.log("ÙÛŒÙ„Ø¯ Ù…Ø§Ù†Ø¯Ù‡ Ù¾Ø± Ø´Ø¯:", cashPayDebtBalanceInput.value);
    } else {
      console.error("ÙÛŒÙ„Ø¯ cashPayDebtBalanceInput Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
    }

    // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ù…Ø´ØªØ±ÛŒ Ø¯Ø± ÙØ±Ù… Ù¾Ø±Ø¯Ø§Ø®Øª (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ)
    if (cashPayCustomerInput) {
      cashPayCustomerInput.value = customerName;
    }

    // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
    const modal = document.getElementById("debtSettlementModal");
    if (modal) {
      modal.style.display = "none";
      console.log("Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø³ØªÙ‡ Ø´Ø¯");
    } else {
      console.error("Ù…ÙˆØ¯Ø§Ù„ debtSettlementModal Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
    }
  }
  // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ±Ù… Ù¾Ø±Ø¯Ø§Ø®Øª ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ø§Ø² ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†
  window.openCustomerPaymentFromAccounts = function (customerName, balance) {
    try {
      if (btnCashFromBox) {
        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ØµÙ†Ø¯ÙˆÙ‚ Ùˆ Ø±ÛŒØ³Øª Ø§ÙˆÙ„ÛŒÙ‡ ÙÛŒÙ„Ø¯Ù‡Ø§
        btnCashFromBox.click();
      }

      // ØªÙ†Ø¸ÛŒÙ… Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±ÙˆÛŒ "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ"
      if (cashPayTypeSelect) {
        cashPayTypeSelect.value = "customer_debt";
        updateCashPeykVisibility();
      }

      // Ù¾Ø± Ú©Ø±Ø¯Ù† Ù†Ø§Ù… Ùˆ Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ
      if (cashPayDebtCustomerInput) {
        cashPayDebtCustomerInput.value = customerName;
      }
      if (cashPayDebtBalanceInput) {
        cashPayDebtBalanceInput.value = formatMoney(balance) + " Ø±ÛŒØ§Ù„";
      }

      // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡ (Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªØºÛŒÛŒØ±Ø´ Ø¯Ù‡Ø¯)
      if (cashPayAmountInput) {
        cashPayAmountInput.value = formatMoney(balance);
      }

      // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ØŒ Ù†Ø§Ù… Ø·Ø±Ù Ø­Ø³Ø§Ø¨ Ø±Ø§ Ù‡Ù… ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      if (cashPayCustomerInput) {
        cashPayCustomerInput.value = customerName;
      }
    } catch (e) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± openCustomerPaymentFromAccounts:", e);
    }
  };


  btnCashFromBox.addEventListener("click", () => {
    const now = new Date();
    cashPayDateTimeInput.value = now.toLocaleString("fa-IR");
    cashPayAmountInput.value   = "";
    cashPayMethodSelect.value  = "cash";
    cashPayTypeSelect.value    = "cost";
    peykSectionSelect.value    = "copy_print";
    peykDestinationSelect.value= "andisheh";
    peykDestinationOtherInp.value = "";
    peykOrderNoInput.value     = "";
    cashPayReasonInput.value   = "";
    cashPayCustomerInput.value = txtCustomerName.value.trim();
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ
    if (cashPayDebtCustomerInput) cashPayDebtCustomerInput.value = "";
    if (cashPayDebtBalanceInput) cashPayDebtBalanceInput.value = "";

    updateCashPeykVisibility();
    updatePeykDestinationOtherVisibility();
    cashFromBoxModal.classList.add("show");
  });
  btnCashCancel.addEventListener("click", () => {
    cashFromBoxModal.classList.remove("show");
  });

  btnCashSave.addEventListener("click", () => {
    const amount = parseMoney(cashPayAmountInput.value);
    if (!amount) {
      alert("Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
      return;
    }

    const payType = cashPayTypeSelect.value;
    
    // Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ Ø§Ø² ÙÛŒÙ„Ø¯ Ù…Ø®ØµÙˆØµ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    let customerName = "";
    if (payType === "customer_debt") {
      customerName = cashPayDebtCustomerInput ? cashPayDebtCustomerInput.value.trim() : "";
      if (!customerName) {
        alert("Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ÛŒØ¯ Ù…Ø´ØªØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯.");
        return;
      }
    } else {
      customerName = cashPayCustomerInput.value.trim();
    }

    const reason = cashPayReasonInput.value.trim() || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
    const dateTime = cashPayDateTimeInput.value.trim() || (new Date()).toLocaleString("fa-IR");
    const user = currentUserNameSpan.textContent || "Ú©Ø§Ø±Ø¨Ø±";

    const payMethod = cashPayMethodSelect.value;

    const payMethodLabelMap = {
      cash: "Ù†Ù‚Ø¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚",
      office_card: "Ú©Ø§Ø±Øª Ø¯ÙØªØ±",
      personal_card: "Ú©Ø§Ø±Øª Ø´Ø®ØµÛŒ",
      bank_transfer: "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ",
      other: "Ø³Ø§ÛŒØ±"
    };
    const payTypeLabelMap = {
      cost: "Ù‡Ø²ÛŒÙ†Ù‡",
      peyk: "Ù¾ÛŒÚ©",
      refund: "Ø¨Ø±Ú¯Ø´Øª ÙˆØ¬Ù‡ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ",
      supplier: "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡",
      manager_payment: "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø¯ÛŒØ±",
      owner_draw: "Ø¨Ø±Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ",
      other: "Ø³Ø§ÛŒØ±"
    };

    let peykSection = "";
    let peykDestination = "";
    let peykDestinationText = "";
    let peykOrderNo = "";

    if (payType === "peyk") {
      peykSection        = peykSectionSelect.value;
      peykDestination    = peykDestinationSelect.value;
      peykDestinationText= peykDestination === "other" ? peykDestinationOtherInp.value.trim() : "";
      peykOrderNo        = peykOrderNoInput.value.trim();
    }

    // Ø§Ú¯Ø± Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯Ù‡ÛŒ Ù…Ø´ØªØ±ÛŒ Ø§Ø³ØªØŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø¨Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒÙ…
    if (payType === "customer_debt" && customerName) {
      applyCustomerDebtPayment(customerName, amount, dateTime, user);
    }

    const pays = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");
    pays.push({
      id: Date.now(),
      dateTime,
      amount,
      reason,
      customerName,
      user,
      payMethod,
      payMethodLabel: payMethodLabelMap[payMethod] || "",
      payType,
      payTypeLabel: payTypeLabelMap[payType] || "",
      peykSection,
      peykDestination,
      peykDestinationText,
      peykOrderNo
    });
    localStorage.setItem(CASH_STORAGE_KEY, JSON.stringify(pays));
    alert("Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ø«Ø¨Øª Ø´Ø¯.");
    cashFromBoxModal.classList.remove("show");
    loadCashPaymentsToReport();
  });

  btnSaveOrder.addEventListener("click", () => {
    const rows = itemsBody.querySelectorAll("tr");
    if (!rows.length) {
      alert("Ù‡ÛŒÚ† Ø±Ø¯ÛŒÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
      return;
    }
    const customerName = txtCustomerName.value.trim();
    if (!customerName) {
      if (!confirm("Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù… Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ØŸ")) {
        return;
      }
    }

    const orders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

    const courier = getCourierInfo();

    const order = {
      id: currentEditingOrderId ? currentEditingOrderId : Date.now(),
      orderNo: document.getElementById("orderNo").value.trim(),
      dateTime: orderDateTimeInput.value,
      customerName: customerName,
      user: currentUserNameSpan.textContent,
      total: parseMoney(orderTotalInput.value),
      paid: parseMoney(orderPaidInput.value),
      balance: parseMoney(orderBalanceInput.value),
      customerType: currentCustomerInfo.type,
      priceLevel: orderPriceLevelSelect.value,
      paymentType: orderPaymentTypeSelect.value,
      status: orderStatusHidden.value || "registered",
      inProgressNote: (orderStatusHidden.value === "in_progress") ? (inProgressNoteInput ? inProgressNoteInput.value.trim() : "") : "",
      carryToTomorrow: !!carryToTomorrowChk.checked,
      courierType: courier.enabled ? "courier" : "none",
      courierWho: courier.enabled ? courier.who : "",
      courierAmount: courier.enabled ? courier.amount : 0,
      items: []
    };

    rows.forEach(tr => {
      order.items.push({
        type:         tr.dataset.serviceType || "",
        short:        tr.dataset.shortDesc  || "",
        pagesPerSet:  parseIntSafe(tr.dataset.pagesPerSet || "0"),
        setCount:     parseIntSafe(tr.dataset.setCount    || "0"),
        totalSheets:  parseIntSafe(tr.dataset.totalSheets || "0"),
        priceMain:    parseIntSafe(tr.dataset.priceMain   || "0"),
        extraBinding: tr.dataset.extraBinding === "1",
        extraStaple:  tr.dataset.extraStaple === "1",
        priceBinding: parseIntSafe(tr.dataset.priceBinding || "0"),
        priceStaple:  parseIntSafe(tr.dataset.priceStaple  || "0"),
        rowTotal:     parseIntSafe(tr.dataset.rowTotal     || "0"),
        bindingSpiralSize: tr.dataset.bindingSpiralSize || "",
        bindingCover:      tr.dataset.bindingCover      || "",
        bindingJobType:    tr.dataset.bindingJobType    || "",
        // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø²ÛŒØ±Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
        paperSize:      tr.dataset.paperSize    || "",
        colorMode:      tr.dataset.colorMode    || "",
        printType:      tr.dataset.printType    || "",
        paperType:      tr.dataset.paperType    || "",
        paperWeight:    tr.dataset.paperWeight  || ""
      });
    });


    if (currentEditingOrderId) {
      // ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ¬ÙˆØ¯
      const idxExisting = orders.findIndex(o => String(o.id) === String(currentEditingOrderId));
      if (idxExisting !== -1) {
        orders[idxExisting] = order;
      } else {
        orders.push(order);
      }
      alert("ØªØºÛŒÛŒØ±Ø§Øª ÙØ§Ú©ØªÙˆØ± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
    } else {
      // Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯
      orders.push(order);
      alert("Ø³ÙØ§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
    currentEditingOrderId = null;
    loadSavedOrdersToReport();
    updateOpenOrdersButtonState();
  });

  document
    .querySelector('button[data-page="reports"]')
    .addEventListener("click", () => {
      loadCashPaymentsToReport();
      updateOpenOrdersButtonState();
    });

  document.getElementById("btnReportToday").addEventListener("click", () => {
    openDailyCloseModal();
  });

  if (dailyRealCashInput) {
    dailyRealCashInput.addEventListener("input", recalcDailyDiff);
  }

  if (btnDailyCloseCancel) {
    btnDailyCloseCancel.addEventListener("click", () => {
      dailyCloseModal.classList.remove("show");
    });
  }

  if (btnDailyCloseSave) {
    btnDailyCloseSave.addEventListener("click", () => {
      const allOrders = loadAllOrders();
      const todayNum  = todayNumber();
      const todayFa   = (new Date()).toLocaleDateString("fa-IR");

      const expected = parseMoney(dailyExpectedCashEl.dataset.value || "0");
      const real     = parseMoney(dailyRealCashInput.value);
      const diff     = real - expected;
      const paperWaste = parseInt(dailyPaperWasteInput.value) || 0;
      const note     = dailyNoteInput.value.trim();

      const dailyMap = loadDailyCloseMap();

      if (dailyMap[todayNum] && !confirm("Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ù‚Ø¨Ù„Ø§Ù‹ Ú¯Ø²Ø§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ØŸ")) {
        return;
      }

      dailyMap[todayNum] = {
        dateNum:      todayNum,
        dateLabel:    todayFa,
        user:         currentUserNameSpan.textContent || "Ú©Ø§Ø±Ø¨Ø±",
        expectedCash: expected,
        realCash:     real,
        diff:         diff,
        paperWaste:   paperWaste,
        note:         note
      };

      localStorage.setItem(DAILY_CLOSE_KEY, JSON.stringify(dailyMap));

      // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø±ÙˆØ² Ø¨Ø¹Ø¯
      const realCashBaseMap = JSON.parse(localStorage.getItem(REAL_CASH_BASE_KEY) || "{}");
      realCashBaseMap[todayNum] = real;
      localStorage.setItem(REAL_CASH_BASE_KEY, JSON.stringify(realCashBaseMap));

      alert("Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.");
      dailyCloseModal.classList.remove("show");

      updateQuickSummary(allOrders);
    });
  }

  // Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´
  if (btnDailyClosePrint) {
    btnDailyClosePrint.addEventListener("click", () => {
      printDailyReport();
    });
  }


  // Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´
  if (reportDateSelector) {
    reportDateSelector.addEventListener("change", () => {
      const selected = reportDateSelector.value;
      if (selected === "custom") {
        customDateField.style.display = "block";
        customReportDate.focus();
      } else {
        customDateField.style.display = "none";
        loadReportForDate(selected);
      }
    });
  }

  if (customReportDate) {
    customReportDate.addEventListener("blur", () => {
      const dateStr = customReportDate.value.trim();
      if (dateStr) {
        loadReportForDate("custom", dateStr);
      }
    });
  }



  document.getElementById("btnNewOrder").addEventListener("click", () => {
    // Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø±ÙˆÛŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ù…Ø­Ù„ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    document.getElementById("orderNo").value = getNextOrderNumber();
    itemsBody.innerHTML = "";
    orderTotalInput.value   = "0";
    orderPaidInput.value    = "0";
    orderBalanceInput.value = "0";
    clearDetailForm();
    selectedRow = null;
    const now = new Date();
    orderDateTimeInput.value = now.toLocaleString("fa-IR");
    txtCustomerName.value = "";
    setOrderStatus("registered");
    if (inProgressNoteInput) inProgressNoteInput.value = "";
    if (inProgressNoteSection) inProgressNoteSection.classList.add("hidden");
    carryToTomorrowChk.checked = false;
    extraBindingChk.checked = false;
    extraStapleChk.checked  = false;
    extraCourierChk.checked = false;
    updateExtraPriceVisibility();
    courierAmountInput.value = "";
    courierWhoRadios.forEach(r => { r.checked = (r.value === "customer"); });
    updateOrderTotal();
  });


  const btnNewOrderTop = document.getElementById("btnNewOrderTop");
  if (btnNewOrderTop) {
    btnNewOrderTop.addEventListener("click", () => {
      const btnNewOrder = document.getElementById("btnNewOrder");
      if (btnNewOrder) btnNewOrder.click();
    });
  }
// Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯ Ø³ÙØ§Ø±Ø´ Ù…Ø´ØªØ±ÛŒ
document.getElementById("btnPrintReceipt").addEventListener("click", () => {

  // Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
  const parse = (typeof parseMoney === "function")
    ? parseMoney
    : (v => Number((v || "0").toString().replace(/,/g, "")));

  const fmt = (typeof formatMoney === "function")
    ? formatMoney
    : (n => Number(n || 0).toLocaleString("fa-IR"));

  // --- ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ Ø¨Ù‡ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ ---
  function numberToWords(num) {
    if (!num || num === 0) return "ØµÙØ±";

    const yekan = ["", "ÛŒÚ©", "Ø¯Ùˆ", "Ø³Ù‡", "Ú†Ù‡Ø§Ø±", "Ù¾Ù†Ø¬", "Ø´Ø´", "Ù‡ÙØª", "Ù‡Ø´Øª", "Ù†Ù‡"];
    const dah = ["Ø¯Ù‡", "ÛŒØ§Ø²Ø¯Ù‡", "Ø¯ÙˆØ§Ø²Ø¯Ù‡", "Ø³ÛŒØ²Ø¯Ù‡", "Ú†Ù‡Ø§Ø±Ø¯Ù‡", "Ù¾Ø§Ù†Ø²Ø¯Ù‡", "Ø´Ø§Ù†Ø²Ø¯Ù‡", "Ù‡ÙØ¯Ù‡", "Ù‡Ø¬Ø¯Ù‡", "Ù†ÙˆØ²Ø¯Ù‡"];
    const dahgan = ["", "", "Ø¨ÛŒØ³Øª", "Ø³ÛŒ", "Ú†Ù‡Ù„", "Ù¾Ù†Ø¬Ø§Ù‡", "Ø´ØµØª", "Ù‡ÙØªØ§Ø¯", "Ù‡Ø´ØªØ§Ø¯", "Ù†ÙˆØ¯"];
    const sadgan = ["", "ØµØ¯", "Ø¯ÙˆÛŒØ³Øª", "Ø³ÛŒØµØ¯", "Ú†Ù‡Ø§Ø±ØµØ¯", "Ù¾Ø§Ù†ØµØ¯", "Ø´Ø´ØµØ¯", "Ù‡ÙØªØµØ¯", "Ù‡Ø´ØªØµØ¯", "Ù†Ù‡ØµØ¯"];
    const basex = ["", "Ù‡Ø²Ø§Ø±", "Ù…ÛŒÙ„ÛŒÙˆÙ†", "Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯"];

    num = parseInt(num, 10);
    let result = "";
    let counter = 0;

    while (num > 0) {
      let chunk = num % 1000;
      if (chunk !== 0) {
        let chunkText = "";

        let s = Math.floor(chunk / 100);
        let d = Math.floor((chunk % 100) / 10);
        let y = chunk % 10;

        if (s > 0) chunkText += sadgan[s];
        if (chunkText && (d > 0 || y > 0)) chunkText += " Ùˆ ";

        if (d === 1) {
          chunkText += dah[y];
        } else {
          if (d > 1) chunkText += dahgan[d];
          if (d > 1 && y > 0) chunkText += " Ùˆ ";
          if (d !== 1 && y > 0) chunkText += yekan[y];
        }

        result = chunkText + " " + basex[counter] + (result ? " Ùˆ " + result : "");
      }

      num = Math.floor(num / 1000);
      counter++;
    }

    return result.trim() + " ØªÙˆÙ…Ø§Ù†";
  }

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ Ø³ÙØ§Ø±Ø´
  const customerName = txtCustomerName.value || "Ù…Ø´ØªØ±ÛŒ";

  // Ø§Ú¯Ø± Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
  let orderNoInput = document.getElementById("orderNo");
  if (orderNoInput && !orderNoInput.value.trim()) {
    orderNoInput.value = getNextOrderNumber();
  }
  const orderNo      = (orderNoInput && orderNoInput.value) ? orderNoInput.value : "-";
  const dateTime     = document.getElementById("orderDateTime").value || "";

  const total   = parse(orderTotalInput.value);
  const paid    = parse(orderPaidInput.value);
  const balance = parse(orderBalanceInput.value);

  // Ù…Ø§Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ Ù…Ø´ØªØ±ÛŒ
  const allOrders = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  const customerPreviousBalance = allOrders
    .filter(o => (o.customerName || "") === customerName && parse(o.balance) > 0)
    .reduce((sum, o) => sum + parse(o.balance), 0);

  const finalBalance = customerPreviousBalance + balance;

  // Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
  const courierInfoForPrint = typeof getCourierInfo === "function" ? getCourierInfo() : null;
  let rowsHTML = "";
  let rowIndex = 0;
  itemsBody.querySelectorAll("tr").forEach(tr => {
    rowIndex += 1;
    const tds = tr.querySelectorAll("td");

    const typeText   = tds[1]?.textContent || "";
    const shortText  = tds[2]?.textContent || "";
    const detailText = tds[3]?.textContent || "";
    const detailsCell = [shortText, detailText].filter(Boolean).join(" | ");

    const countText = tds[4]?.textContent || "";
    const priceText = tds[5]?.textContent || "";
    const rowTotal  = tds[6]?.textContent || "";

    rowsHTML += `
      <tr>
        <td>${rowIndex}</td>
        <td>${typeText}</td>
        <td style="white-space:pre-wrap; text-align:right">${detailsCell}</td>
        <td>${countText}</td>
        <td>${priceText}</td>
        <td>${rowTotal}</td>
      </tr>`;
  });
  if (courierInfoForPrint && courierInfoForPrint.enabled && courierInfoForPrint.who === "customer") {
    rowIndex += 1;
    rowsHTML += `
      <tr>
        <td>${rowIndex}</td>
        <td>Ù¾ÛŒÚ©</td>
        <td style="white-space:pre-wrap; text-align:right">Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ (Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ)</td>
        <td>1</td>
        <td>${fmt(courierInfoForPrint.amount)}</td>
        <td>${fmt(courierInfoForPrint.amount)}</td>
      </tr>`;
  }

  // ------------------ Ú†Ø§Ù¾ --------------------
  const w = window.open("", "_blank");
  w.document.open();

  // âœ³ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù„ÛŒ ÙÙ‚Ø· Ø§Ú¯Ø± Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„ > ØµÙØ± Ø¨Ø§Ø´Ø¯
  const showFinancial = finalBalance > 0;

  w.document.write(`
  <html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <title>Ø±Ø³ÛŒØ¯ Ø³ÙØ§Ø±Ø´</title>
    <style>
      body {
        font-family: Tahoma, sans-serif;
        padding: 25px;
        direction: rtl;
        font-size: 14px;
      }
      h2 {
        text-align: center;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: bold;
      }
      .header-box { margin-bottom: 20px; font-size: 14px; }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th, td {
        border: 1px solid #999;
        padding: 6px;
        text-align: center;
        font-size: 13px;
      }
      th { background: #f1f1f1; }
      .section-title {
        margin-top: 20px;
        font-weight: bold;
        font-size: 15px;
      }
      tfoot td {
        background: #f1f1f1;
        font-weight: bold;
      }
      .info-box {
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.8;
      }
      .signature-box {
        margin-top: 40px;
        height: 70px;
        text-align: center;
        border: 1px dashed #777;
        padding-top: 22px;
        font-size: 15px;
      }
    
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
  </head>

  <body>

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯ -->
    <h2>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h2>

    <div class="header-box">
      <div>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ: <strong>${customerName}</strong></div>
      <div>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´: <strong>${orderNo}</strong></div>
      <div>ØªØ§Ø±ÛŒØ®: <strong>${dateTime}</strong></div>
    </div>

    <div class="section-title">Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´</div>

    <table>
      <thead>
        <tr>
          <th>Ø±Ø¯ÛŒÙ</th>
          <th>Ù†ÙˆØ¹</th>
          <th>Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´</th>
          <th>ØªØ¹Ø¯Ø§Ø¯</th>
          <th>Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡</th>
          <th>Ø¬Ù…Ø¹ Ø±Ø¯ÛŒÙ</th>
        </tr>
      </thead>
      <tbody>${rowsHTML}</tbody>
      <tfoot>
        <tr>
          <td colspan="5">Ø¬Ù…Ø¹ Ú©Ù„ Ø³ÙØ§Ø±Ø´ (Ø¨Ù‡ Ø¹Ø¯Ø¯)</td>
          <td>${fmt(total)}</td>
        </tr>
        <tr>
          <td colspan="6" style="text-align:right;padding:8px;font-weight:bold;">
            Ø¬Ù…Ø¹ Ú©Ù„ (Ø¨Ù‡ Ø­Ø±ÙˆÙ): ${numberToWords(total)}
          </td>
        </tr>
      </tfoot>
    </table>

    ${
      showFinancial
        ? `
      <div class="section-title">ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù„ÛŒ</div>
      <table>
        <tr><td>Ø¬Ù…Ø¹ Ú©Ù„ Ø³ÙØ§Ø±Ø´</td><td>${fmt(total)}</td></tr>
        <tr><td>Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</td><td>${fmt(paid)}</td></tr>
        <tr><td>Ù…Ø§Ù†Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²</td><td>${fmt(balance)}</td></tr>
        <tr><td>Ù…Ø§Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ Ù…Ø´ØªØ±ÛŒ</td><td>${fmt(customerPreviousBalance)}</td></tr>
        <tr><td><strong>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</strong></td><td><strong>${fmt(finalBalance)}</strong></td></tr>
      </table>
      `
        : ``
    }

    <div class="section-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÙØªØ±</div>
    <div class="info-box">
      <strong>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</strong><br>
      Ø¢Ø¯Ø±Ø³: Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ<br>
      Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: 02165280510<br>
      Ø³Ø§ÛŒØª: Myghalam.com
    </div>

    <div class="signature-box">Ù…Ù‡Ø± Ùˆ Ø§Ù…Ø¶Ø§</div>

  </body>
  </html>
  `);

  w.document.close();
  w.focus();
  w.print();
});


  document.getElementById("btnClose").addEventListener("click", () => {
    alert("Ø¯Ø± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ø¯.");
  });

  // ================== Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØªÛŒ (Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ghozaresh) ==================


  function switchToCashPaymentsReport() {
    // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯ÛŒÚ¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú†ÙˆÙ† Ù…Ù†Ø·Ù‚ Ø±Ø§ Ù…Ø³ØªÙ‚ÛŒÙ… Ù†ÙˆØ´ØªÙ…
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
  function loadUsersForCashReport() {
    const users = new Set();
    const allPayments = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");
    allPayments.forEach(p => {
      if (p.user) users.add(p.user);
    });

    cashRepUser.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>';
    users.forEach(user => {
      const option = document.createElement("option");
      option.value = user;
      option.textContent = user;
      cashRepUser.appendChild(option);
    });
  }

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ - Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  // Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯

  console.log("Setting up event listeners...");

  // Ø±Ø§Ù‡ Ø­Ù„ Ù†Ù‡Ø§ÛŒÛŒ - Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø·Ù…Ø¦Ù†

  document.getElementById("tabOrdersReport").onclick = function() {
    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
    var ordersSection = document.getElementById("ordersReportSection");
    if (ordersSection) ordersSection.style.display = "block";

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ØŒ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† Ùˆ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var paymentsSection = document.getElementById("cashPaymentsReportSection");
    if (paymentsSection) paymentsSection.style.display = "none";

    var paymentsContainer = document.getElementById("cashPaymentsReportContainer");
    if (paymentsContainer) paymentsContainer.style.display = "none";

    var customerBalanceSection = document.getElementById("customerBalanceReportContainer");
    if (customerBalanceSection) customerBalanceSection.style.display = "none";

    var customersSection = document.getElementById("customersReportContainer");
    if (customersSection) customersSection.style.display = "none";

    // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØªØ¨â€ŒÙ‡Ø§ Ùˆ Ú©Ø§Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) {
      ordersTab.style.background = "#1976d2";
      ordersTab.style.border = "2px solid #d32f2f";
      ordersTab.style.borderRadius = "4px";
      ordersTab.style.opacity = "1";
    }

    // ØªÙ†Ø¸ÛŒÙ… background Ø¨Ù‚ÛŒÙ‡ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) paymentsTab.style.background = "#f5f5f5";

    var balanceTab = document.getElementById("tabCustomerBalanceReport");
    if (balanceTab) balanceTab.style.background = "#f5f5f5";

    var customersTab = document.getElementById("tabCustomersReport");
    if (customersTab) customersTab.style.background = "#f5f5f5";

    // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø²ÛŒØ±ÙÛŒÙ„ØªØ±Ù‡Ø§
    buildSubFilterUI();

    // Ø§Ø¬Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´
    runReport();
  };

  document.getElementById("tabCashPaymentsReport").onclick = function() {
    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ø³ÙØ§Ø±Ø´Ø§ØªØŒ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† Ùˆ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var ordersSection = document.getElementById("ordersReportSection");
    if (ordersSection) ordersSection.style.display = "none";

    var customerBalanceSection = document.getElementById("customerBalanceReportContainer");
    if (customerBalanceSection) customerBalanceSection.style.display = "none";

    var customersSection = document.getElementById("customersReportContainer");
    if (customersSection) customersSection.style.display = "none";

    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
    var paymentsSection = document.getElementById("cashPaymentsReportSection");
    if (paymentsSection) paymentsSection.style.display = "block";

    var paymentsContainer = document.getElementById("cashPaymentsReportContainer");
    if (paymentsContainer) paymentsContainer.style.display = "block";

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ Ùˆ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
    var productSummarySection = document.querySelector('.section:has(.product-summary-table)');
    if (productSummarySection) productSummarySection.style.display = "none";

    var ordersTableContainer = document.getElementById("ordersTableContainer");
    if (ordersTableContainer) ordersTableContainer.style.display = "none";

    // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØªØ¨â€ŒÙ‡Ø§
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) {
      ordersTab.style.background = "#f5f5f5";
      ordersTab.style.opacity = "1";
      ordersTab.style.border = "none";
    }

    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) {
      paymentsTab.style.background = "#2e7d32";
      paymentsTab.style.border = "2px solid #d32f2f";
      paymentsTab.style.borderRadius = "4px";
      paymentsTab.style.opacity = "1";
    }

    // ØªÙ†Ø¸ÛŒÙ… background Ø¨Ù‚ÛŒÙ‡ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) ordersTab.style.background = "#f5f5f5";

    var balanceTab = document.getElementById("tabCustomerBalanceReport");
    if (balanceTab) balanceTab.style.background = "#f5f5f5";

    var customersTab = document.getElementById("tabCustomersReport");
    if (customersTab) customersTab.style.background = "#f5f5f5";

  };

  document.getElementById("tabCustomerBalanceReport").onclick = function() {
    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ø³ÙØ§Ø±Ø´Ø§ØªØŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ Ùˆ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var ordersSection = document.getElementById("ordersReportSection");
    if (ordersSection) ordersSection.style.display = "none";

    var paymentsSection = document.getElementById("cashPaymentsReportSection");
    if (paymentsSection) paymentsSection.style.display = "none";

    var paymentsContainer = document.getElementById("cashPaymentsReportContainer");
    if (paymentsContainer) paymentsContainer.style.display = "none";

    var customersSection = document.getElementById("customersReportContainer");
    if (customersSection) customersSection.style.display = "none";

    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var customerBalanceSection = document.getElementById("customerBalanceReportContainer");
    if (customerBalanceSection) customerBalanceSection.style.display = "block";

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ Ùˆ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
    var productSummarySection = document.querySelector('.section:has(.product-summary-table)');
    if (productSummarySection) productSummarySection.style.display = "none";

    var ordersTableContainer = document.getElementById("ordersTableContainer");
    if (ordersTableContainer) ordersTableContainer.style.display = "none";

    // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØªØ¨â€ŒÙ‡Ø§
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) {
      ordersTab.style.background = "#f5f5f5";
      ordersTab.style.opacity = "1";
      ordersTab.style.border = "none";
    }

    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) {
      paymentsTab.style.background = "#f5f5f5";
      paymentsTab.style.opacity = "1";
      paymentsTab.style.border = "none";
    }

    var balanceTab = document.getElementById("tabCustomerBalanceReport");
    if (balanceTab) {
      balanceTab.style.background = "#e65100";
      balanceTab.style.border = "2px solid #d32f2f";
      balanceTab.style.borderRadius = "4px";
      balanceTab.style.opacity = "1";
    }

    // ØªÙ†Ø¸ÛŒÙ… background Ø¨Ù‚ÛŒÙ‡ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) ordersTab.style.background = "#f5f5f5";

    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) paymentsTab.style.background = "#f5f5f5";

    var customersTab = document.getElementById("tabCustomersReport");
    if (customersTab) customersTab.style.background = "#f5f5f5";

  };

  document.getElementById("tabCustomersReport").onclick = function() {
    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ø³ÙØ§Ø±Ø´Ø§ØªØŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ Ùˆ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var ordersSection = document.getElementById("ordersReportSection");
    if (ordersSection) ordersSection.style.display = "none";

    var paymentsSection = document.getElementById("cashPaymentsReportSection");
    if (paymentsSection) paymentsSection.style.display = "none";

    var paymentsContainer = document.getElementById("cashPaymentsReportContainer");
    if (paymentsContainer) paymentsContainer.style.display = "none";

    var customerBalanceSection = document.getElementById("customerBalanceReportContainer");
    if (customerBalanceSection) customerBalanceSection.style.display = "none";

    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
    var customersSection = document.getElementById("customersReportContainer");
    if (customersSection) customersSection.style.display = "block";

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ Ùˆ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
    var productSummarySection = document.querySelector('.section:has(.product-summary-table)');
    if (productSummarySection) productSummarySection.style.display = "none";

    var ordersTableContainer = document.getElementById("ordersTableContainer");
    if (ordersTableContainer) ordersTableContainer.style.display = "none";

    // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØªØ¨â€ŒÙ‡Ø§
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) {
      ordersTab.style.background = "#e3f2fd";
      ordersTab.style.opacity = "1";
      ordersTab.style.border = "none";
    }

    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) {
      paymentsTab.style.background = "#f5f5f5";
      paymentsTab.style.opacity = "1";
      paymentsTab.style.border = "none";
    }

    var balanceTab = document.getElementById("tabCustomerBalanceReport");
    if (balanceTab) {
      balanceTab.style.background = "#f5f5f5";
      balanceTab.style.opacity = "1";
      balanceTab.style.border = "none";
    }

    var customersTab = document.getElementById("tabCustomersReport");
    if (customersTab) {
      customersTab.style.background = "#7b1fa2";
      customersTab.style.border = "2px solid #d32f2f";
      customersTab.style.borderRadius = "4px";
      customersTab.style.opacity = "1";
    }

    // ØªÙ†Ø¸ÛŒÙ… background Ø¨Ù‚ÛŒÙ‡ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
    var ordersTab = document.getElementById("tabOrdersReport");
    if (ordersTab) ordersTab.style.background = "#f5f5f5";

    var paymentsTab = document.getElementById("tabCashPaymentsReport");
    if (paymentsTab) paymentsTab.style.background = "#f5f5f5";

    var balanceTab = document.getElementById("tabCustomerBalanceReport");
    if (balanceTab) balanceTab.style.background = "#f5f5f5";

  };

  // ØªØ¹Ø±ÛŒÙ Ù‡Ù…Ù‡ Ù…ØªØºÛŒØ±Ù‡Ø§ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ú©Ø¯ - ØªØ±ØªÛŒØ¨ÛŒ Ù…Ù‡Ù… Ø§Ø³Øª
  const globalRepFrom      = document.getElementById("globalRepFrom");
  const globalRepTo        = document.getElementById("globalRepTo");
  const repTo              = globalRepFrom; // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ
  const repUserSelect      = document.getElementById("repUser");
  const repCustomerInput   = document.getElementById("repCustomer");
  const repProductSelect   = document.getElementById("repProduct");
  const repProductSubFilters = document.getElementById("repProductSubFilters");
  const productSummaryBody = document.getElementById("productSummaryBody");
  const productOrdersSection = document.getElementById("productOrdersSection");
  const productOrdersBody = document.getElementById("productOrdersBody");
  const reportTableTitle   = document.getElementById("reportTableTitle");
  const btnRunReport       = document.getElementById("btnRunReport");
  const btnPrintOrdersReport = document.getElementById("btnPrintOrdersReport");
  const btnPrintCashReport = document.getElementById("btnPrintCashReport");

  // Ø¹Ù†Ø§ØµØ± Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  const tabOrdersReport = document.getElementById("tabOrdersReport");
  const ordersReportSection = document.getElementById("ordersReportSection");

  // Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
  const tabCashPaymentsReport = document.getElementById("tabCashPaymentsReport");
  const cashPaymentsReportSection = document.getElementById("cashPaymentsReportSection");
  const cashPaymentsReportContainer = document.getElementById("cashPaymentsReportContainer");
  const cashRepFrom = globalRepFrom; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const cashRepTo = globalRepTo; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const cashRepUser = document.getElementById("cashRepUser");
  const cashRepMethod = document.getElementById("cashRepMethod");
  const cashRepType = document.getElementById("cashRepType");
  const btnRunCashReport = document.getElementById("btnRunCashReport");
  const cashPaymentsReportBody = document.getElementById("cashPaymentsReportBody");

  // Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
  const tabCustomerBalanceReport = document.getElementById("tabCustomerBalanceReport");
  const customerBalanceReportContainer = document.getElementById("customerBalanceReportContainer");
  const balanceRepFrom = globalRepFrom; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const balanceRepTo = globalRepTo; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const btnRunCustomerBalanceReport = document.getElementById("btnRunCustomerBalanceReport");
  const btnPrintCustomerBalanceReport = document.getElementById("btnPrintCustomerBalanceReport");
  const customerBalanceReportBody = document.getElementById("customerBalanceReportBody");
  const customersWithBalanceCount = document.getElementById("customersWithBalanceCount");
  const totalCustomerBalance = document.getElementById("totalCustomerBalance");

  // Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
  const tabCustomersReport = document.getElementById("tabCustomersReport");
  const customersReportContainer = document.getElementById("customersReportContainer");
  const customersRepFrom = globalRepFrom; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const customersRepTo = globalRepTo; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±Ú©
  const customersRepSearch = document.getElementById("customersRepSearch");
  const btnRunCustomersReport = document.getElementById("btnRunCustomersReport");
  const btnPrintCustomersReport = document.getElementById("btnPrintCustomersReport");
  const customersReportBody   = document.getElementById("customersReportBody");
  const totalCustomersCount   = document.getElementById("totalCustomersCount");
  const totalCustomersOrders  = document.getElementById("totalCustomersOrders");
  const totalCustomersSales   = document.getElementById("totalCustomersSales");

  // Ø¹Ù†Ø§ØµØ± ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†
  const customerAccountsBody  = document.getElementById("customerAccountsBody");
  const custAccSearchInput    = document.getElementById("custAccSearch");
  const custAccOnlyDebtorsChk = document.getElementById("custAccOnlyDebtors");
  const custAccFromDateInput  = document.getElementById("custAccFromDate");
  const custAccToDateInput    = document.getElementById("custAccToDate");
  const custAccSummarySales   = document.getElementById("custAccSummarySales");
  const custAccSummaryPaid    = document.getElementById("custAccSummaryPaid");
  const custAccSummaryBalance = document.getElementById("custAccSummaryBalance");

  // ØªÙˆØ¬Ù‡: savedOrdersBody Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø§ØªØ± Ø¯Ø± Ú©Ø¯ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ùˆ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…

  let lastFilteredOrders = [];

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
  if (btnRunCashReport) {
    btnRunCashReport.addEventListener("click", generateCashPaymentsReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
  if (btnRunCustomerBalanceReport) {
    btnRunCustomerBalanceReport.addEventListener("click", generateCustomerBalanceReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
  if (btnPrintCustomerBalanceReport) {
    btnPrintCustomerBalanceReport.addEventListener("click", printCustomerBalanceReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
  if (btnRunCustomersReport) {
    btnRunCustomersReport.addEventListener("click", generateCustomersReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  if (btnPrintOrdersReport) {
    btnPrintOrdersReport.addEventListener("click", printOrdersReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
  if (btnPrintCashReport) {
    btnPrintCashReport.addEventListener("click", printCashPaymentsReport);
  }

  // event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
  if (btnPrintCustomersReport) {
    btnPrintCustomersReport.addEventListener("click", printCustomersReport);
  }

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  const allOrders = loadAllOrders();
  fillUserFilterOptions(allOrders);

  btnRunReport.addEventListener("click", runReport);

  repProductSelect.addEventListener("change", () => {
    buildSubFilterUI();
    // ÙˆÙ‚ØªÛŒ Ù…Ø­ØµÙˆÙ„ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ú¯Ø²Ø§Ø±Ø´ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†
    runReport();
  });

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ - Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§ ÙˆØ§Ø¶Ø­ Ø¨Ø§Ø´Ù†Ø¯
  initializeTabStyles();

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ - Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  document.getElementById("tabOrdersReport").click();

  function initializeTabStyles() {
    // ØªÙ†Ø¸ÛŒÙ… Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
    var allTabs = ["tabOrdersReport", "tabCashPaymentsReport", "tabCustomerBalanceReport", "tabCustomersReport"];
    allTabs.forEach(tabId => {
      var tab = document.getElementById(tabId);
      if (tab) {
        tab.style.opacity = "1";
        tab.style.border = "none";
        tab.style.background = "#f5f5f5";
      }
    });
  }


  // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø±Ø´ØªÙ‡â€ŒØ§ÛŒ (Ù…Ø«Ù„ 1403/08/10) Ø¨Ù‡ Ø¹Ø¯Ø¯ yyyymmdd Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡
  function jalaliStringToNumber(str) {
    if (!str) return 0;
    const s = normalizeDigits(str);
    const m = s.match(/(\d{3,4})[\/\-](\d{1,2})[\/\-](\d{1,2})/);
    if (!m) return 0;
    let y  = parseInt(m[1], 10);
    let mo = parseInt(m[2], 10);
    let d  = parseInt(m[3], 10);
    if (isNaN(y) || isNaN(mo) || isNaN(d)) return 0;
    return y * 10000 + mo * 100 + d;
  }

  // ØªØ§Ø±ÛŒØ® Ø³ÙØ§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø±Ø§ (dateTime) Ø¨Ù‡ Ø¹Ø¯Ø¯ yyyymmdd ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
  function orderDateToNumber(order) {
    const dt = order.dateTime || "";
    if (!dt) return 0;
    const firstPart = normalizeDigits(String(dt)).split(/[,\s]/)[0]; // Ù…Ø«Ù„ "1403/08/10"
    return jalaliStringToNumber(firstPart);
  }

  // Ø®ÙˆØ§Ù†Ø¯Ù† Ù‡Ù…Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø§Ø² localStorage
  function loadAllOrders() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  }
  
  // Ù†Ù‚Ø´Ù‡ Ø¨Ø³ØªÙ† Ø±ÙˆØ²Ù‡Ø§ (Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²) Ø§Ø² localStorage

  // Ù†Ù‚Ø´Ù‡ Ø¨Ø³ØªÙ† Ø±ÙˆØ²Ù‡Ø§ (Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²) Ø§Ø² localStorage

  function loadDailyCloseMap() {
    return JSON.parse(localStorage.getItem(DAILY_CLOSE_KEY) || "{}");
  }

  function sumWasteInRange(dailyMap, fromNum, toNum) {
    let sum = 0;
    Object.keys(dailyMap).forEach(k => {
      const d = parseInt(k, 10);
      if (fromNum && d < fromNum) return;
      if (toNum   && d > toNum)   return;
      const rec = dailyMap[k] || {};
      sum += rec.waste || 0;
    });
    return sum;
  }

  function sumDiscInRange(dailyMap, fromNum, toNum) {
    let sum = 0;
    Object.keys(dailyMap).forEach(k => {
      const d = parseInt(k, 10);
      if (fromNum && d < fromNum) return;
      if (toNum   && d > toNum)   return;
      const rec = dailyMap[k] || {};
      sum += rec.diff || 0;
    });
    return sum;
  }

  function todayNumber() {
    const todayFa = (new Date()).toLocaleDateString("fa-IR");
    return jalaliStringToNumber(todayFa);
  }

  function startOfWeekNumber() {
    const today   = new Date();
    const day     = today.getDay(); // 0 = ÛŒÚ©Ø´Ù†Ø¨Ù‡ØŒ 6 = Ø´Ù†Ø¨Ù‡
    const diff    = (day === 6 ? 0 : day + 1); // Ø´Ø±ÙˆØ¹ Ù‡ÙØªÙ‡: Ø´Ù†Ø¨Ù‡
    const first   = new Date(today);
    first.setDate(today.getDate() - diff);
    const fa      = first.toLocaleDateString("fa-IR");
    return jalaliStringToNumber(fa);
  }

  function startOfMonthNumber() {
    const parts = (new Date()).toLocaleDateString("fa-IR").split("/");
    const y = parts[0], m = parts[1];
    return jalaliStringToNumber(`${y}/${m}/01`);
  }

  // Ø®Ù„Ø§ØµÙ‡ Ø§Ù…Ø±ÙˆØ² / Ù‡ÙØªÙ‡ / Ù…Ø§Ù‡ (Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ + Ù¾Ø±ØªÛŒ Ùˆ Ù…ØºØ§ÛŒØ±Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø¨Ø³ØªÙ† Ø±ÙˆØ²)
  function updateQuickSummary(allOrders) {
    const dailyMap   = loadDailyCloseMap();
    const todayNum   = todayNumber();
    const weekStart  = startOfWeekNumber();
    const monthStart = startOfMonthNumber();

    const todayTotals  = { total:0, paid:0, bal:0 };
    const weekTotals   = { total:0, paid:0, bal:0 };
    const monthTotals  = { total:0, paid:0, bal:0 };

    allOrders.forEach(o => {
      const dNum = orderDateToNumber(o);
      if (!dNum) return;

      if (dNum === todayNum) {
        todayTotals.total += (o.total   || 0);
        todayTotals.paid  += (o.paid    || 0);
        todayTotals.bal   += (o.balance || 0);
      }
      if (dNum >= weekStart && dNum <= todayNum) {
        weekTotals.total  += (o.total   || 0);
        weekTotals.paid   += (o.paid    || 0);
        weekTotals.bal    += (o.balance || 0);
      }
      if (dNum >= monthStart && dNum <= todayNum) {
        monthTotals.total += (o.total   || 0);
        monthTotals.paid  += (o.paid    || 0);
        monthTotals.bal   += (o.balance || 0);
      }
    });

    const wasteToday = sumWasteInRange(dailyMap, todayNum,  todayNum);
    const wasteWeek  = sumWasteInRange(dailyMap, weekStart, todayNum);
    const wasteMonth = sumWasteInRange(dailyMap, monthStart,todayNum);

    const discToday  = sumDiscInRange(dailyMap, todayNum,  todayNum);
    const discWeek   = sumDiscInRange(dailyMap, weekStart, todayNum);
    const discMonth  = sumDiscInRange(dailyMap, monthStart,todayNum);

    // Ø§Ù…Ø±ÙˆØ²
    const elTodayTotal   = document.getElementById("sumTodayTotal");
    const elTodayPaid    = document.getElementById("sumTodayPaid");
    const elTodayBal     = document.getElementById("sumTodayBalance");
    const elTodayWaste   = document.getElementById("sumTodayWaste");
    const elTodayDisc    = document.getElementById("sumTodayDisc");

    if (elTodayTotal)  elTodayTotal.textContent  = formatMoney(todayTotals.total);
    if (elTodayPaid)   elTodayPaid.textContent   = formatMoney(todayTotals.paid);
    if (elTodayBal)    elTodayBal.textContent    = formatMoney(todayTotals.bal);
    if (elTodayWaste)  elTodayWaste.textContent  = formatMoney(wasteToday);
    if (elTodayDisc)   elTodayDisc.textContent   = formatMoney(discToday);

    // Ù‡ÙØªÙ‡
    const elWeekTotal  = document.getElementById("sumWeekTotal");
    const elWeekPaid   = document.getElementById("sumWeekPaid");
    const elWeekBal    = document.getElementById("sumWeekBalance");
    const elWeekWaste  = document.getElementById("sumWeekWaste");
    const elWeekDisc   = document.getElementById("sumWeekDisc");

    if (elWeekTotal) elWeekTotal.textContent = formatMoney(weekTotals.total);
    if (elWeekPaid)  elWeekPaid.textContent  = formatMoney(weekTotals.paid);
    if (elWeekBal)   elWeekBal.textContent   = formatMoney(weekTotals.bal);
    if (elWeekWaste) elWeekWaste.textContent = formatMoney(wasteWeek);
    if (elWeekDisc)  elWeekDisc.textContent  = formatMoney(discWeek);

    // Ù…Ø§Ù‡
    const elMonthTotal = document.getElementById("sumMonthTotal");
    const elMonthPaid  = document.getElementById("sumMonthPaid");
    const elMonthBal   = document.getElementById("sumMonthBalance");
    const elMonthWaste = document.getElementById("sumMonthWaste");
    const elMonthDisc  = document.getElementById("sumMonthDisc");

    if (elMonthTotal) elMonthTotal.textContent = formatMoney(monthTotals.total);
    if (elMonthPaid)  elMonthPaid.textContent  = formatMoney(monthTotals.paid);
    if (elMonthBal)   elMonthBal.textContent   = formatMoney(monthTotals.bal);
    if (elMonthWaste) elMonthWaste.textContent = formatMoney(wasteMonth);
    if (elMonthDisc)  elMonthDisc.textContent  = formatMoney(discMonth);
  }

  function onEnterReportsPage() {
    const allOrders = loadAllOrders();
    loadCashPaymentsToReport();
    updateOpenOrdersButtonState();
    updateQuickSummary(allOrders);
  }


  // Ù¾Ø±Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± ÙÛŒÙ„ØªØ±
  function fillUserFilterOptions(allOrders) {
    const users = new Set();
    allOrders.forEach(o => {
      if (o.user) users.add(o.user);
    });

    const current = repUserSelect.value;
    repUserSelect.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>';
    Array.from(users).forEach(u => {
      const opt = document.createElement("option");
      opt.value = u;
      opt.textContent = u;
      repUserSelect.appendChild(opt);
    });
    if (Array.from(users).includes(current)) {
      repUserSelect.value = current;
    }
  }

  // ÙÛŒÙ„ØªØ± Ø§ØµÙ„ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®ØŒ Ú©Ø§Ø±Ø¨Ø±ØŒ Ù…Ø´ØªØ±ÛŒ
  function filterOrdersByMainFilters(allOrders) {
    const fromStr = globalRepFrom.value.trim();
    const toStr   = globalRepTo.value.trim();
    const userVal = repUserSelect.value;
    const custVal = repCustomerInput.value.trim();

    const fromNum = jalaliStringToNumber(fromStr);
    const toNum   = jalaliStringToNumber(toStr);

    return allOrders.filter(o => {
      const dNum = orderDateToNumber(o);

      // ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®
      if (fromNum && dNum && dNum < fromNum) return false;
      if (toNum   && dNum && dNum > toNum)   return false;

      // Ú©Ø§Ø±Ø¨Ø±
      if (userVal && o.user !== userVal) return false;

      // Ù…Ø´ØªØ±ÛŒ
      if (custVal && !(o.customerName || "").includes(custVal)) return false;

      return true;
    });
  }

  // Ø³Ø§Ø®Øª UI Ø²ÛŒØ±Ø´Ø§Ø®Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
  function buildSubFilterUI() {
    const val = repProductSelect.value;
    let html = "";

    if (!val) {
      repProductSubFilters.innerHTML = "";
      return;
    }

    if (val === "copy" || val === "print") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterBwSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú†Ø§Ù¾:</label>
            <select id="filterBwPrintType">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="ÛŒÚ©â€ŒØ±Ùˆ">ÛŒÚ©â€ŒØ±Ùˆ</option>
              <option value="Ø¯ÙˆØ±Ùˆ">Ø¯ÙˆØ±Ùˆ</option>
            </select>
          </div>
        </div>`;
    } else if (val === "color") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterColorSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú†Ø§Ù¾:</label>
            <select id="filterColorPrint">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="ÛŒÚ©â€ŒØ±Ùˆ">ÛŒÚ©â€ŒØ±Ùˆ</option>
              <option value="Ø¯ÙˆØ±Ùˆ">Ø¯ÙˆØ±Ùˆ</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú©Ø§ØºØ°:</label>
            <select id="filterColorPaper">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="ØªØ­Ø±ÛŒØ±">ØªØ­Ø±ÛŒØ±</option>
              <option value="Ú¯Ù„Ø§Ø³Ù‡">Ú¯Ù„Ø§Ø³Ù‡</option>
              <option value="Ø´ÙˆÙ…ÛŒØ²">Ø´ÙˆÙ…ÛŒØ²</option>
            </select>
          </div>
          <div class="field">
            <label>Ú¯Ø±Ù…Ø§Ú˜:</label>
            <select id="filterColorWeight">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="80">Û¸Û°</option>
              <option value="135">Û±Û³Ûµ</option>
              <option value="200">Û²Û°Û°</option>
              <option value="250">Û²ÛµÛ°</option>
            </select>
          </div>
        </div>`;
    } else if (val === "binding") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú©Ø§Ø±:</label>
            <select id="filterBindJobType">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ø¬Ø²ÙˆÙ‡">Ø¬Ø²ÙˆÙ‡</option>
              <option value="Ú©ØªØ§Ø¨">Ú©ØªØ§Ø¨</option>
            </select>
          </div>
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterBindSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ø³Ø§ÛŒØ² ÙÙ†Ø±:</label>
            <select id="filterBindSpiral">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="18">ØªØ§ ÙÙ†Ø± Û±Û¸</option>
              <option value="20_30">ÙÙ†Ø± Û²Û° ØªØ§ Û³Û°</option>
              <option value="35_40">ÙÙ†Ø± Û³Ûµ ØªØ§ Û´Û°</option>
              <option value="40p">Ø¨ÛŒØ´ Ø§Ø² Û´Û°</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø·Ù„Ù‚:</label>
            <select id="filterBindCover">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚">Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚</option>
              <option value="Ø´ÙØ§Ù">Ø´ÙØ§Ù</option>
              <option value="Ø¶Ø®ÛŒÙ…">Ø¶Ø®ÛŒÙ…</option>
            </select>
          </div>
        </div>`;
    } else if (val === "staple") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>---</label>
            <span>Ø¨Ø±Ø§ÛŒ Ù…Ù†Ú¯Ù†Ù‡ ÙÙ‚Ø· ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù…Ø¨Ù„Øº Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</span>
          </div>
        </div>`;
    } else if (val === "lamination") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ² Ù¾Ø±Ø³:</label>
            <select id="filterLamSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ú©Ø§Ø±ØªÛŒ">Ú©Ø§Ø±ØªÛŒ</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
        </div>`;
    } else if (val === "removed") {
      // Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ù‡ÛŒÚ† Ø²ÛŒØ±ÙÛŒÙ„ØªØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯
      html = "";
    }

    repProductSubFilters.innerHTML = html;

    // Ù‡Ø± ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± Ø²ÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ â†’ Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„
    repProductSubFilters.querySelectorAll("select").forEach(sel => {
      sel.addEventListener("change", () => {
        rebuildProductSummary(lastFilteredOrders);
      });
    });
  }

  // ÙØ§Ù†Ú©Ø´Ù† Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§
  function buildSubFilterFn(productFilter) {
    const val = productFilter;
    if (!val) {
      return function(item) { return true; };
    }

    if (val === "copy" || val === "print") {
      const sizeSel  = document.getElementById("filterBwSize");
      const printSel = document.getElementById("filterBwPrintType");
      const sizeVal  = sizeSel  ? sizeSel.value  : "";
      const printVal = printSel ? printSel.value : "";

      return function(item) {
        if (val === "copy") {
          if (item.type !== "Ú©Ù¾ÛŒ" || item.colorMode !== "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") return false;
        } else {
          if (item.type !== "Ù¾Ø±ÛŒÙ†Øª" || item.colorMode !== "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") return false;
        }
        if (sizeVal  && item.paperSize !== sizeVal) return false;
        if (printVal && item.printType !== printVal) return false;
        return true;
      };
    }

    if (val === "color") {
      const sizeSel    = document.getElementById("filterColorSize");
      const printSel   = document.getElementById("filterColorPrint");
      const paperSel   = document.getElementById("filterColorPaper");
      const weightSel  = document.getElementById("filterColorWeight");

      const sizeVal    = sizeSel   ? sizeSel.value   : "";
      const printVal   = printSel  ? printSel.value  : "";
      const paperVal   = paperSel  ? paperSel.value  : "";
      const weightVal  = weightSel ? weightSel.value : "";

      return function(item) {
        if (item.colorMode !== "Ø±Ù†Ú¯ÛŒ") return false;
        if (sizeVal   && item.paperSize !== sizeVal) return false;
        if (printVal  && item.printType !== printVal) return false;
        if (paperVal  && (item.paperType || "") !== paperVal) return false;
        if (weightVal && String(item.paperWeight || "") !== weightVal) return false;
        return true;
      };
    }

    if (val === "binding") {
      const sizeSel   = document.getElementById("filterBindSize");
      const spiralSel = document.getElementById("filterBindSpiral");
      const coverSel  = document.getElementById("filterBindCover");
      const jobSel    = document.getElementById("filterBindJobType");

      const sizeVal   = sizeSel   ? sizeSel.value   : "";
      const spiralVal = spiralSel ? spiralSel.value : "";
      const coverVal  = coverSel  ? coverSel.value  : "";
      const jobVal    = jobSel    ? jobSel.value    : "";

      return function(item) {
        if (item.type !== "ÙÙ†Ø±ÛŒ") return false;
        if (sizeVal   && item.paperSize         !== sizeVal)   return false;
        if (spiralVal && item.bindingSpiralSize !== spiralVal) return false;
        if (coverVal  && item.bindingCover      !== coverVal)  return false;
        if (jobVal    && item.bindingJobType    !== jobVal)    return false;
        return true;
      };
    }

    if (val === "staple") {
      return function(item) {
        return item.type === "Ù…Ù†Ú¯Ù†Ù‡";
      };
    }

    if (val === "lamination") {
      const sizeSel = document.getElementById("filterLamSize");
      const sizeVal = sizeSel ? sizeSel.value : "";
      return function(item) {
        if (item.type !== "Ù¾Ø±Ø³") return false;
        if (sizeVal && item.paperSize !== sizeVal) return false;
        return true;
      };
    }

    return function(item) { return true; };
  }

  function labelSpiralSize(code) {
    if (code === "18")    return "ØªØ§ ÙÙ†Ø± Û±Û¸";
    if (code === "20_30") return "ÙÙ†Ø± Û²Û° ØªØ§ Û³Û°";
    if (code === "35_40") return "ÙÙ†Ø± Û³Ûµ ØªØ§ Û´Û°";
    if (code === "40p")   return "Ø¨ÛŒØ´ Ø§Ø² Û´Û°";
    return code || "";
  }

  // Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§
  function rebuildOrdersTable(filteredOrders) {
    // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
    const table = savedOrdersBody.closest('table');
    const thead = table.querySelector('thead tr');
    thead.innerHTML = `
      <th>#</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
      <th>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´</th>
      <th>Ù…Ø´ØªØ±ÛŒ</th>
      <th>Ú©Ø§Ø±Ø¨Ø±</th>
      <th>ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙ</th>
      <th>Ø¬Ù…Ø¹ Ú©Ù„</th>
      <th>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
      <th>Ù…Ø§Ù†Ø¯Ù‡</th>
    `;

    savedOrdersBody.innerHTML = "";
    filteredOrders.forEach((o, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${o.dateTime || ""}</td>
        <td>${o.orderNo   || ""}</td>
        <td>${o.customerName || ""}</td>
        <td>${o.user      || ""}</td>
        <td>${(o.items || []).length}</td>
        <td>${formatMoney(o.total   || 0)}</td>
        <td>${formatMoney(o.paid    || 0)}</td>
        <td>${formatMoney(o.balance || 0)}</td>
      `;
      savedOrdersBody.appendChild(tr);
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„
    if (filteredOrders.length > 0) {
      const totalRow = document.createElement("tr");
      totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

      const totalOrders = filteredOrders.length;
      const totalAmount = filteredOrders.reduce((sum, o) => sum + (o.total || 0), 0);
      const totalPaid = filteredOrders.reduce((sum, o) => sum + (o.paid || 0), 0);
      const totalBalance = totalAmount - totalPaid;
      const totalItems = filteredOrders.reduce((sum, o) => sum + (o.items ? o.items.length : 0), 0);

      totalRow.innerHTML = `
        <td colspan="5" style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${totalOrders} Ø³ÙØ§Ø±Ø´)</td>
        <td style="padding: 10px; color: #2e7d32;">${totalItems}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalAmount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalPaid)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalBalance)}</td>
      `;
      savedOrdersBody.appendChild(totalRow);
    }
  }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„
  function getUnitsForProductGroup(productKey, item) {
    // Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯ Ùˆ Ø±Ù†Ú¯ÛŒ â†’ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯
    if (productKey === "copy" || productKey === "print" || productKey === "color") {
      return parseIntSafe(item.totalSheets || "0");
    }
    // ÙÙ†Ø±ÛŒ / Ù…Ù†Ú¯Ù†Ù‡ / Ù¾Ø±Ø³ â†’ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡ / Ú©Ø§Ø±
    return parseIntSafe(item.setCount || "0");
  }

  // Ø³Ø§Ø®Øª Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
  function buildOverallProductSummary(filteredOrders) {
    const productTypes = ["copy", "print", "color", "binding", "staple", "lamination"];
    const groups = new Map();

    filteredOrders.forEach(o => {
      (o.items || []).forEach(item => {
        const productKey = item.product || "copy";
        if (!productTypes.includes(productKey)) return;

        let key = "";
        let title = "";
        let units = getUnitsForProductGroup(productKey, item);

        // ØªØ¹ÛŒÛŒÙ† Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„
        switch (productKey) {
          case "copy": title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
          case "print": title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
          case "color": title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ"; break;
          case "binding": title = "ÙÙ†Ø±ÛŒ"; break;
          case "staple": title = "Ù…Ù†Ú¯Ù†Ù‡"; break;
          case "lamination": title = "Ù¾Ø±Ø³"; break;
        }

        if (!groups.has(title)) {
          groups.set(title, {
            rowsCount: 0,
            totalUnits: 0,
            totalAmount: 0
          });
        }

        const g = groups.get(title);
        g.rowsCount += 1;
        g.totalUnits += (units || 0);
        g.totalAmount += (item.rowTotal || 0);
      });
    });

    if (groups.size === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666; padding: 20px;">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      productSummaryBody.appendChild(tr);
    } else {
      groups.forEach(g => {
        const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${g.title}</td>
          <td>${formatMoney(g.rowsCount)}</td>
          <td>${formatMoney(g.totalUnits)}</td>
          <td>${formatMoney(g.totalAmount)}</td>
          <td>${formatMoney(avgUnit)}</td>
        `;
        productSummaryBody.appendChild(tr);
      });
    }
  }

  // Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡
  function rebuildProductSummary(filteredOrders) {
    productSummaryBody.innerHTML = "";
    const productFilter = repProductSelect.value;

    // Ø§Ú¯Ø± Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ØŒ Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    if (!productFilter) {
      buildOverallProductSummary(filteredOrders);
      return;
    }

    const subFilterFn = buildSubFilterFn(productFilter);
    const groups = new Map();

    filteredOrders.forEach(o => {
      (o.items || []).forEach(item => {
        if (!subFilterFn(item)) return;

        let key = "";
        let title = "";
        let units = getUnitsForProductGroup(productFilter, item);

        if (productFilter === "copy") {
          const size  = item.paperSize || "";
          const print = item.printType || "";
          key   = "COPY|" + size + "|" + print;
          title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
            (size  ? " - " + size  : "") +
            (print ? " - " + print : "");
        } else if (productFilter === "print") {
          const size  = item.paperSize || "";
          const print = item.printType || "";
          key   = "PRINT|" + size + "|" + print;
          title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
            (size  ? " - " + size  : "") +
            (print ? " - " + print : "");
        } else if (productFilter === "color") {
          const size   = item.paperSize || "";
          const print  = item.printType || "";
          const pType  = item.paperType || "";
          const weight = item.paperWeight || "";
          key   = "COLOR|" + size + "|" + print + "|" + pType + "|" + weight;
          title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ" +
            (size   ? " - " + size   : "") +
            (print  ? " - " + print  : "") +
            (pType  ? " - " + pType  : "") +
            (weight ? " - Ú¯Ø±Ù…Ø§Ú˜ " + weight : "");
        } else if (productFilter === "binding") {
          const job    = item.bindingJobType    || "";
          const size   = item.paperSize || "";
          const spiral = item.bindingSpiralSize || "";
          const cover  = item.bindingCover      || "";
          key   = "BIND|" + job + "|" + size + "|" + spiral + "|" + cover;
          title = "ÙÙ†Ø±ÛŒ" +
            (job    ? " - " + job    : "") +
            (size   ? " - " + size   : "") +
            (spiral ? " - " + labelSpiralSize(spiral) : "") +
            (cover  ? " - " + cover  : "");
        } else if (productFilter === "staple") {
          key   = "STAPLE";
          title = "Ù…Ù†Ú¯Ù†Ù‡ (Ù‡Ù…Ù‡)";
        } else if (productFilter === "lamination") {
          const size = item.paperSize || "";
          key   = "LAM|" + size;
          title = "Ù¾Ø±Ø³" + (size ? " - " + size : "");
        }

        if (!groups.has(key)) {
          groups.set(key, {
            title,
            rowsCount:   0,
            totalUnits:  0,
            totalAmount: 0
          });
        }

        const g = groups.get(key);
        g.rowsCount   += 1;
        g.totalUnits  += (units || 0);
        g.totalAmount += (item.rowTotal || 0);
      });
    });

    groups.forEach(g => {
      const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${g.title}</td>
        <td>${formatMoney(g.rowsCount)}</td>
        <td>${formatMoney(g.totalUnits)}</td>
        <td>${formatMoney(g.totalAmount)}</td>
        <td>${formatMoney(avgUnit)}</td>
      `;
      productSummaryBody.appendChild(tr);
    });
  }


  // Ø³Ø§Ø®Øª UI Ø²ÛŒØ±Ø´Ø§Ø®Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
  function buildSubFilterUI() {
    const val = repProductSelect.value;
    let html = "";

    if (!val) {
      repProductSubFilters.innerHTML = "";
      return;
    }

    if (val === "copy" || val === "print") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterBwSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú†Ø§Ù¾:</label>
            <select id="filterBwPrintType">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="ÛŒÚ©â€ŒØ±Ùˆ">ÛŒÚ©â€ŒØ±Ùˆ</option>
              <option value="Ø¯ÙˆØ±Ùˆ">Ø¯ÙˆØ±Ùˆ</option>
            </select>
          </div>
        </div>`;
    } else if (val === "color") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterColorSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú†Ø§Ù¾:</label>
            <select id="filterColorPrint">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="ÛŒÚ©â€ŒØ±Ùˆ">ÛŒÚ©â€ŒØ±Ùˆ</option>
              <option value="Ø¯ÙˆØ±Ùˆ">Ø¯ÙˆØ±Ùˆ</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú©Ø§ØºØ°:</label>
            <select id="filterColorPaper">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ù…Ø¹Ù…ÙˆÙ„ÛŒ">Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
              <option value="Ú¯Ù„Ø§Ø³Ù‡">Ú¯Ù„Ø§Ø³Ù‡</option>
              <option value="Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ú¯Ù„Ø§Ø³Ù‡">Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ú¯Ù„Ø§Ø³Ù‡</option>
            </select>
          </div>
          <div class="field">
            <label>Ú¯Ø±Ù…Ø§Ú˜:</label>
            <select id="filterColorWeight">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="80">80</option>
              <option value="135">135</option>
              <option value="200">200</option>
              <option value="250">250</option>
            </select>
          </div>
        </div>`;
    } else if (val === "binding") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ú©Ø§Ø±:</label>
            <select id="filterBindingJob">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ø¬Ø²ÙˆÙ‡">Ø¬Ø²ÙˆÙ‡</option>
              <option value="Ú©ØªØ§Ø¨">Ú©ØªØ§Ø¨</option>
            </select>
          </div>
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterBindingSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ ÙÙ†Ø±:</label>
            <select id="filterBindingSpiral">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="18">ØªØ§ ÙÙ†Ø± Û±Û¸</option>
              <option value="20_30">ÙÙ†Ø± Û²Û° ØªØ§ Û³Û°</option>
              <option value="35_40">ÙÙ†Ø± Û³Ûµ ØªØ§ Û´Û°</option>
              <option value="40p">Ø¨ÛŒØ´ Ø§Ø² Û´Û°</option>
            </select>
          </div>
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø·Ù„Ù‚:</label>
            <select id="filterBindingCover">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="Ø´ÙØ§Ù">Ø´ÙØ§Ù</option>
              <option value="Ø¶Ø®ÛŒÙ…">Ø¶Ø®ÛŒÙ…</option>
              <option value="Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚">Ø¨Ø¯ÙˆÙ† Ø·Ù„Ù‚</option>
            </select>
          </div>
        </div>`;
    } else if (val === "lamination") {
      html = `
        <div class="row" style="gap:6px;">
          <div class="field">
            <label>Ø³Ø§ÛŒØ²:</label>
            <select id="filterLaminationSize">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="A5">A5</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
            </select>
          </div>
        </div>`;
    }
    // Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ù‡ÛŒÚ† Ø²ÛŒØ±ÙÛŒÙ„ØªØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯

    repProductSubFilters.innerHTML = html;

    // Ù‡Ø± ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± Ø²ÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ â†’ Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„
    repProductSubFilters.querySelectorAll("select").forEach(sel => {
      sel.addEventListener("change", () => {
        rebuildProductSummary(lastFilteredOrders);
      });
    });
  }

  // ÙØ§Ù†Ú©Ø´Ù† Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§
  function buildSubFilterFn(productFilter) {
    const val = productFilter;
    if (!val) {
      return function(item) { return true; };
    }

    if (val === "copy" || val === "print") {
      const sizeSel  = document.getElementById("filterBwSize");
      const printSel = document.getElementById("filterBwPrintType");
      const sizeVal  = sizeSel  ? sizeSel.value  : "";
      const printVal = printSel ? printSel.value : "";

      return function(item) {
        if (val === "copy") {
          if (item.type !== "Ú©Ù¾ÛŒ" || item.colorMode !== "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") return false;
        } else {
          if (item.type !== "Ù¾Ø±ÛŒÙ†Øª" || item.colorMode !== "Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯") return false;
        }
        if (sizeVal  && item.paperSize !== sizeVal) return false;
        if (printVal && item.printType !== printVal) return false;
        return true;
      };
    } else if (val === "color") {
      const sizeSel  = document.getElementById("filterColorSize");
      const printSel = document.getElementById("filterColorPrint");
      const paperSel = document.getElementById("filterColorPaper");
      const weightSel = document.getElementById("filterColorWeight");
      const sizeVal  = sizeSel  ? sizeSel.value  : "";
      const printVal = printSel ? printSel.value : "";
      const paperVal = paperSel ? paperSel.value : "";
      const weightVal = weightSel ? weightSel.value : "";

      return function(item) {
        if (item.type !== "Ú©Ù¾ÛŒ" && item.type !== "Ù¾Ø±ÛŒÙ†Øª") return false;
        if (item.colorMode !== "Ø±Ù†Ú¯ÛŒ") return false;
        if (sizeVal  && item.paperSize !== sizeVal) return false;
        if (printVal && item.printType !== printVal) return false;
        if (paperVal && item.paperType !== paperVal) return false;
        if (weightVal && item.paperWeight !== weightVal) return false;
        return true;
      };
    } else if (val === "binding") {
      const jobSel   = document.getElementById("filterBindingJob");
      const sizeSel  = document.getElementById("filterBindingSize");
      const spiralSel = document.getElementById("filterBindingSpiral");
      const coverSel = document.getElementById("filterBindingCover");
      const jobVal   = jobSel   ? jobSel.value   : "";
      const sizeVal  = sizeSel  ? sizeSel.value  : "";
      const spiralVal = spiralSel ? spiralSel.value : "";
      const coverVal = coverSel ? coverSel.value : "";

      return function(item) {
        if (item.type !== "ÙÙ†Ø±ÛŒ") return false;
        if (jobVal   && getBindingJobType(item) !== jobVal) return false;
        if (sizeVal  && item.paperSize !== sizeVal) return false;
        if (spiralVal && item.bindingSpiralSize !== spiralVal) return false;
        if (coverVal && item.bindingCover !== coverVal) return false;
        return true;
      };
    } else if (val === "lamination") {
      const sizeSel = document.getElementById("filterLaminationSize");
      const sizeVal = sizeSel ? sizeSel.value : "";

      return function(item) {
        if (item.type !== "Ù¾Ø±Ø³") return false;
        if (sizeVal && item.paperSize !== sizeVal) return false;
        return true;
      };
    } else if (val === "staple") {
      return function(item) {
        return item.type === "Ù…Ù†Ú¯Ù†Ù‡";
      };
    }

    return function(item) { return true; };
  }

  // Ø³Ø§Ø®Øª Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
  function rebuildProductOrdersList(filteredOrders, productFilter) {
    // Ø§Ø¨ØªØ¯Ø§ productOrdersBody Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒÙ…
    if (productOrdersBody) {
      productOrdersBody.innerHTML = "";
    }

    const subFilterFn = buildSubFilterFn(productFilter);
    const relevantOrders = filteredOrders.filter(order =>
      (order.items || []).some(item => subFilterFn(item))
    );

    if (relevantOrders.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="7" style="text-align: center; color: #666; padding: 20px;">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      if (productOrdersBody) productOrdersBody.appendChild(tr);
      return;
    }

    let totalQuantity = 0;
    let totalAmount = 0;

    relevantOrders.forEach((order, idx) => {
      const relevantItems = (order.items || []).filter(item => subFilterFn(item));

      relevantItems.forEach(item => {
        const tr = document.createElement("tr");
        const itemTotal = item.rowTotal || 0;
        const itemQuantity = getUnitsForProductGroup(productFilter, item);

        totalQuantity += itemQuantity;
        totalAmount += itemTotal;

        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${order.dateTime || ""}</td>
          <td>${order.orderNo || ""}</td>
          <td>${order.customerName || ""}</td>
          <td>${order.user || ""}</td>
          <td>${formatMoney(itemQuantity)}</td>
          <td>${formatMoney(itemTotal)}</td>
        `;

        if (productOrdersBody) productOrdersBody.appendChild(tr);
      });
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„
    if (productOrdersBody) {
      const totalRow = document.createElement("tr");
      totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

      totalRow.innerHTML = `
        <td colspan="5" style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${relevantOrders.length} Ø³ÙØ§Ø±Ø´)</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalQuantity)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalAmount)}</td>
      `;
      productOrdersBody.appendChild(totalRow);
    }
  }

  // Ø§Ø¬Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙÛŒÙ„ØªØ±Ù‡Ø§
  function runReport() {
    const allOrders    = loadAllOrders();
    const filteredMain = filterOrdersByMainFilters(allOrders);
    lastFilteredOrders = filteredMain;

    const productFilter = repProductSelect.value;

    if (!productFilter) {
      // Ø§Ú¯Ø± Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ â†’ ÙÙ‚Ø· Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
      reportTableTitle.textContent = "Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„";
      if (productOrdersSection) productOrdersSection.style.display = "none";
      rebuildProductSummary(filteredMain);
    } else {
      // Ø§Ú¯Ø± Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ â†’ Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ + Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      reportTableTitle.textContent = `Ú¯Ø²Ø§Ø±Ø´ Ù…Ø­ØµÙˆÙ„: ${getProductFilterLabel(productFilter)}`;
      if (productOrdersSection) productOrdersSection.style.display = "block";
      rebuildProductSummary(filteredMain);
      rebuildProductOrdersList(filteredMain, productFilter);
    }
  }

  // Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡
  function rebuildProductSummary(filteredOrders) {
    productSummaryBody.innerHTML = "";
    const productFilter = repProductSelect.value;

    // Ø§Ú¯Ø± Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ØŒ Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    if (!productFilter) {
      buildOverallProductSummary(filteredOrders);
      return;
    }

    const subFilterFn = buildSubFilterFn(productFilter);
    const groups = new Map();

    filteredOrders.forEach(o => {
      (o.items || []).forEach(item => {
        if (!subFilterFn(item)) return;

        let key = "";
        let title = "";
        let units = getUnitsForProductGroup(productFilter, item);

        if (productFilter === "copy") {
          const size  = item.paperSize || "";
          const print = item.printType || "";
          key   = "COPY|" + size + "|" + print;
          title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
            (size  ? " - " + size  : "") +
            (print ? " - " + print : "");
        } else if (productFilter === "print") {
          const size  = item.paperSize || "";
          const print = item.printType || "";
          key   = "PRINT|" + size + "|" + print;
          title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
            (size  ? " - " + size  : "") +
            (print ? " - " + print : "");
        } else if (productFilter === "color") {
          const size   = item.paperSize || "";
          const print  = item.printType || "";
          const pType  = item.paperType || "";
          const weight = item.paperWeight || "";
          key   = "COLOR|" + size + "|" + print + "|" + pType + "|" + weight;
          title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ" +
            (size   ? " - " + size   : "") +
            (print  ? " - " + print  : "") +
            (pType  ? " - " + pType  : "") +
            (weight ? " - Ú¯Ø±Ù…Ø§Ú˜ " + weight : "");
        } else if (productFilter === "binding") {
          const job    = item.bindingJobType    || "";
          const size   = item.paperSize || "";
          const spiral = item.bindingSpiralSize || "";
          const cover  = item.bindingCover      || "";
          key   = "BIND|" + job + "|" + size + "|" + spiral + "|" + cover;
          title = "ÙÙ†Ø±ÛŒ" +
            (job    ? " - " + job    : "") +
            (size   ? " - " + size   : "") +
            (spiral ? " - " + labelSpiralSize(spiral) : "") +
            (cover  ? " - " + cover  : "");
        } else if (productFilter === "staple") {
          key   = "STAPLE";
          title = "Ù…Ù†Ú¯Ù†Ù‡ (Ù‡Ù…Ù‡)";
        } else if (productFilter === "lamination") {
          const size = item.paperSize || "";
          key   = "LAM|" + size;
          title = "Ù¾Ø±Ø³" + (size ? " - " + size : "");
        }

        if (!groups.has(key)) {
          groups.set(key, {
            title,
            rowsCount:   0,
            totalUnits:  0,
            totalAmount: 0
          });
        }

        const g = groups.get(key);
        g.rowsCount   += 1;
        g.totalUnits  += (units || 0);
        g.totalAmount += (item.rowTotal || 0);
      });
    });

    let totalRowsCount = 0;
    let totalUnits = 0;
    let totalAmount = 0;

    groups.forEach(g => {
      const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${g.title}</td>
        <td>${formatMoney(g.rowsCount)}</td>
        <td>${formatMoney(g.totalUnits)}</td>
        <td>${formatMoney(g.totalAmount)}</td>
        <td>${formatMoney(avgUnit)}</td>
      `;
      productSummaryBody.appendChild(tr);

      // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ú©Ù„
      totalRowsCount += g.rowsCount;
      totalUnits += g.totalUnits;
      totalAmount += g.totalAmount;
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„
    if (groups.size > 0) {
      const avgUnitTotal = totalUnits > 0 ? Math.round(totalAmount / totalUnits) : 0;
      const totalRow = document.createElement("tr");
      totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

      totalRow.innerHTML = `
        <td style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${groups.size} Ø²ÛŒØ±Ø´Ø§Ø®Ù‡)</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalRowsCount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalUnits)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalAmount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(avgUnitTotal)}</td>
      `;
      productSummaryBody.appendChild(totalRow);
    }
  }

  // Ø³Ø§Ø®Øª Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
  function buildOverallProductSummary(filteredOrders) {
    const productTypes = ["copy", "print", "color", "binding", "staple", "lamination"];
    const groups = new Map();

    filteredOrders.forEach(o => {
      (o.items || []).forEach(item => {
        const productKey = item.product || "copy";
        if (!productTypes.includes(productKey)) return;

        let key = "";
        let title = "";
        let units = getUnitsForProductGroup(productKey, item);

        // ØªØ¹ÛŒÛŒÙ† Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„
        switch (productKey) {
          case "copy": title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
          case "print": title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
          case "color": title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ"; break;
          case "binding": title = "ÙÙ†Ø±ÛŒ"; break;
          case "staple": title = "Ù…Ù†Ú¯Ù†Ù‡"; break;
          case "lamination": title = "Ù¾Ø±Ø³"; break;
        }

        if (!groups.has(title)) {
          groups.set(title, {
            rowsCount: 0,
            totalUnits: 0,
            totalAmount: 0
          });
        }

        const g = groups.get(title);
        g.rowsCount += 1;
        g.totalUnits += (units || 0);
        g.totalAmount += (item.rowTotal || 0);
      });
    });

    if (groups.size === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666; padding: 20px;">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      productSummaryBody.appendChild(tr);
    } else {
      groups.forEach(g => {
        const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${g.title}</td>
          <td>${formatMoney(g.rowsCount)}</td>
          <td>${formatMoney(g.totalUnits)}</td>
          <td>${formatMoney(g.totalAmount)}</td>
          <td>${formatMoney(avgUnit)}</td>
        `;
        productSummaryBody.appendChild(tr);
      });
    }
  }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„
  function getUnitsForProductGroup(productKey, item) {
    // Ú©Ù¾ÛŒ / Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯ Ùˆ Ø±Ù†Ú¯ÛŒ â†’ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ú¯
    if (productKey === "copy" || productKey === "print" || productKey === "color") {
      return parseIntSafe(item.totalSheets || "0");
    }
    // ÙÙ†Ø±ÛŒ / Ù…Ù†Ú¯Ù†Ù‡ / Ù¾Ø±Ø³ â†’ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø²ÙˆÙ‡ / Ú©Ø§Ø±
    return parseIntSafe(item.setCount || "0");
  }

  // Ú¯Ø±ÙØªÙ† Ø¨Ø±Ú†Ø³Ø¨ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
  function getProductFilterLabel(productFilter) {
    const labels = {
      "copy": "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯",
      "print": "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯",
      "color": "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ",
      "binding": "ÙÙ†Ø±ÛŒ",
      "staple": "Ù…Ù†Ú¯Ù†Ù‡",
      "lamination": "Ù¾Ø±Ø³"
    };
    return labels[productFilter] || productFilter;
  }

  // Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
  function printOrdersReport() {
    const printWindow = window.open('', '_blank');
    const currentDate = new Date().toLocaleDateString('fa-IR');

    // Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡
    const allOrders = loadAllOrders();
    const filteredOrders = filterOrdersByMainFilters(allOrders);
    const productFilter = repProductSelect.value;

    printWindow.document.write(`
      <!DOCTYPE html>
      <html lang="fa" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª - ${currentDate}</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; margin: 20px; }
          h1 { text-align: center; color: #333; margin-bottom: 30px; }
          .office-info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .summary { background-color: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          .summary-item { display: inline-block; margin: 0 15px; }
          .summary-label { font-weight: bold; color: #666; }
          .summary-value { font-weight: bold; color: #1976d2; }
          @media print { body { margin: 0; } }
        
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
      </head>
      <body>
        <div class="office-info">
          <h2>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h2>
          <p><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
          <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510</p>
          <p><strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
        </div>
        <h1>Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„</h1>

        <div class="summary">
          <span class="summary-item">
            <span class="summary-label">ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´:</span>
            <span class="summary-value">${currentDate}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª:</span>
            <span class="summary-value">${filteredOrders.length}</span>
          </span>
          ${productFilter ? `
          <span class="summary-item">
            <span class="summary-label">ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„:</span>
            <span class="summary-value">${getProductFilterLabel(productFilter)}</span>
          </span>
          ` : ''}
        </div>

        <table>
          <thead>
            <tr>
              <th>Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„ / Ø²ÛŒØ±Ø´Ø§Ø®Ù‡</th>
              <th>ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙ</th>
              <th>Ù…Ø¬Ù…ÙˆØ¹ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„</th>
              <th>Ø¬Ù…Ø¹ Ú©Ù„ (Ø±ÛŒØ§Ù„)</th>
              <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
            </tr>
          </thead>
          <tbody id="printProductSummaryBody"></tbody>
        </table>
      </body>
      </html>
    `);

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„
    const printTableBody = printWindow.document.getElementById('printProductSummaryBody');

    if (!productFilter) {
      // Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
      const productTypes = ["copy", "print", "color", "binding", "staple", "lamination"];
      const groups = new Map();

      filteredOrders.forEach(o => {
        (o.items || []).forEach(item => {
          const productKey = item.product || "copy";
          if (!productTypes.includes(productKey)) return;

          let title = "";
          let units = getUnitsForProductGroup(productKey, item);

          // ØªØ¹ÛŒÛŒÙ† Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„
          switch (productKey) {
            case "copy": title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
            case "print": title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯"; break;
            case "color": title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ"; break;
            case "binding": title = "ÙÙ†Ø±ÛŒ"; break;
            case "staple": title = "Ù…Ù†Ú¯Ù†Ù‡"; break;
            case "lamination": title = "Ù¾Ø±Ø³"; break;
          }

          if (!groups.has(title)) {
            groups.set(title, {
              rowsCount: 0,
              totalUnits: 0,
              totalAmount: 0
            });
          }

          const g = groups.get(title);
          g.rowsCount += 1;
          g.totalUnits += (units || 0);
          g.totalAmount += (item.rowTotal || 0);
        });
      });

      if (groups.size === 0) {
        const tr = printWindow.document.createElement("tr");
        tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666; padding: 20px;">Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
        printTableBody.appendChild(tr);
      } else {
        let totalRowsCount = 0;
        let totalUnits = 0;
        let totalAmount = 0;

        groups.forEach(g => {
          const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
          const tr = printWindow.document.createElement("tr");
          tr.innerHTML = `
            <td>${g.title}</td>
            <td>${formatMoney(g.rowsCount)}</td>
            <td>${formatMoney(g.totalUnits)}</td>
            <td>${formatMoney(g.totalAmount)}</td>
            <td>${formatMoney(avgUnit)}</td>
          `;
          printTableBody.appendChild(tr);

          // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ú©Ù„
          totalRowsCount += g.rowsCount;
          totalUnits += g.totalUnits;
          totalAmount += g.totalAmount;
        });

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„ Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª
        const avgUnitTotal = totalUnits > 0 ? Math.round(totalAmount / totalUnits) : 0;
        const totalRow = printWindow.document.createElement("tr");
        totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

        totalRow.innerHTML = `
          <td style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${groups.size} Ø²ÛŒØ±Ø´Ø§Ø®Ù‡)</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalRowsCount)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalUnits)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalAmount)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(avgUnitTotal)}</td>
        `;
        printTableBody.appendChild(totalRow);
      }
    } else {
      // Ø®Ù„Ø§ØµÙ‡ Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ
      const subFilterFn = buildSubFilterFn(productFilter);
      const groups = new Map();

      filteredOrders.forEach(o => {
        (o.items || []).forEach(item => {
          if (!subFilterFn(item)) return;

          let key = "";
          let title = "";
          let units = getUnitsForProductGroup(productFilter, item);

          if (productFilter === "copy") {
            const size  = item.paperSize || "";
            const print = item.printType || "";
            key   = "COPY|" + size + "|" + print;
            title = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
              (size  ? " - " + size  : "") +
              (print ? " - " + print : "");
          } else if (productFilter === "print") {
            const size  = item.paperSize || "";
            const print = item.printType || "";
            key   = "PRINT|" + size + "|" + print;
            title = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯" +
              (size  ? " - " + size  : "") +
              (print ? " - " + print : "");
          } else if (productFilter === "color") {
            const size   = item.paperSize || "";
            const print  = item.printType || "";
            const pType  = item.paperType || "";
            const weight = item.paperWeight || "";
            key   = "COLOR|" + size + "|" + print + "|" + pType + "|" + weight;
            title = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ" +
              (size   ? " - " + size   : "") +
              (print  ? " - " + print  : "") +
              (pType  ? " - " + pType  : "") +
              (weight ? " - Ú¯Ø±Ù…Ø§Ú˜ " + weight : "");
          } else if (productFilter === "binding") {
            const job    = item.bindingJobType    || "";
            const size   = item.paperSize || "";
            const spiral = item.bindingSpiralSize || "";
            const cover  = item.bindingCover      || "";
            key   = "BIND|" + job + "|" + size + "|" + spiral + "|" + cover;
            title = "ÙÙ†Ø±ÛŒ" +
              (job    ? " - " + job    : "") +
              (size   ? " - " + size   : "") +
              (spiral ? " - " + labelSpiralSize(spiral) : "") +
              (cover  ? " - " + cover  : "");
          } else if (productFilter === "staple") {
            key   = "STAPLE";
            title = "Ù…Ù†Ú¯Ù†Ù‡ (Ù‡Ù…Ù‡)";
          } else if (productFilter === "lamination") {
            const size = item.paperSize || "";
            key   = "LAM|" + size;
            title = "Ù¾Ø±Ø³" + (size ? " - " + size : "");
          }

          if (!groups.has(key)) {
            groups.set(key, {
              title,
              rowsCount:   0,
              totalUnits:  0,
              totalAmount: 0
            });
          }

          const g = groups.get(key);
          g.rowsCount   += 1;
          g.totalUnits  += (units || 0);
          g.totalAmount += (item.rowTotal || 0);
        });
      });

      if (groups.size === 0) {
        const tr = printWindow.document.createElement("tr");
        tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666; padding: 20px;">Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
        printTableBody.appendChild(tr);
      } else {
        let totalRowsCount = 0;
        let totalUnits = 0;
        let totalAmount = 0;

        groups.forEach(g => {
          const avgUnit = g.totalUnits > 0 ? Math.round(g.totalAmount / g.totalUnits) : 0;
          const tr = printWindow.document.createElement("tr");
          tr.innerHTML = `
            <td>${g.title}</td>
            <td>${formatMoney(g.rowsCount)}</td>
            <td>${formatMoney(g.totalUnits)}</td>
            <td>${formatMoney(g.totalAmount)}</td>
            <td>${formatMoney(avgUnit)}</td>
          `;
          printTableBody.appendChild(tr);

          // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ú©Ù„
          totalRowsCount += g.rowsCount;
          totalUnits += g.totalUnits;
          totalAmount += g.totalAmount;
        });

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„ Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª
        const avgUnitTotal = totalUnits > 0 ? Math.round(totalAmount / totalUnits) : 0;
        const totalRow = printWindow.document.createElement("tr");
        totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

        totalRow.innerHTML = `
          <td style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${groups.size} Ø²ÛŒØ±Ø´Ø§Ø®Ù‡)</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalRowsCount)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalUnits)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalAmount)}</td>
          <td style="padding: 10px; color: #2e7d32;">${formatMoney(avgUnitTotal)}</td>
        `;
        printTableBody.appendChild(totalRow);
      }
    }

    printWindow.document.close();
    printWindow.print();
  }

  // Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ø¨Ø±Ø§ÛŒ ØªØ¨ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡)
  function generateCashPaymentsReport() {
    const fromStr = cashRepFrom.value.trim();
    const toStr = cashRepTo.value.trim();
    const userFilter = cashRepUser.value;
    const methodFilter = cashRepMethod.value;
    const typeFilter = cashRepType.value;

    const fromNum = fromStr ? jalaliStringToNumber(fromStr) : 0;
    const toNum = toStr ? jalaliStringToNumber(toStr) : 99999999;

    const allPayments = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");

    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
    const filteredPayments = allPayments.filter(p => {
      // ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®
      const dt = (p.dateTime || "").split(/[,\s]/)[0];
      const dNum = jalaliStringToNumber(dt);
      if (dNum < fromNum || dNum > toNum) return false;

      // ÙÛŒÙ„ØªØ± Ú©Ø§Ø±Ø¨Ø±
      if (userFilter && p.user !== userFilter) return false;

      // ÙÛŒÙ„ØªØ± Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
      if (methodFilter && p.payMethod !== methodFilter) return false;

      // ÙÛŒÙ„ØªØ± Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª
      if (typeFilter && p.payType !== typeFilter) return false;

      return true;
    });

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®Ù„Ø§ØµÙ‡
    const summary = {
      cash: 0,
      office_card: 0,
      personal_card: 0,
      bank_transfer: 0,
      other: 0,
      total: 0
    };

    filteredPayments.forEach(p => {
      const amount = p.amount || 0;
      const method = p.payMethod || "other";

      if (method === "cash") summary.cash += amount;
      else if (method === "office_card") summary.office_card += amount;
      else if (method === "personal_card") summary.personal_card += amount;
      else if (method === "bank_transfer") summary.bank_transfer += amount;
      else summary.other += amount;

      summary.total += amount;
    });

    // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
    document.getElementById("cashTotal").textContent = formatMoney(summary.cash);
    document.getElementById("officeCardTotal").textContent = formatMoney(summary.office_card);
    document.getElementById("personalCardTotal").textContent = formatMoney(summary.personal_card);
    document.getElementById("bankTransferTotal").textContent = formatMoney(summary.bank_transfer);
    document.getElementById("otherPaymentsTotal").textContent = formatMoney(summary.other);
    document.getElementById("grandTotal").textContent = formatMoney(summary.total);

    // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„ Ø¬Ø²Ø¦ÛŒØ§Øª
    cashPaymentsReportBody.innerHTML = "";

    if (filteredPayments.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="8" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      cashPaymentsReportBody.appendChild(tr);
      return;
    }

    filteredPayments.forEach((p, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${p.dateTime || ""}</td>
        <td>${p.user || ""}</td>
        <td>${formatMoney(p.amount || 0)}</td>
        <td>${getPaymentMethodLabel(p.payMethod || "")}</td>
        <td>${getPaymentTypeLabel(p.payType || "")}</td>
        <td>${p.customerName || ""}</td>
        <td>${p.reason || ""}</td>
      `;
      cashPaymentsReportBody.appendChild(tr);
    });
  }

  // ================== Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† ==================

  // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
  function generateCustomerBalanceReport() {
    const fromStr = balanceRepFrom.value.trim();
    const toStr = balanceRepTo.value.trim();

    const fromNum = fromStr ? jalaliStringToNumber(fromStr) : 0;
    const toNum = toStr ? jalaliStringToNumber(toStr) : 99999999;

    const allOrders = loadAllOrders();

    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®
    const filteredOrders = allOrders.filter(o => {
      const dNum = orderDateToNumber(o);
      return dNum >= fromNum && dNum <= toNum;
    });

    // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø´ØªØ±ÛŒ
    const customerBalances = new Map();

    filteredOrders.forEach(order => {
      const customerName = order.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡";
      const balance = (order.total || 0) - (order.paid || 0);

      // ÙÙ‚Ø· Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø«Ø¨Øª Ø±Ø§ Ø¯Ø± Ù†Ø¸Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
      if (balance > 0) {
        if (!customerBalances.has(customerName)) {
          customerBalances.set(customerName, {
            totalOrders: 0,
            totalAmount: 0,
            totalPaid: 0,
            totalBalance: 0,
            orderCount: 0,
            lastOrderDate: order.dateTime || ""
          });
        }

        const customer = customerBalances.get(customerName);
        customer.totalOrders += (order.total || 0);
        customer.totalPaid += (order.paid || 0);
        customer.totalBalance += balance;
        customer.orderCount += 1;

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´
        if (order.dateTime > customer.lastOrderDate) {
          customer.lastOrderDate = order.dateTime;
        }
      }
    });

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
    const customersWithBalance = Array.from(customerBalances.values());
    const totalBalance = customersWithBalance.reduce((sum, c) => sum + c.totalBalance, 0);

    // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
    customersWithBalanceCount.textContent = customersWithBalance.length;
    totalCustomerBalance.textContent = formatMoney(totalBalance);

    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø§Ù†Ø¯Ù‡ (Ù†Ø²ÙˆÙ„ÛŒ)
    customersWithBalance.sort((a, b) => b.totalBalance - a.totalBalance);

    // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„
    customerBalanceReportBody.innerHTML = "";

    if (customersWithBalance.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="7" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      customerBalanceReportBody.appendChild(tr);
      return;
    }

    customersWithBalance.forEach((customer, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${customer.customerName}</td>
        <td>${customer.orderCount}</td>
        <td>${formatMoney(customer.totalOrders)}</td>
        <td>${formatMoney(customer.totalPaid)}</td>
        <td>${formatMoney(customer.totalBalance)}</td>
        <td>${customer.lastOrderDate}</td>
      `;
      customerBalanceReportBody.appendChild(tr);
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„
    if (customersWithBalance.length > 0) {
      const totalOrderCount = customersWithBalance.reduce((sum, c) => sum + c.orderCount, 0);
      const totalOrdersAmount = customersWithBalance.reduce((sum, c) => sum + c.totalOrders, 0);
      const totalPaidAmount = customersWithBalance.reduce((sum, c) => sum + c.totalPaid, 0);

      const totalRow = document.createElement("tr");
      totalRow.style.cssText = "background: #e8f5e8; font-weight: bold; border-top: 2px solid #4caf50;";

      totalRow.innerHTML = `
        <td colspan="2" style="text-align: center; padding: 10px; color: #2e7d32;">Ø¬Ù…Ø¹ Ú©Ù„ (${customersWithBalance.length} Ù…Ø´ØªØ±ÛŒ)</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalOrderCount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalOrdersAmount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalPaidAmount)}</td>
        <td style="padding: 10px; color: #2e7d32;">${formatMoney(totalBalance)}</td>
        <td style="padding: 10px; color: #2e7d32;">-</td>
      `;
      customerBalanceReportBody.appendChild(totalRow);
    }
  }

  // Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
  function printCustomerBalanceReport() {
    const printWindow = window.open('', '_blank');
    const currentDate = new Date().toLocaleDateString('fa-IR');

    printWindow.document.write(`
      <!DOCTYPE html>
      <html lang="fa" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† - ${currentDate}</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; margin: 20px; }
          h1 { text-align: center; color: #333; margin-bottom: 30px; }
          .office-info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .summary { background-color: #fff3e0; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          .summary-item { display: inline-block; margin: 0 15px; }
          .summary-label { font-weight: bold; color: #666; }
          .summary-value { font-weight: bold; color: #ff9800; }
          @media print { body { margin: 0; } }
        
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
      </head>
      <body>
        <div class="office-info">
          <h2>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h2>
          <p><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
          <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510</p>
          <p><strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
        </div>
        <h1>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†</h1>
        <div class="summary">
          <span class="summary-item">
            <span class="summary-label">ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´:</span>
            <span class="summary-value">${currentDate}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø§ Ù…Ø§Ù†Ø¯Ù‡:</span>
            <span class="summary-value">${customersWithBalanceCount.textContent}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ø¬Ù…Ø¹ Ú©Ù„ Ù…Ø§Ù†Ø¯Ù‡:</span>
            <span class="summary-value">${totalCustomerBalance.textContent} Ø±ÛŒØ§Ù„</span>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th>Ø±Ø¯ÛŒÙ</th>
              <th>Ù…Ø´ØªØ±ÛŒ</th>
              <th>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
              <th>Ø¬Ù…Ø¹ Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª</th>
              <th>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
              <th>Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„</th>
              <th>ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´</th>
            </tr>
          </thead>
          <tbody id="printTableBody"></tbody>
        </table>
      </body>
      </html>
    `);

    // Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„
    const rows = customerBalanceReportBody.querySelectorAll('tr');
    const printTableBody = printWindow.document.getElementById('printTableBody');

    rows.forEach(row => {
      const newRow = printWindow.document.createElement('tr');
      newRow.innerHTML = row.innerHTML;
      printTableBody.appendChild(newRow);
    });

    printWindow.document.close();
    printWindow.print();
  }

  // ================== Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù† ==================

  // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
  function generateCustomersReport() {
    const fromStr = customersRepFrom.value.trim();
    const toStr = customersRepTo.value.trim();
    const searchTerm = customersRepSearch.value.trim().toLowerCase();

    const fromNum = fromStr ? jalaliStringToNumber(fromStr) : 0;
    const toNum = toStr ? jalaliStringToNumber(toStr) : 99999999;

    const allOrders = loadAllOrders();

    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®
    const filteredOrders = allOrders.filter(o => {
      const dNum = orderDateToNumber(o);
      return dNum >= fromNum && dNum <= toNum;
    });

    // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø´ØªØ±ÛŒ
    const customers = new Map();

    filteredOrders.forEach(order => {
      const customerName = order.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡";

      if (!customers.has(customerName)) {
        customers.set(customerName, {
          totalOrders: 0,
          totalPaid: 0,
          totalBalance: 0,
          orderCount: 0,
          lastOrderDate: order.dateTime || ""
        });
      }

      const customer = customers.get(customerName);
      customer.totalOrders += (order.total || 0);
      customer.totalPaid += (order.paid || 0);
      customer.totalBalance += ((order.total || 0) - (order.paid || 0));
      customer.orderCount += 1;

      // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´
      if (order.dateTime > customer.lastOrderDate) {
        customer.lastOrderDate = order.dateTime;
      }
    });

    // ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ø³ØªØ¬Ùˆ
    let filteredCustomers = Array.from(customers.entries());
    if (searchTerm) {
      filteredCustomers = filteredCustomers.filter(([name, data]) =>
        name.toLowerCase().includes(searchTerm)
      );
    }

    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ
    filteredCustomers.sort(([a], [b]) => a.localeCompare(b, 'fa'));

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
    const totalOrders = filteredCustomers.reduce((sum, [, data]) => sum + data.orderCount, 0);
    const totalSales = filteredCustomers.reduce((sum, [, data]) => sum + data.totalOrders, 0);

    // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
    totalCustomersCount.textContent = filteredCustomers.length;
    totalCustomersOrders.textContent = totalOrders;
    totalCustomersSales.textContent = formatMoney(totalSales);

    // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„
    customersReportBody.innerHTML = "";

    if (filteredCustomers.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="8" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ù…Ø´ØªØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      customersReportBody.appendChild(tr);
      return;
    }

    filteredCustomers.forEach(([customerName, data], index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${customerName}</td>
        <td>${data.orderCount}</td>
        <td>${formatMoney(data.totalOrders)}</td>
        <td>${formatMoney(data.totalPaid)}</td>
        <td>${formatMoney(data.totalBalance)}</td>
        <td>${data.lastOrderDate}</td>
        <td>
          <button class="btn-small" onclick="window.showCustomerOrders('${customerName.replace(/'/g, '\\\'')}')" style="background:#2196f3;color:#fff;">Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª</button>
        </td>
      `;
      customersReportBody.appendChild(tr);
    });
  }

  
  // ===== Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† (ØµÙØ­Ù‡ Ø§Ø®ØªØµØ§ØµÛŒ) =====
  function buildCustomerAccountsData(fromDateStr, toDateStr) {
    const allOrders = loadAllOrders();
    const customersMap = new Map();

    // ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® Ø¯Ø± Ø³Ø·Ø­ Ø³ÙØ§Ø±Ø´ (Ø¯Ø± ØµÙˆØ±Øª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†)
    let filteredOrders = allOrders;
    if (fromDateStr || toDateStr) {
      const fromTs = fromDateStr ? parseJalaliDateToTimestamp(fromDateStr) : null;
      const toTs   = toDateStr   ? parseJalaliDateToTimestamp(toDateStr, true) : null;
      filteredOrders = allOrders.filter(o => {
        if (!o.dateTime) return false;
        const t = new Date(o.dateTime).getTime();
        if (fromTs && t < fromTs) return false;
        if (toTs && t > toTs) return false;
        return true;
      });
    }

    filteredOrders.forEach(order => {
      const name = order.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡";
      if (!customersMap.has(name)) {
        customersMap.set(name, {
          customerName: name,
          phone: "", // Ø¯Ø± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
          orderCount: 0,
          totalOrders: 0,
          totalPaid: 0,
          totalBalance: 0,
          lastOrderDate: order.dateTime || ""
        });
      }
      const c = customersMap.get(name);
      c.orderCount += 1;
      c.totalOrders  += (order.total || 0);
      c.totalPaid    += (order.paid || 0);
      c.totalBalance += ((order.total || 0) - (order.paid || 0));
      if (order.dateTime > c.lastOrderDate) {
        c.lastOrderDate = order.dateTime;
      }
    });

    return Array.from(customersMap.values());
  }

  function refreshCustomerAccountsList() {
    if (!customerAccountsBody) return;

    const search = (custAccSearchInput && custAccSearchInput.value ? custAccSearchInput.value.trim().toLowerCase() : "");
    const onlyDebtors = !!(custAccOnlyDebtorsChk && custAccOnlyDebtorsChk.checked);
    const fromDateStr = custAccFromDateInput && custAccFromDateInput.value ? custAccFromDateInput.value.trim() : "";
    const toDateStr   = custAccToDateInput && custAccToDateInput.value ? custAccToDateInput.value.trim() : "";

    let items = buildCustomerAccountsData(fromDateStr, toDateStr);

    if (onlyDebtors) {
      items = items.filter(c => (c.totalBalance || 0) > 0);
    }
    if (search) {
      items = items.filter(c => (c.customerName || "").toLowerCase().includes(search));
    }

    if (onlyDebtors) {
      items.sort((a, b) => (b.totalBalance || 0) - (a.totalBalance || 0));
    } else {
      items.sort((a, b) => (a.customerName || "").localeCompare(b.customerName || "", "fa"));
    }


    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
    let sumSales = 0;
    let sumPaid = 0;
    let sumBalance = 0;
    items.forEach(c => {
      sumSales   += (c.totalOrders || 0);
      sumPaid    += (c.totalPaid || 0);
      sumBalance += (c.totalBalance || 0);
    });
    if (custAccSummarySales)   custAccSummarySales.textContent   = formatMoney(sumSales);
    if (custAccSummaryPaid)    custAccSummaryPaid.textContent    = formatMoney(sumPaid);
    if (custAccSummaryBalance) custAccSummaryBalance.textContent = formatMoney(sumBalance);

    customerAccountsBody.innerHTML = "";
    if (!items.length) {
      const tr = document.createElement("tr");
      tr.innerHTML = '<td colspan="7" style="text-align:center; color:#666;">Ù‡ÛŒÚ† Ù…Ø´ØªØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>';
      customerAccountsBody.appendChild(tr);
      return;
    }

    items.forEach((c) => {
      const tr = document.createElement("tr");
      const phoneText = c.phone || "";
      const safeName = (c.customerName || "").replace(/"/g, '&quot;');
      tr.innerHTML = `
        <td>${c.customerName}</td>
        <td>${phoneText}</td>
        <td>${c.orderCount}</td>
        <td>${formatMoney(c.totalOrders)}</td>
        <td>${formatMoney(c.totalPaid)}</td>
        <td>${formatMoney(c.totalBalance)}</td>
        <td>
          <button class="btn-small" data-action="cust-show-orders" data-customer="${safeName}" style="margin-left:4px;">Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª</button>
          <button class="btn-small" data-action="cust-pay-debt" data-customer="${safeName}" data-balance="${c.totalBalance}" style="background:#4caf50;color:#fff;">Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª</button>
        </td>
      `;
      customerAccountsBody.appendChild(tr);
    });
  }

  function attachCustomerAccountsEvents() {
    if (custAccSearchInput) {
      custAccSearchInput.addEventListener("input", function () {
        refreshCustomerAccountsList();
      });
    }
    if (custAccOnlyDebtorsChk) {
      custAccOnlyDebtorsChk.addEventListener("change", function () {
        refreshCustomerAccountsList();
      });
    }
    if (custAccFromDateInput) {
      custAccFromDateInput.addEventListener("change", function () {
        refreshCustomerAccountsList();
      });
    }
    if (custAccToDateInput) {
      custAccToDateInput.addEventListener("change", function () {
        refreshCustomerAccountsList();
      });
    }
    if (customerAccountsBody) {
      customerAccountsBody.addEventListener("click", function (e) {
        const btn = e.target.closest("button[data-action]");
        if (!btn) return;
        const action = btn.getAttribute("data-action");
        const customerName = btn.getAttribute("data-customer") || "";
        if (!customerName) return;

        if (action === "cust-show-orders") {
          if (window.showCustomerOrders) {
            window.showCustomerOrders(customerName);
          }
        } else if (action === "cust-pay-debt") {
          const balance = parseFloat(btn.getAttribute("data-balance") || "0") || 0;
          if (balance <= 0) {
            alert("Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø´ØªØ±ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
            return;
          }
          if (window.openCustomerPaymentFromAccounts) {
            window.openCustomerPaymentFromAccounts(customerName, balance);
          } else {
            selectDebtCustomer(customerName, balance);
          }
        }
      });
    }
  }
// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢ÛŒØªÙ… Ø³ÙØ§Ø±Ø´
  // ØªØ¹Ø±ÛŒÙ ØªØ§Ø¨Ø¹ Ø¯Ø± Ø³Ø·Ø­ Ø¬Ù‡Ø§Ù†ÛŒ
  window.getItemDetailsText = function(item) {
    const productKey = item.product || "copy";
    let type = "";
    let title = "";
    let calculation = "";
    let quantity = "";
    let unitPrice = 0;

    switch (productKey) {
      case "copy":
        type = "Ú©Ù¾ÛŒ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯";
        title = `${item.paperSize || ""} ${item.printType || ""}`.trim();
        calculation = `${item.totalSheets || 0} Ø¨Ø±Ú¯ Ã— ${formatMoney(item.pricePerSheet || 0)}`;
        quantity = `${item.totalSheets || 0} Ø¨Ø±Ú¯`;
        unitPrice = item.pricePerSheet || 0;
        break;
      case "print":
        type = "Ù¾Ø±ÛŒÙ†Øª Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯";
        title = `${item.paperSize || ""} ${item.printType || ""}`.trim();
        calculation = `${item.totalSheets || 0} Ø¨Ø±Ú¯ Ã— ${formatMoney(item.pricePerSheet || 0)}`;
        quantity = `${item.totalSheets || 0} Ø¨Ø±Ú¯`;
        unitPrice = item.pricePerSheet || 0;
        break;
      case "color":
        type = "Ú©Ù¾ÛŒ/Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ";
        title = `${item.paperSize || ""} ${item.printType || ""} ${item.paperType || ""}`.trim();
        calculation = `${item.totalSheets || 0} Ø¨Ø±Ú¯ Ã— ${formatMoney(item.pricePerSheet || 0)}`;
        quantity = `${item.totalSheets || 0} Ø¨Ø±Ú¯`;
        unitPrice = item.pricePerSheet || 0;
        break;
      case "binding":
        type = "ÙÙ†Ø±ÛŒ";
        title = `${item.bindingJobType || ""} ${item.paperSize || ""}`.trim();
        calculation = `${item.setCount || 0} Ø¬Ø²ÙˆÙ‡ Ã— ${formatMoney(item.pricePerSet || 0)}`;
        quantity = `${item.setCount || 0} Ø¬Ø²ÙˆÙ‡`;
        unitPrice = item.pricePerSet || 0;
        break;
      case "staple":
        type = "Ù…Ù†Ú¯Ù†Ù‡";
        title = "Ù…Ù†Ú¯Ù†Ù‡";
        calculation = `${item.setCount || 0} Ø¬Ø²ÙˆÙ‡ Ã— ${formatMoney(item.pricePerSet || 0)}`;
        quantity = `${item.setCount || 0} Ø¬Ø²ÙˆÙ‡`;
        unitPrice = item.pricePerSet || 0;
        break;
      case "lamination":
        type = "Ù¾Ø±Ø³";
        title = item.paperSize || "Ù¾Ø±Ø³";
        calculation = `${item.totalSheets || 0} Ø¨Ø±Ú¯ Ã— ${formatMoney(item.pricePerSheet || 0)}`;
        quantity = `${item.totalSheets || 0} Ø¨Ø±Ú¯`;
        unitPrice = item.pricePerSheet || 0;
        break;
      default:
        type = "Ø³Ø§ÛŒØ±";
        title = item.product || "";
        calculation = "Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ";
        quantity = "1";
        unitPrice = item.rowTotal || 0;
    }

    return {
      type: type,
      title: title,
      calculation: calculation,
      quantity: quantity,
      unitPrice: unitPrice
    };
  }

  // Ù†Ù…Ø§ÛŒØ´ Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø´ØªØ±ÛŒ
  // ØªØ¹Ø±ÛŒÙ ØªØ§Ø¨Ø¹ Ø¯Ø± Ø³Ø·Ø­ Ø¬Ù‡Ø§Ù†ÛŒ
  window.showCustomerOrders = function(customerName) {
    console.log("Showing orders for customer:", customerName);

    const fromStr = customersRepFrom.value.trim();
    const toStr = customersRepTo.value.trim();
    const fromNum = fromStr ? jalaliStringToNumber(fromStr) : 0;
    const toNum = toStr ? jalaliStringToNumber(toStr) : 99999999;

    const allOrders = loadAllOrders();
    console.log("All orders:", allOrders.length);

    // ÙÛŒÙ„ØªØ± Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø´ØªØ±ÛŒ
    const customerOrders = allOrders.filter(o => {
      const dNum = orderDateToNumber(o);
      const matchesDate = dNum >= fromNum && dNum <= toNum;
      const matchesCustomer = (o.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡") === customerName;
      console.log("Order:", o.orderNo, "Customer:", o.customerName, "Date match:", matchesDate, "Customer match:", matchesCustomer);
      return matchesDate && matchesCustomer;
    });

    console.log("Filtered customer orders:", customerOrders.length);

    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„
    const modal = document.createElement("div");
    modal.className = "modal";
    modal.innerHTML = `
      <div class="modal-box">
        <div class="modal-header">
          <h2>Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª ${customerName}</h2>
          <button class="close" onclick="this.closest('.modal').remove()" title="Ø¨Ø³ØªÙ†">&times;</button>
        </div>
        <div class="modal-body">
          <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
            <h3 style="margin: 0 0 10px 0; color: #333;">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h3>
            <p style="margin: 5px 0;"><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
            <p style="margin: 5px 0;"><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510</p>
            <p style="margin: 5px 0;"><strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
          </div>

          ${customerOrders.map((order, orderIdx) => `
            <div class="order-block" style="margin-bottom: 30px; border: 1px solid #ddd; border-radius: 5px; padding: 15px;">
              <h3 style="margin: 0 0 15px 0; color: #1976d2;">Ø³ÙØ§Ø±Ø´ ${orderIdx + 1} - ${order.dateTime || ""}</h3>

              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                <div><strong>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´:</strong> ${order.orderNo || ""}</div>
                <div><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> ${getDetailedStatusText(order)}</div>
                <div><strong>Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„:</strong> ${formatMoney(order.total || 0)} Ø±ÛŒØ§Ù„</div>
                <div><strong>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ:</strong> ${formatMoney(order.paid || 0)} Ø±ÛŒØ§Ù„</div>
                <div><strong>Ù…Ø§Ù†Ø¯Ù‡:</strong> ${formatMoney((order.total || 0) - (order.paid || 0))} Ø±ÛŒØ§Ù„</div>
              </div>

              <table style="width:100%; border-collapse:collapse; margin-top: 15px;">
                <thead>
                  <tr style="background:#e3f2fd;">
                    <th style="border:1px solid #ddd; padding:8px;">Ø±Ø¯ÛŒÙ</th>
                    <th style="border:1px solid #ddd; padding:8px;">Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´</th>
                    <th style="border:1px solid #ddd; padding:8px;">Ø¹Ù†ÙˆØ§Ù†</th>
                    <th class="col-calc" style="border:1px solid #ddd; padding:8px;">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡</th>
                    <th style="border:1px solid #ddd; padding:8px;">ØªØ¹Ø¯Ø§Ø¯/Ø³Ø±ÛŒ</th>
                    <th class="col-unit-price" style="border:1px solid #ddd; padding:8px;">Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡</th>
                    <th style="border:1px solid #ddd; padding:8px;">Ø¬Ù…Ø¹ Ø±Ø¯ÛŒÙ</th>
                  </tr>
                </thead>
                <tbody>
                  ${(order.items || []).map((item, itemIdx) => {
                    const itemDetails = getItemDetailsText(item);
                    return `
                      <tr>
                        <td style="border:1px solid #ddd; padding:8px; text-align:center;">${itemIdx + 1}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${itemDetails.type}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${itemDetails.title}</td>
                        <td class="col-calc" style="border:1px solid #ddd; padding:8px;">${itemDetails.calculation}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${itemDetails.quantity}</td>
                        <td class="col-unit-price" style="border:1px solid #ddd; padding:8px;">${formatMoney(itemDetails.unitPrice)} Ø±ÛŒØ§Ù„</td>
                        <td style="border:1px solid #ddd; padding:8px;">${formatMoney(item.rowTotal || 0)} Ø±ÛŒØ§Ù„</td>
                      </tr>
                    `;
                  }).join("")}
                </tbody>
              </table>

              ${order.payments && order.payments.length > 0 ? `
                <div style="margin-top: 15px;">
                  <h4 style="margin: 10px 0; color: #4caf50;">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§:</h4>
                  <table style="width:100%; border-collapse:collapse;">
                    <thead>
                      <tr style="background:#e8f5e8;">
                        <th style="border:1px solid #ddd; padding:5px;">ØªØ§Ø±ÛŒØ®</th>
                        <th style="border:1px solid #ddd; padding:5px;">Ù…Ø¨Ù„Øº</th>
                        <th style="border:1px solid #ddd; padding:5px;">Ú©Ø§Ø±Ø¨Ø±</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${order.payments.map(payment => `
                        <tr>
                          <td style="border:1px solid #ddd; padding:5px;">${payment.dateTime || ""}</td>
                          <td style="border:1px solid #ddd; padding:5px;">${formatMoney(payment.amount || 0)} Ø±ÛŒØ§Ù„</td>
                          <td style="border:1px solid #ddd; padding:5px;">${payment.user || ""}</td>
                        </tr>
                      `).join("")}
                    </tbody>
                  </table>
                </div>
              ` : ""}
              <div class="order-actions no-print" style="margin-top:15px; text-align:left;">
                <button type="button"
                        class="btn-small"
                        data-order-action="order-register-payment"
                        data-order-id="${order.id}"
                        data-customer="${order.customerName || customerName}"
                        style="background:#4caf50;color:#fff;margin-left:6px;">
                  Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª
                </button>
                <button type="button"
                        class="btn-small"
                        data-order-action="order-edit"
                        data-order-id="${order.id}"
                        data-customer="${order.customerName || customerName}"
                        style="background:#ffa000;color:#fff;margin-left:6px;">
                  ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ±
                </button>
                <button type="button"
                        class="btn-small"
                        data-order-action="order-cancel"
                        data-order-id="${order.id}"
                        data-customer="${order.customerName || customerName}"
                        style="background:#f44336;color:#fff;">
                  Ø§Ø¨Ø·Ø§Ù„ ÙØ§Ú©ØªÙˆØ±
                </button>
              </div>
            </div>
          `).join("")}

          <div style="text-align: center; margin-top: 20px;">
            <button class="btn-print-customer-orders" type="button" style="background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">ğŸ“„ Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´</button>
          </div>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
    modal.style.display = "block";

    // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø±Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±
    try {
      const role = currentUser && currentUser.role ? currentUser.role : "admin";
      if (role === "cashier") {
        // Ø¨Ø±Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø± ÙÙ‚Ø· "Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª" Ù…Ø¬Ø§Ø² Ø§Ø³ØªØ›
        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ùˆ Ø§Ø¨Ø·Ø§Ù„ ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
        const disallowedButtons = modal.querySelectorAll('button[data-order-action="order-edit"], button[data-order-action="order-cancel"]');
        disallowedButtons.forEach(btn => btn && (btn.style.display = "none"));
      }
    } catch (e) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ… Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´:", e);
    }

    // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª ÙØ§Ú©ØªÙˆØ±
    modal.addEventListener("click", function (ev) {
      const btn = ev.target.closest("button[data-order-action]");
      if (!btn) return;
      const action = btn.getAttribute("data-order-action");
      const orderId = btn.getAttribute("data-order-id");
      const custFromBtn = btn.getAttribute("data-customer") || customerName;

      if (!action || !orderId) return;

      const allOrders = loadAllOrders();
      const order = allOrders.find(o => String(o.id) === String(orderId));
      if (!order) {
        alert("Ø³ÙØ§Ø±Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        return;
      }

      const role = currentUser && currentUser.role ? currentUser.role : "admin";

      if (action === "order-register-payment") {
        const total = order.total || 0;
        const paid = order.paid || 0;
        let balance = total - paid;
        if (balance < 0) balance = 0;

        if (balance <= 0) {
          alert("Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
          return;
        }

        try {
          // Ø§Ø¨ØªØ¯Ø§ Ù¾Ù†Ø¬Ø±Ù‡ Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª Ø±Ø§ Ù…ÛŒâ€ŒØ¨Ù†Ø¯ÛŒÙ… ØªØ§ Ù…ÙˆØ¯Ø§Ù„ ØµÙ†Ø¯ÙˆÙ‚ Ø²ÛŒØ± Ø¢Ù† Ù‚Ø±Ø§Ø± Ù†Ú¯ÛŒØ±Ø¯
          modal.remove();

          if (window.openCustomerPaymentFromAccounts) {
            window.openCustomerPaymentFromAccounts(custFromBtn, balance);
          } else if (typeof selectDebtCustomer === "function") {
            selectDebtCustomer(custFromBtn, balance);
          }
        } catch (e) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ±Ù… ØµÙ†Ø¯ÙˆÙ‚ Ø§Ø² Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª:", e);
          alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚.");
        }
      } else if (action === "order-edit") {
        if (role === "cashier") {
          alert("Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ù†ÛŒØ³ØªÛŒØ¯.");
          return;
        }
        if (!confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ØŸ")) {
          return;
        }
        try {
          currentEditingOrderId = order.id;
          if (typeof loadOrderIntoForm === "function") {
            loadOrderIntoForm(order);
          }
          if (typeof showPage === "function") {
            showPage("orders");
          }
          const ordersBtn = document.querySelector('.main-menu button[data-page="orders"]');
          if (ordersBtn) {
            document.querySelectorAll('.main-menu button').forEach(b => b.classList.remove('active'));
            ordersBtn.classList.add("active");
          }
          modal.remove();
        } catch (e) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§Ú©ØªÙˆØ± Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´:", e);
          alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ§Ú©ØªÙˆØ± Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´.");
        }
      } else if (action === "order-cancel") {
        if (role === "cashier") {
          alert("Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø§Ø¨Ø·Ø§Ù„ ÙØ§Ú©ØªÙˆØ± Ù†ÛŒØ³ØªÛŒØ¯.");
          return;
        }
        if (!confirm("Ø¢ÛŒØ§ Ø§Ø² Ø§Ø¨Ø·Ø§Ù„ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")) {
          return;
        }
        try {
          order.status = "canceled";
          order.canceledAt = (new Date()).toLocaleString("fa-IR");
          order.canceledBy = currentUserNameSpan ? currentUserNameSpan.textContent : "";

          const idxOrder = allOrders.findIndex(o => String(o.id) === String(orderId));
          if (idxOrder !== -1) {
            allOrders[idxOrder] = order;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allOrders));
          }
          alert("ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¨Ø·Ø§Ù„ Ø´Ø¯.");
          modal.remove();
          window.showCustomerOrders(customerName);
        } catch (e) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¨Ø·Ø§Ù„ ÙØ§Ú©ØªÙˆØ±:", e);
          alert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¨Ø·Ø§Ù„ ÙØ§Ú©ØªÙˆØ±.");
        }
      }
    });

    // Ø§Ù…Ú©Ø§Ù† Ø¨Ø³ØªÙ† Ø¨Ø§ ESC Ùˆ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    const closeModal = () => modal.remove();
    const handleKeyPress = (e) => {
      if (e.key === 'Escape') {
        closeModal();
        document.removeEventListener('keydown', handleKeyPress);
      }
    };
    const handleBackgroundClick = (e) => {
      if (e.target === modal) {
        closeModal();
        modal.removeEventListener('click', handleBackgroundClick);
      }
    };

    // Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ø¯Ø§Ø®Ù„ Ù…ÙˆØ¯Ø§Ù„ Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª
    const printBtn = modal.querySelector(".btn-print-customer-orders");
    if (printBtn) {
      printBtn.addEventListener("click", function () {
        const modalBox = modal.querySelector(".modal-box");
        if (!modalBox) return;

        const printContent = modalBox.innerHTML;
        const win = window.open("", "_blank", "width=800,height=900");

        win.document.open();
        win.document.write(`
          <html>
            <head>
              <meta charset="UTF-8">
              <title>Ù¾Ø±ÛŒÙ†Øª Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª ${customerName}</title>
              <style>
                body { font-family: Tahoma, sans-serif; direction: rtl; padding: 20px; }
                table { width: 100%; border-collapse: collapse; }
                th, td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 12px; }

                /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù†ØµÙ Ø´Ø¯Ù† Ù‡Ø± Ø³ÙØ§Ø±Ø´ Ø±ÙˆÛŒ Ø¯Ùˆ ØµÙØ­Ù‡ */
                .order-block {
                  page-break-inside: avoid;
                  break-inside: avoid;
                  margin-bottom: 20px;
                }
                table, tr, td, th {
                  page-break-inside: avoid;
                  break-inside: avoid;
                }

                /* Ú†Ø§Ù¾ Ø®Ù„Ø§ØµÙ‡: Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¬Ø²ÙˆÙ‡ Ø±Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ú†Ø§Ù¾ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… */
                .col-calc,
                .col-unit-price,
                .order-actions,
                .order-actions button,
                .btn-print-customer-orders,
                .no-print {
                  display: none !important;
                }
              
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
            </head>
            <body>
              ${printContent}
            </body>
          </html>
        `);
        win.document.close();

        setTimeout(function () {
          win.print();
          win.close();
        }, 400);
      });
    }

    document.addEventListener('keydown', handleKeyPress);
    modal.addEventListener('click', handleBackgroundClick);
  }



  // Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
  function printCashPaymentsReport() {
    const printWindow = window.open('', '_blank');
    const currentDate = new Date().toLocaleDateString('fa-IR');

    printWindow.document.write(`
      <!DOCTYPE html>
      <html lang="fa" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ - ${currentDate}</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; margin: 20px; }
          h1 { text-align: center; color: #333; margin-bottom: 30px; }
          .office-info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .summary { background-color: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          .summary-item { display: inline-block; margin: 0 15px; }
          .summary-label { font-weight: bold; color: #666; }
          .summary-value { font-weight: bold; color: #4caf50; }
          @media print { body { margin: 0; } }
        
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
      </head>
      <body>
        <div class="office-info">
          <h2>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h2>
          <p><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
          <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510</p>
          <p><strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
        </div>
        <h1>Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚</h1>

        <div class="summary">
          <span class="summary-item">
            <span class="summary-label">ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´:</span>
            <span class="summary-value">${currentDate}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§:</span>
            <span class="summary-value">${cashPaymentsReportBody.children.length}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ø¬Ù…Ø¹ Ú©Ù„:</span>
            <span class="summary-value">${document.getElementById('grandTotal').textContent} Ø±ÛŒØ§Ù„</span>
          </span>
        </div>

        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>ØªØ§Ø±ÛŒØ®</th>
              <th>Ú©Ø§Ø±Ø¨Ø±</th>
              <th>Ù…Ø¨Ù„Øº</th>
              <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th>Ø·Ø±Ù Ø­Ø³Ø§Ø¨</th>
              <th>Ø¨Ø§Ø¨Øª</th>
            </tr>
          </thead>
          <tbody id="printCashTableBody"></tbody>
        </table>
      </body>
      </html>
    `);

    // Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„
    const rows = cashPaymentsReportBody.querySelectorAll('tr');
    const printTableBody = printWindow.document.getElementById('printCashTableBody');

    rows.forEach(row => {
      const newRow = printWindow.document.createElement('tr');
      newRow.innerHTML = row.innerHTML;
      printTableBody.appendChild(newRow);
    });

    printWindow.document.close();
    printWindow.print();
  }

  // Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†
  function printCustomersReport() {
    const printWindow = window.open('', '_blank');
    const currentDate = new Date().toLocaleDateString('fa-IR');

    printWindow.document.write(`
      <!DOCTYPE html>
      <html lang="fa" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù† - ${currentDate}</title>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; margin: 20px; }
          h1 { text-align: center; color: #333; margin-bottom: 30px; }
          .office-info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .summary { background-color: #f3e5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          .summary-item { display: inline-block; margin: 0 15px; }
          .summary-label { font-weight: bold; color: #666; }
          .summary-value { font-weight: bold; color: #9c27b0; }
          @media print { body { margin: 0; } }
        
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
      </head>
      <body>
        <div class="office-info">
          <h2>Ø¯ÙØªØ± ÙÙ†ÛŒ Ù‚Ù„Ù…</h2>
          <p><strong>Ø¢Ø¯Ø±Ø³:</strong> Ø´Ù‡Ø±ÛŒØ§Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ Ø´Ù‡ÛŒØ¯ Ø²Ù‡Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡)ØŒ Ø¬Ù†Ø¨ Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø³Ø¹Ø¯ÛŒ</p>
          <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> 02165280510</p>
          <p><strong>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª:</strong> Myghalam.com</p>
        </div>
        <h1>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†</h1>
        <div class="summary">
          <span class="summary-item">
            <span class="summary-label">ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´:</span>
            <span class="summary-value">${currentDate}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù†:</span>
            <span class="summary-value">${totalCustomersCount.textContent}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª:</span>
            <span class="summary-value">${totalCustomersOrders.textContent}</span>
          </span>
          <span class="summary-item">
            <span class="summary-label">Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„ ÙØ±ÙˆØ´:</span>
            <span class="summary-value">${totalCustomersSales.textContent} Ø±ÛŒØ§Ù„</span>
          </span>
        </div>
        <div id="printCustomerDetails"></div>
      </body>
      </html>
    `);

    // ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ÛŒ Ø±ÛŒØ² Ù…Ø´ØªØ±ÛŒØ§Ù†
    const printDetailsDiv = printWindow.document.getElementById('printCustomerDetails');
    const customers = Array.from(customersReportBody.querySelectorAll('tr')).map(row => {
      const cells = row.querySelectorAll('td');
      return {
        name: cells[1].textContent,
        orderCount: cells[2].textContent,
        totalSales: cells[3].textContent,
        totalPaid: cells[4].textContent,
        balance: cells[5].textContent,
        lastOrder: cells[6].textContent
      };
    });

    customers.forEach((customer, index) => {
      // Ø®Ù„Ø§ØµÙ‡ Ù…Ø´ØªØ±ÛŒ
      const customerDiv = printWindow.document.createElement('div');
      customerDiv.style.cssText = 'margin-bottom: 30px; border: 1px solid #ddd; border-radius: 5px; padding: 15px; page-break-inside: avoid;';
      customerDiv.innerHTML = `
        <h3 style="margin: 0 0 10px 0; color: #9c27b0;">Ù…Ø´ØªØ±ÛŒ ${index + 1}: ${customer.name}</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
          <div><strong>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´:</strong> ${customer.orderCount}</div>
          <div><strong>Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ´:</strong> ${customer.totalSales}</div>
          <div><strong>Ù…Ø¬Ù…ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ:</strong> ${customer.totalPaid}</div>
          <div><strong>Ù…Ø§Ù†Ø¯Ù‡:</strong> ${customer.balance}</div>
          <div><strong>Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´:</strong> ${customer.lastOrder}</div>
        </div>
      `;

      // Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø´ØªØ±ÛŒ
      const customerOrders = allOrders.filter(o =>
        (o.customerName || "Ù…Ø´ØªØ±ÛŒ Ù…ØªÙØ±Ù‚Ù‡") === customer.name
      );

      if (customerOrders.length > 0) {
        const ordersTable = printWindow.document.createElement('table');
        ordersTable.style.cssText = 'width: 100%; border-collapse: collapse; margin-top: 10px;';
        ordersTable.innerHTML = `
          <thead>
            <tr style="background: #f9f9f9;">
              <th style="border: 1px solid #ddd; padding: 5px;">Ø±Ø¯ÛŒÙ</th>
              <th style="border: 1px solid #ddd; padding: 5px;">ØªØ§Ø±ÛŒØ®</th>
              <th style="border: 1px solid #ddd; padding: 5px;">Ø´Ù…Ø§Ø±Ù‡</th>
              <th style="border: 1px solid #ddd; padding: 5px;">Ù…Ø¬Ù…ÙˆØ¹</th>
              <th style="border: 1px solid #ddd; padding: 5px;">Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
              <th style="border: 1px solid #ddd; padding: 5px;">Ù…Ø§Ù†Ø¯Ù‡</th>
              <th style="border: 1px solid #ddd; padding: 5px;">ÙˆØ¶Ø¹ÛŒØª</th>
            </tr>
          </thead>
          <tbody>
            ${customerOrders.map((order, idx) => `
              <tr>
                <td style="border: 1px solid #ddd; padding: 5px; text-align: center;">${idx + 1}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${order.dateTime || ""}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${order.orderNo || ""}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${formatMoney(order.total || 0)}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${formatMoney(order.paid || 0)}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${formatMoney((order.total || 0) - (order.paid || 0))}</td>
                <td style="border: 1px solid #ddd; padding: 5px;">${getDetailedStatusText(order)}</td>
              </tr>
            `).join("")}
          </tbody>
        `;
        customerDiv.appendChild(ordersTable);
      }

      printDetailsDiv.appendChild(customerDiv);
    });

    printWindow.document.close();
    printWindow.print();
  }

  // Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ø¨Ø±Ø§ÛŒ Ù‚Ø³Ù…Øª Ù‚Ø¯ÛŒÙ…ÛŒ)
  function rebuildCashPaymentsReport() {
    // ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù†
    reportTableTitle.textContent = "Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ø¨Ø± Ø§Ø³Ø§Ø³ ÙÛŒÙ„ØªØ±)";

    const fromStr = repFrom.value.trim();
    const toStr   = repTo.value.trim();
    const userFilter = repUserSelect.value;
    const customerFilter = repCustomerInput.value.trim().toLowerCase();

    const fromNum = fromStr ? jalaliStringToNumber(fromStr) : 0;
    const toNum   = toStr ? jalaliStringToNumber(toStr) : 99999999;

    const allPayments = JSON.parse(localStorage.getItem(CASH_STORAGE_KEY) || "[]");

    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
    const filteredPayments = allPayments.filter(p => {
      // ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®
      const dt = (p.dateTime || "").split(/[,\s]/)[0];
      const dNum = jalaliStringToNumber(dt);
      if (dNum < fromNum || dNum > toNum) return false;

      // ÙÛŒÙ„ØªØ± Ú©Ø§Ø±Ø¨Ø±
      if (userFilter && p.user !== userFilter) return false;

      // ÙÛŒÙ„ØªØ± Ù…Ø´ØªØ±ÛŒ/Ø·Ø±Ù Ø­Ø³Ø§Ø¨
      if (customerFilter && (!p.customerName || !p.customerName.toLowerCase().includes(customerFilter))) return false;

      return true;
    });

    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ (Ø¨Ø§ ØªØºÛŒÛŒØ± Ù‡Ø¯Ø±)
    const table = savedOrdersBody.closest('table');
    const thead = table.querySelector('thead tr');

    // ØªØºÛŒÛŒØ± Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
    thead.innerHTML = `
      <th>ØªØ§Ø±ÛŒØ®</th>
      <th>Ú©Ø§Ø±Ø¨Ø±</th>
      <th>Ù…Ø¨Ù„Øº</th>
      <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
      <th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
      <th>Ø·Ø±Ù Ø­Ø³Ø§Ø¨</th>
      <th>Ø¨Ø§Ø¨Øª</th>
    `;

    savedOrdersBody.innerHTML = "";

    let totalAmount = 0;
    filteredPayments.forEach((p, index) => {
      totalAmount += (p.amount || 0);
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.dateTime || ""}</td>
        <td>${p.user || ""}</td>
        <td>${formatMoney(p.amount || 0)}</td>
        <td>${getPaymentMethodLabel(p.payMethod || "")}</td>
        <td>${getPaymentTypeLabel(p.payType || "")}</td>
        <td>${p.customerName || ""}</td>
        <td>${p.reason || ""}</td>
      `;
      savedOrdersBody.appendChild(tr);
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹
    const trTotal = document.createElement("tr");
    trTotal.style.fontWeight = "bold";
    trTotal.style.backgroundColor = "#e3f2fd";
    trTotal.innerHTML = `
      <td colspan="2">Ø¬Ù…Ø¹ Ú©Ù„:</td>
      <td>${formatMoney(totalAmount)}</td>
      <td colspan="4"></td>
    `;
    savedOrdersBody.appendChild(trTotal);
  }

  // ================== Ù¾Ø§ÛŒØ§Ù† Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØªÛŒ ==================

 
  // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
  updateUIByServiceType();
  updatePaperFieldsByColor();
  updateExtraPriceVisibility();
  recalcDetail();
  updateBalance();
  updateNewCustomerPriceLevelVisibility();
  updateOrderPriceLevelFromCustomer();
  setOrderStatus("registered");
  updateOpenOrdersButtonState();
  loadCashPaymentsToReport();
  setupMoneyInputs();
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var btn = document.getElementById("btnDailyClosePrint");
  if (!btn) return;

  btn.addEventListener("click", function () {
    var modalBox = document.querySelector("#dailyCloseModal .modal-box");
    if (!modalBox) return;

    var printContent = modalBox.innerHTML;
    var win = window.open("", "_blank", "width=800,height=900");

    win.document.open();
    win.document.write(`
      <html>
        <head>
          <meta charset="UTF-8">
          <title>Ù¾Ø±ÛŒÙ†Øª Ø±ÛŒØ² Ø³ÙØ§Ø±Ø´</title>
          <style>
            body { font-family: Tahoma, sans-serif; direction: rtl; padding: 20px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 12px; }
          
/* ==== ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯) ==== */

#pageUsers {
  margin-top: 10px;
}

#pageUsers .page-section {
  border: 1px solid #dce3ec;
  border-radius: 10px;
  padding: 14px 16px 18px;
  background: #ffffff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  max-width: 1100px;
  margin: 10px auto 0;
}

#pageUsers h2 {
  margin: 0 0 6px;
  font-size: 18pt;
  color: #0d47a1;
}

#pageUsers .page-subtitle {
  margin: 0 0 12px;
  font-size: 11.5pt;
  color: #607d8b;
}

#pageUsers .users-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 12px;
}

#pageUsers .role-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 11pt;
}

#pageUsers .role-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: #e3f2fd;
  color: #0d47a1;
}

#pageUsers .role-badge.admin {
  background: #1565c0;
  color: #fff;
}
#pageUsers .role-badge.supervisor {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .role-badge.cashier {
  background: #43a047;
  color: #fff;
}

/* Ø¯Ùˆ Ø³ØªÙˆÙ†: Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† + ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´/Ø§ÙØ²ÙˆØ¯Ù† */
#pageUsers .users-layout {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#pageUsers .card {
  background: #fafcff;
  border-radius: 10px;
  border: 1px solid #dce3ec;
  padding: 10px 12px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#pageUsers .card h3 {
  margin: 0 0 10px;
  font-size: 15pt;
  color: #1976d2;
}

#pageUsers .role-change-card {
  border-style: dashed;
  border-color: #ffb300;
  background: #fff8e1;
}


/* Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .table-wrapper {
  max-height: 350px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e0e6f0;
}

#pageUsers table {
  width: 100%;
  border-collapse: collapse;
}
#pageUsers th,
#pageUsers td {
  border: 1px solid #e0e6f0;
  padding: 6px;
  font-size: 12pt;
  text-align: center;
}
#pageUsers th {
  background: #e3f2fd;
  color: #0d47a1;
}
#pageUsers tbody tr:nth-child(even) {
  background: #f9fbff;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */
#pageUsers .user-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
}

#pageUsers .btn-chip {
  border: none;
  border-radius: 999px;
  padding: 3px 9px;
  font-size: 11pt;
  cursor: pointer;
  font-family: "B Homa", Tahoma, sans-serif;
  transition: 0.15s;
  white-space: nowrap;
}

#pageUsers .btn-chip.edit {
  background: #1976d2;
  color: #fff;
}
#pageUsers .btn-chip.role {
  background: #ffb300;
  color: #4e342e;
}
#pageUsers .btn-chip.delete {
  background: #e53935;
  color: #fff;
}

#pageUsers .btn-chip:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± */
#pageUsers .form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
#pageUsers .form-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
#pageUsers .form-row label {
  min-width: 90px;
  font-size: 12.5pt;
  color: #0d47a1;
}
#pageUsers .form-row input,
#pageUsers .form-row select {
  flex: 1;
  padding: 5px 7px;
  border-radius: 6px;
  border: 1px solid #cfd8e3;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .form-row input:focus,
#pageUsers .form-row select:focus {
  border-color: #42a5f5;
  box-shadow: 0 0 4px rgba(66,165,245,0.6);
  outline: none;
}

#pageUsers .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

#pageUsers .btn-primary {
  background: #43a047;
  color: #fff;
}
#pageUsers .btn-secondary {
  background: #9e9e9e;
  color: #fff;
}
#pageUsers .btn-primary,
#pageUsers .btn-secondary {
  padding: 6px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12.5pt;
  font-family: "B Homa", Tahoma, sans-serif;
}
#pageUsers .btn-primary:hover,
#pageUsers .btn-secondary:hover {
  opacity: 0.9;
  transform: scale(1.02);
}

/* Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ±Ù… (Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´) */
#pageUsers .form-status {
  font-size: 11pt;
  color: #607d8b;
  margin-bottom: 4px;
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 900px) {
  #pageUsers .users-layout {
    grid-template-columns: 1fr;
  }
}


/* Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± - Ø¬Ù…Ø¹ Ùˆ Ú©ÙˆÚ†Ú© */
#loginModal.modal {
  align-items: center;
  justify-content: center;
}

#loginModal .modal-box {
  min-width: 320px;
  max-width: 420px;
  width: auto;
  padding: 18px 20px 20px;
}

#loginModal .row {
  margin-bottom: 8px;
}

#loginModal .field label {
  display: block;
  margin-bottom: 4px;
}

#loginModal .field input {
  width: 100%;
}

#loginModal h2 {
  text-align: center;
}

#loginModal .hint {
  font-size: 11pt;
  text-align: center;
  color: #607d8b;
}

#loginModal .modal-buttons {
  justify-content: center;
}

#loginModal #btnLogin {
  font-family: "B Homa", Tahoma, sans-serif;
  font-size: 13pt;
}


/* --- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ø³ÛŒØ§Ø± Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ --- */

#loginModal.modal {
  align-items: center !important;
  justify-content: center !important;
}

#loginModal.modal.show {
  display: flex !important;
}

#loginModal .modal-box {
  width: 260px !important;
  min-width: 260px !important;
  max-width: 280px !important;
  padding: 18px 16px !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

#loginModal h2 {
  font-size: 15pt !important;
  margin: 0 0 12px 0 !important;
  text-align: center !important;
}

#loginModal .row {
  margin-bottom: 10px !important;
}

#loginModal .field label {
  font-size: 12.5pt !important;
  margin-bottom: 4px !important;
  display: block !important;
}

#loginModal .field input {
  width: 100% !important;
  padding: 6px 8px !important;
  font-size: 12.5pt !important;
  border-radius: 6px !important;
  border: 1px solid #ccc !important;
}

#loginModal .hint {
  text-align: center !important;
  font-size: 10.5pt !important;
  margin-top: 6px !important;
  color: #607d8b !important;
}

#loginModal .modal-buttons {
  margin-top: 14px !important;
  display: flex !important;
  justify-content: center !important;
}

#loginModal #btnLogin {
  padding: 6px 20px !important;
  font-size: 13pt !important;
  font-family: "B Homa", Tahoma, sans-serif !important;
  border-radius: 6px !important;
  background: #1976d2 !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
}

</style>
        </head>
        <body>
          ${printContent}
        </body>
      </html>
    `);
    win.document.close();

    setTimeout(function() {
      win.print();
      win.close();
    }, 400);
  });
});
</script>

</body>
</html>
